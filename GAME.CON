include DEFS.CON
include USER.CON

action ANULLACTION 0

///////////////////////////////////// N O T E S////////////////////////////////////////////////



/*
FIRST PRIORITY:
Monster stuck i rød uden at rød var åben, men gul var
Monster blev stuck

SECOND PRIORITY:
Monsterdrop: ammo til våben/våbene og double penge over tid
tilføj noget ved eog screen
Mysteryboks skal sige en rumlyd når man er tæt på dem
tilføj en bank - giver 110% interest pr runde, men det koster gebyr og de skal mindst være der
i 5 runder eller sådan noget. eller juster withdraw prisen alt efter hvor lang tid de har været
derinde. lav noget fed grafik til det.
mystery box der spawner by a chance og så kan man have en hold-use mechanic, 
hvor en counter tæller op hvert tic hvis use, ellers sætter den til 0.
ved en bestemt runde ændrer newbeast karakter og kan fx hoppe eller slår hurtigere
sørg for at monstrene kun spawner mht hvor mange kort der er aktive og ikke med 50%
mellem hver runde effekter og highlight af stats for runden

*/
//////////////////////////////////// S U R V I V A L /////////////////////////////////////////////////

////////////////////DEFINES/////////////////
definegamefuncname 13 Add_Money
definegamefuncname 19 Up
definegamefuncname 20 Down
definegamefuncname 21	Use_skill_point
definegamefuncname 30 Debugging
definegamefuncname 31 God_Mode
definegamefuncname 32 Log
definegamefuncname 34 Score_Overlay
definegamefuncname 36 Skill_pick
definegamefuncname 48 Reload

//SHRINKER
defineprojectile 1660 PROJ_WORKSLIKE 36866 //2 + 4096 + 32768
defineprojectile 1660 PROJ_SPAWNS SHRINKEREXPLOSION
defineprojectile 1660 PROJ_ISOUND 158
defineprojectile 1660 PROJ_VEL 840
defineprojectile 1660 PROJ_HITRADIUS 0
defineprojectile 1660	PROJ_EXTRA 101
defineprojectile 1660 PROJ_XREPEAT 14
defineprojectile 1660 PROJ_YREPEAT 14
defineprojectile 1660 PROJ_CLIPDIST 30
defineprojectile 1660 PROJ_PAL 8

////////////////////GAMEVARS/////////////////

//Player specific
gamevar finalplayermoney 500 1 //Husk at korrigere nede i calculatetotalpoints
gamevar primaryweapon 1 1
gamevar secondaryweapon 0 1
gamevar tertiaryweapon 0 1
gamevar gotbackpack 0 1
gamevar gotarmor 0 1
gamevar gotboots 0 1
gamevar gotperkprotection 0 1
gamevar gotpowershot 0 1
gamevar gotdoublemoney 0 1
gamevar gotautorevive 0 1
gamevar haltrunspeed 20000 1
gamevar playerrunspeed 43000 1
gamevar minimumthreshold 0 0

//Game flow specific
gamevar intermission 150 0 //skal ændres nede i nextround state
gamevar round 1 0
gamevar monstertype 1 0
gamevar spawnrate 0 0
gamevar monsterslefttospawn 0 0
gamevar totalmonsters 0 0
gamevar monsterhp 0 0
gamevar maxmonstersallowed 5 0

//Reference vars (read only!)
gamevar downtimervar 600 4096
gamevar autorevivetimervar 150 4096
gamevar teleporttimervar 2700 4096
gamevar buycooldownvar 10 4096

//Gets set in event_use and showinformation
 					//DMG AMMO TOTALDMG  BUY  BUYDMG  PRICE
//PISTOL	  7 * 500 =  3500 |  50    350   250 - 1000 
//SHOTTY	112 *  80 =  8960 |   8    896   750 - 3000
//CHAIN		 15 * 500 =  7500 |  50    750   600 - 2400
//RPG			250	*  50 = 12500 |	  5   1250  1250 - 5000
//HBOMB		300 *  30 =  9000 |   3    900   750 - 3000
//STINGER	300 * 100 = 30000 |  10   3000  2000 - 8000
//EXPAND	 15 * 200 =  3000 |  20    300  1000 - 4000 ?
//DEVI		 50 * 500 = 25000 |  50   2500  1750 - 7000
//FREEZE	 40 * 200 =  8000 |  20    800   650 - 2600
//TRIP		300 *  30 =  9000 |   3    900   600 - 2400
gamevar pistolcost 1000 4096
gamevar shotguncost 3000 4096
gamevar chainguncost 2400 4096
gamevar rpgcost 5000 4096
gamevar pipebombcost 3000 4096
gamevar shrinkercost 8000 4096
gamevar expandercost 0 4096
gamevar devistatorcost 7000 4096
gamevar tripbombcost 2600 4096
gamevar freezercost 2400 4096

gamevar backpackcost 2000 4096
gamevar instakillcost 4000 4096
gamevar perkprotectercost 4000 4096
gamevar autorevivecost 2000 4096
gamevar moneymultipliercost 3000 4096
gamevar armorcost 3000 4096
gamevar bootscost 4000 4096
gamevar bigmagcost 4000 4096
gamevar accesscardcost 3000 4096

gamevar mysteryboxcost 2500 4096

gamevar temp 0 0
gamevar temptwo 0 0
gamevar tempthree 0 0
gamevar tempfour 0 0
gamevar tempfive 0 0
gamevar tempsix 0 0
gamevar haltcounter 0 1
gamevar spawncounter 0 2
gamevar hpregencounter 0 1
gamevar accessspritenum 0 1
gamevar accesstoblue 0 0
gamevar accesstored 0 0
gamevar accesstoyellow 0 0
gamevar buycooldown 0 1
gamevar weaponswitchcd 0 1
gamevar tintscreen 0 1
gamevar id -1 0
gamevar idtwo -1 0
gamevar roundcompletetimer 0 0
gamevar nuclear 0 2
gamevar nucleartimer 0 1
gamevar maxammo 0 2
gamevar maxammotimer 0 1
gamevar instakill 0 2
gamevar instakilltimer 0 1
gamevar instakillduration 0 1
gamevar powershotcd 0 1
gamevar infinityammo 0 1
gamevar infinityammotimer 0 1
gamevar infinityammoduration 0 1
gamevar havespawnedorb 0 0
gamevar spawners -1 0
gamevar orbtimer 0 0
gamevar moneyfromdroptimer 0 1
gamevar moneycounter 0 1
gamevar bonusmoneycounter 0 1
gamevar monstersalive 0 0
gamevar playersalive 0 0
gamevar instakillhpset 0 2
gamevar playermoney 0 1
gamevar playermoneybonus 0 1
gamevar hpregencountervar 180 0
gamevar debugvalue 0 1
gamevar debugvaluetwo 0 1 
gamevar gotrevivedbyintermission 0 1
gamevar showoverlay 0 1
gamevar moneyspent 0 1
gamevar damagedealt 0 1
gamevar bonuses 0 1
gamevar doublemoneygained 0 1
gamevar hits 0 1
gamevar shots 0 1
gamevar showdebugging 0 1
gamevar havecountedspawner 0 2
gamevar activespawners 0 0
gamevar invalidgame 0 0
gamevar rushroundtimer 0 0
gamevar autorevivetimer 0 1
gamevar owner -1 2
gamevar totalpoints 0 1
gamevar moneyrecieved 0 1
gamevar moneydonated 0 1
gamevar gothit -1 1
gamevar nohittimer 0 1
gamevar revivetimer 0 1
gamevar downtimer 0 1
gamevar isdead 0 1
gamevar isdown 0 1
gamevar idofdyingduke -1 0
gamevar powershotkills 0 1
gamevar activemysterybox -1 0
gamevar gotrevivedbyplayer 0 1
gamevar eog 0 0
gamevar numberofplayers -1 0
gamevar chaingunheat 0 1
gamevar hasoverheated 0 1
gamevar moneyfest 0 2
gamevar moneyfesttimer 0 1
gamevar moneyfestduration 0 1
gamevar moneyfrommoneyfest 0 1
gamevar moneyfrommoneyfestshow 0 1
gamevar moneyfestshowtimer 0 1
gamevar teleporttimer 0 2
gamevar itemcost 0 1
gamevar powershotmoney 0 1
gamevar successfulrevivetimer 0 1
gamevar moneyused 0 1
gamevar moneyusedcounter 0 1
gamevar armorhpgiven 0 1
gamevar itemcounter 0 2
gamevar gotbigmag 0 1
gamevar experience 0 1
gamevar experienceneeded 0 1
gamevar currentlevel 1 1
gamevar skillpoints 1 1
gamevar showskilloverlay 0 1
gamevar choice 1 1
gamevar playerhealth 20 1
gamevar ammomultiplier 1 1
gamevar bonusmoneyonkills 0 1
gamevar autooffcounter 0 1

gamevar movespeedskill 1 1
gamevar bonusmoneyskill 1 1
gamevar healthskill 1 1
gamevar maxammoskill 1 1

gamevar ammoamountone 0 1
gamevar ammoamounttwo 0 1
gamevar ammoamountthree 0 1
gamevar ammoamountfour 0 1
gamevar ammoamountfive 0 1
gamevar ammoamountsix 0 1
gamevar ammoamountseven 0 1
gamevar ammoamounteight 0 1
gamevar ammoamountnine 0 1
gamevar ammoamounteleven 0 1
gamevar primaryweaponsave 0 1
gamevar secondaryweaponsave 0 1
gamevar tertiaryweaponsave 0 1
gamevar primaryammo 0 1
gamevar secondaryammo 0 1
gamevar tertiaryammo 0 1
gamevar spawnedthisiteration 0 0
gamevar totalkills 0 1

gamevar MY_X 0 1
gamevar MY_Y 0 1
gamevar MY_Z 0 1
gamevar MY_SECTOR 0 1
gamevar MY_ANGLE 0 1
gamevar MY_ZDIST 0 1
gamevar MY_COS 0 1
gamevar MY_SIN 0 1
gamevar HITSECTOR 0 1
gamevar HITSPRITE 0 1
gamevar HITWALL 0 1
gamevar HITX 0 1
gamevar HITY 0 1
gamevar HITZ 0 1
gamevar PISTOLAMMO 0 1 
gamevar KICKBACK 0 1
gamevar PWEAPON 0 1 
gamevar PISTOLMAGAZINE 0 1
gamevar PERPLAYER1 0 1
gamevar WEAPON1_CLIP 0 0

////////////////////STATES/////////////////
state setupround
	switch round
		case 1 {
			/*
			setvar monstertype 1
			setvar monsterhp 300
			setvar totalmonsters 20
			setvar maxmonstersallowed 5
			setvar minimumthreshold 1
			setvar spawnrate 50
			setvarvar monsterslefttospawn totalmonsters
			*/
			setvar monstertype 1
			setvar monsterhp 50
			setvar totalmonsters 5
			setvar maxmonstersallowed 5
			setvar minimumthreshold 0
			setvar spawnrate 250
			setvarvar monsterslefttospawn totalmonsters
			break
		}
		case 2 {
			setvar monstertype 1
			setvar monsterhp 55
			setvar totalmonsters 8
			setvar maxmonstersallowed 5
			setvar minimumthreshold 0
			setvar spawnrate 250
			setvarvar monsterslefttospawn totalmonsters
			break
		}
		case 3 {
			setvar monstertype 1
			setvar monsterhp 61
			setvar totalmonsters 12
			setvar maxmonstersallowed 5
			setvar minimumthreshold 1
			setvar spawnrate 250
			setvarvar monsterslefttospawn totalmonsters
			break
		}
		case 4 {
			setvar monstertype 1
			setvar monsterhp 68
			setvar totalmonsters 16
			setvar maxmonstersallowed 5
			setvar minimumthreshold 1
			setvar spawnrate 250
			setvarvar monsterslefttospawn totalmonsters
			break
		}
		case 5 {
			setvar monstertype 1
			setvar monsterhp 76
			setvar totalmonsters 20
			setvar maxmonstersallowed 5
			setvar minimumthreshold 1
			setvar spawnrate 250
			setvarvar monsterslefttospawn totalmonsters
			break
		}
		case 6 {
			setvar monstertype 2
			setvar monsterhp 42 //84
			setvar totalmonsters 20
			setvar maxmonstersallowed 20
			setvar minimumthreshold 4
			setvar spawnrate 250
			setvarvar monsterslefttospawn totalmonsters
			setvar rushroundtimer 540
			break
		}
		case 7 {
			setvar monstertype 1
			setvar monsterhp 93
			setvar totalmonsters 25
			setvar maxmonstersallowed 13
			setvar minimumthreshold 2
			setvar spawnrate 250
			setvar maxmonstersallowed 20
			setvarvar monsterslefttospawn totalmonsters
			break
		}
		case 8 {
			setvar monstertype 1
			setvar monsterhp 103
			setvar totalmonsters 30
			setvar maxmonstersallowed 14
			setvar minimumthreshold 2
			setvar spawnrate 250
			setvarvar monsterslefttospawn totalmonsters
			break
		}
		case 9 {
			setvar monstertype 1
			setvar monsterhp 114
			setvar totalmonsters 35
			setvar maxmonstersallowed 15
			setvar minimumthreshold 2
			setvar spawnrate 250
			setvarvar monsterslefttospawn totalmonsters
			break
		}
		case 10 {
			setvar monstertype 1
			setvar monsterhp 127
			setvar totalmonsters 40
			setvar maxmonstersallowed 16
			setvar minimumthreshold 2
			setvar spawnrate 250
			setvarvar monsterslefttospawn totalmonsters
			break
		}
		case 11 {
			setvar monstertype 1
			setvar monsterhp 140
			setvar totalmonsters 45
			setvar maxmonstersallowed 17
			setvar minimumthreshold 2
			setvar spawnrate 250
			setvarvar monsterslefttospawn totalmonsters
			break
		}
		case 12 {
			setvar monstertype 2
			setvar monsterhp 78 //156
			setvar totalmonsters 45
			setvar maxmonstersallowed 45
			setvar minimumthreshold 9
			setvar spawnrate 250
			setvarvar monsterslefttospawn totalmonsters
			setvar rushroundtimer 540
			break
		}
		case 13 {
			setvar monstertype 1
			setvar monsterhp 173
			setvar totalmonsters 50
			setvar maxmonstersallowed 22
			setvar minimumthreshold 4
			setvar spawnrate 250
			setvarvar monsterslefttospawn totalmonsters
			break
		}
		case 14 {
			setvar monstertype 1
			setvar monsterhp 192
			setvar maxmonstersallowed 23
			setvar minimumthreshold 4
			setvar spawnrate 250
			setvar totalmonsters 55
			setvarvar monsterslefttospawn totalmonsters
			break
		}
		case 15 {
			setvar monstertype 1
			setvar monsterhp 212
			setvar totalmonsters 60
			setvar maxmonstersallowed 24
			setvar minimumthreshold 4
			setvar spawnrate 250
			setvarvar monsterslefttospawn totalmonsters
			break
		}
		case 16 {
			setvar monstertype 1
			setvar monsterhp 235
			setvar totalmonsters 65
			setvar maxmonstersallowed 25
			setvar minimumthreshold 4
			setvar spawnrate 250
			setvarvar monsterslefttospawn totalmonsters
			break
		}
		case 17 {
			setvar monstertype 1
			setvar monsterhp 261
			setvar totalmonsters 70
			setvar maxmonstersallowed 26
			setvar minimumthreshold 4
			setvar spawnrate 250
			setvarvar monsterslefttospawn totalmonsters
			break
		}
		case 18 {
			setvar monstertype 2
			setvar monsterhp 145 //289
			setvar totalmonsters 70
			setvar maxmonstersallowed 70
			setvar minimumthreshold 12
			setvar spawnrate 250
			setvarvar monsterslefttospawn totalmonsters
			setvar rushroundtimer 540
			break
		}
		case 19 {
			setvar monstertype 1
			setvar monsterhp 321
			setvar totalmonsters 75
			setvar maxmonstersallowed 31
			setvar minimumthreshold 8
			setvar spawnrate 250
			setvarvar monsterslefttospawn totalmonsters
			break
		}
		case 20 {
			setvar monstertype 1
			setvar monsterhp 356
			setvar totalmonsters 80
			setvar maxmonstersallowed 32
			setvar minimumthreshold 8
			setvar spawnrate 250
			setvarvar monsterslefttospawn totalmonsters
			break
		}
		case 21 {
			setvar monstertype 1
			setvar monsterhp 395
			setvar totalmonsters 85
			setvar maxmonstersallowed 33
			setvar minimumthreshold 8
			setvar spawnrate 250
			setvarvar monsterslefttospawn totalmonsters
			break
		}
		case 22 {
			setvar monstertype 1
			setvar monsterhp 438
			setvar totalmonsters 90
			setvar maxmonstersallowed 34
			setvar minimumthreshold 8
			setvar spawnrate 250
			setvarvar monsterslefttospawn totalmonsters
			break
		}
		case 23 {
			setvar monstertype 1
			setvar monsterhp 485
			setvar totalmonsters 95
			setvar maxmonstersallowed 35
			setvar minimumthreshold 8
			setvar spawnrate 250
			setvarvar monsterslefttospawn totalmonsters
			break
		}
		case 24 {
			setvar monstertype 2
			setvar monsterhp 269 //538
			setvar totalmonsters 95
			setvar maxmonstersallowed 95
			setvar minimumthreshold 15
			setvar spawnrate 250
			setvarvar monsterslefttospawn totalmonsters
			setvar rushroundtimer 540
			break
		}
		case 25 {
			setvar monstertype 1
			setvar monsterhp 597
			setvar totalmonsters 100
			setvar maxmonstersallowed 40
			setvar minimumthreshold 9
			setvar spawnrate 250
			setvarvar monsterslefttospawn totalmonsters
			break
		}
		case 26 {
			setvar monstertype 1
			setvar monsterhp 662
			setvar totalmonsters 120
			setvar maxmonstersallowed 45
			setvar minimumthreshold 9
			setvar spawnrate 250
			setvarvar monsterslefttospawn totalmonsters
			break
		}
		case 27 {
			setvar monstertype 1
			setvar monsterhp 734
			setvar totalmonsters 140
			setvar maxmonstersallowed 50
			setvar minimumthreshold 9
			setvar spawnrate 250
			setvarvar monsterslefttospawn totalmonsters
			break
		}
		case 28 {
			setvar monstertype 1
			setvar monsterhp 813
			setvar totalmonsters 160
			setvar maxmonstersallowed 55
			setvar minimumthreshold 9
			setvar spawnrate 250
			setvarvar monsterslefttospawn totalmonsters
			break
		}
		case 29 {
			setvar monstertype 1
			setvar monsterhp 902
			setvar totalmonsters 180
			setvar maxmonstersallowed 60
			setvar minimumthreshold 9
			setvar spawnrate 250
			setvarvar monsterslefttospawn totalmonsters
			break
		}
		case 30 {
			//Sidste runde; sættes nede i displayrest mht 'last round' 
			setvar monstertype 2
			setvar monsterhp 500 //1000
			setvar totalmonsters 200
			setvar maxmonstersallowed 100
			setvar minimumthreshold 14
			setvar spawnrate 250
			setvarvar monsterslefttospawn totalmonsters
			break
		}
		default {
			break
		}
	endswitch
ends

state gotmoneyfromteammate
	ifvare tintscreen 1 {
		setvar tintscreen 0
		palfrom 20 0 64 0
	}
ends

state loseperks
	ifvare gotperkprotection 1 {
		setvar gotperkprotection 0
	} else {
		setvar gotbackpack 0
		setvar gotboots 0
		setvar gotarmor 0
		setvar gotdoublemoney 0
		setvar gotpowershot 0
		setvar powershotkills 0
		setvar powershotcd 0
		setvar gotbigmag 0
	}
ends

state showweaponorammofix
	ifvarvare temp primaryweapon setvar temptwo 1
	else ifvarvare temp secondaryweapon setvar temptwo 1
	else ifvarvare temp tertiaryweapon setvar temptwo 1
	else setvar temptwo 0
ends

state weaponswitchfix
	ifvarn tertiaryweapon 0 {
		ifvarvarg primaryweapon secondaryweapon {
			ifvarvarg secondaryweapon tertiaryweapon {
				setvarvar temp secondaryweapon
				setvarvar secondaryweapon tertiaryweapon
				setvarvar tertiaryweapon temp
			} else ifvarvarg tertiaryweapon primaryweapon {
				setvarvar temp secondaryweapon
				setvarvar secondaryweapon tertiaryweapon
				setvarvar tertiaryweapon temp
			}
		} else ifvarvarg secondaryweapon tertiaryweapon {
			ifvarvarg tertiaryweapon secondaryweapon {
				setvarvar temp secondaryweapon
				setvarvar secondaryweapon tertiaryweapon
				setvarvar tertiaryweapon temp
			}
		}
	}
ends

state autoreviveeffects
	ifvare autorevivetimer 30 {
		sound 83
		palfrom 30 0 0 64
		spawn TRANSPORTERSTAR
	} else ifvare autorevivetimer 60 {
		sound 83
		palfrom 30 0 0 64
		spawn TRANSPORTERSTAR
	} else ifvare autorevivetimer 90 {
		sound 83
		palfrom 30 0 0 64
		spawn TRANSPORTERSTAR
	} 
ends

state handlepowershot
	ifvare gotpowershot 1 ifvarl powershotcd 150 addvar powershotcd 1
ends

state countitemcounter
	addvar itemcounter 1
	ifvare itemcounter 360 {
		getactor[THISACTOR].cstat temp
		addvar temp 2
		setactor[THISACTOR].cstat temp
	}
	ifvare itemcounter 450 killit
ends

state respawnfromintermission
	getplayer[THISACTOR].posx MY_X
	getplayer[THISACTOR].posy MY_Y
	getplayer[THISACTOR].posz MY_Z
	setvar gotrevivedbyintermission 1
	resetplayer
	setplayer[THISACTOR].posx MY_X
	setplayer[THISACTOR].posy MY_Y
	setplayer[THISACTOR].posz MY_Z
	setvar showoverlay 0
ends

state jib_sounds
  ifrnd SWEARFREQUENCY
  {
    ifrnd 128
    {
      ifrnd 128
      {
        ifrnd 128
        {
          ifrnd 128
          {
            ifrnd 128
              globalsound JIBBED_ACTOR12
            else
              globalsound JIBBED_ACTOR1
          }
          else
          {
            ifrnd 128
              globalsound JIBBED_ACTOR9
            else
              globalsound JIBBED_ACTOR14
          }
        }
        else
        {
          ifrnd 128
            globalsound SMACKED
          else
            globalsound JIBBED_ACTOR2
        }
      }
      else
      {
        ifrnd 128
          globalsound MDEVSPEECH
        else
          globalsound JIBBED_ACTOR5
      }
    }
    else
    {
      ifrnd 128
      {
        ifrnd 128
        {
          ifrnd 128
            globalsound JIBBED_ACTOR11
          else
            globalsound JIBBED_ACTOR13
        }
        else
        {
          ifrnd 128
            globalsound JIBBED_ACTOR3
          else
            globalsound JIBBED_ACTOR8
        }
      }
      else
      {
        ifrnd 128
        {
          ifrnd 128
            globalsound JIBBED_ACTOR6
          else
            globalsound JIBBED_ACTOR4
        }
        else
        {
          ifrnd 128
          {
            ifrnd 128
              globalsound JIBBED_ACTOR10
            else
              globalsound JIBBED_ACTOR15

          }
          else
            globalsound JIBBED_ACTOR7
        }
      }
    }
  }
ends

state standard_jibs
  guts JIBS2 1
  guts JIBS3 2
  guts JIBS4 3
  guts JIBS5 2
  guts JIBS6 3
  ifrnd 6
  {
    guts JIBS1 1
    spawn BLOODPOOL
  }         // a badly drawn spine

  state jib_sounds
ends

state dieeffects
	guts JIBS1 1
  guts JIBS3 2
  guts JIBS4 1
  guts JIBS5 1
  guts JIBS6 2
  guts DUKETORSO 1
  guts DUKELEG 2
  guts DUKEGUN 1
	sound SQUISHED
	sound DUKE_DEAD
ends

state respawnfromautorevive
	state loseperks
	subvar autorevivetimer 1
	setactor[THISACTOR].extra 500 //God mode hp
	setvar showoverlay 0
ends

state respawnfromplayerrevive
	state loseperks
	setactor[THISACTOR].extra playerhealth
	sound DUKE_GOTHEALTHATLOW
	setvar showoverlay 0
ends

state endgame
	ifvare eog 1 {
		//TODO
	}
ends

state handlemonsterdrops
	ifvarg nucleartimer 0 subvar nucleartimer 1
	ifvarg maxammotimer 0 subvar maxammotimer 1
	ifvarg instakilltimer 0 subvar instakilltimer 1
	ifvarg moneyfesttimer 0 subvar moneyfesttimer 1
	ifvarg infinityammotimer 0 subvar infinityammotimer 1
	ifvarg moneyfestshowtimer 0 subvar moneyfestshowtimer 1
	ifvarg moneyfromdroptimer 0 subvar moneyfromdroptimer 1
	ifvarg instakillduration 0 subvar instakillduration 1
	ifvarg moneyfestduration 0 subvar moneyfestduration 1
	ifvarg infinityammoduration 0 subvar infinityammoduration 1
	ifp palive {
		//NUCLEAR
		ifvare nuclear 1 {
			setvar nuclear 0
			setvar nucleartimer 60
			palfrom 64 64 64 0
			sound 9
		}
		//MAXAMMO
		ifvare maxammo 1 {
			ifvare infinityammoduration 0 {
				setvar maxammo 0
				setvar maxammotimer 60
				palfrom 20 0 64 0
				sound 297
				getplayer[THISACTOR].max_ammo_amount primaryweapon temp
				setplayer[THISACTOR].ammo_amount primaryweapon temp
				getplayer[THISACTOR].max_ammo_amount secondaryweapon temp
				setplayer[THISACTOR].ammo_amount secondaryweapon temp
				getplayer[THISACTOR].max_ammo_amount tertiaryweapon temp
				setplayer[THISACTOR].ammo_amount tertiaryweapon temp
			}
		}
		//INSTAKILL
		ifvare instakill 1 {
			setvar instakill 0
			setvar instakilltimer 60
			setvar instakillduration 450
			sound 195
			sound 84
		}
		//MONEYFEST
		ifvare moneyfest 1 {
			setvar moneyfest 0
			setvar moneyfesttimer 60
			setvar moneyfestduration 450
			sound 195
			sound 84
		} else {
			ifvare moneyfestduration 1 {
				setvarvar moneyfrommoneyfestshow moneyfrommoneyfest
				setvar moneyfrommoneyfest 0
				setvar moneyfestshowtimer 60
			}
		}
		//INFINITYAMMO
		ifvare infinityammo 1 {
			getplayer[THISACTOR].ammo_amount 1 temp
			addvar temp 1
			setplayer[THISACTOR].ammo_amount 1 temp
			getplayer[THISACTOR].ammo_amount 2 temp
			addvar temp 1
			setplayer[THISACTOR].ammo_amount 2 temp
			getplayer[THISACTOR].ammo_amount 3 temp
			addvar temp 1
			setplayer[THISACTOR].ammo_amount 3 temp
			getplayer[THISACTOR].ammo_amount 4 temp
			addvar temp 1
			setplayer[THISACTOR].ammo_amount 4 temp
			getplayer[THISACTOR].ammo_amount 5 temp
			addvar temp 1
			setplayer[THISACTOR].ammo_amount 5 temp
			getplayer[THISACTOR].ammo_amount 6 temp
			addvar temp 1
			setplayer[THISACTOR].ammo_amount 6 temp
			getplayer[THISACTOR].ammo_amount 7 temp
			addvar temp 1
			setplayer[THISACTOR].ammo_amount 7 temp
			getplayer[THISACTOR].ammo_amount 8 temp
			addvar temp 1
			setplayer[THISACTOR].ammo_amount 8 temp
			getplayer[THISACTOR].ammo_amount 9 temp
			addvar temp 1
			setplayer[THISACTOR].ammo_amount 9 temp
			getplayer[THISACTOR].ammo_amount 11 temp
			addvar temp 1
			setplayer[THISACTOR].ammo_amount 11 temp
			getplayer[THISACTOR].ammo_amount 1 ammoamountone
			getplayer[THISACTOR].ammo_amount 2 ammoamounttwo
			getplayer[THISACTOR].ammo_amount 3 ammoamountthree
			getplayer[THISACTOR].ammo_amount 4 ammoamountfour
			getplayer[THISACTOR].ammo_amount 5 ammoamountfive
			getplayer[THISACTOR].ammo_amount 6 ammoamountsix
			getplayer[THISACTOR].ammo_amount 7 ammoamountseven
			getplayer[THISACTOR].ammo_amount 8 ammoamounteight
			getplayer[THISACTOR].ammo_amount 9 ammoamountnine
			getplayer[THISACTOR].ammo_amount 11 ammoamounteleven
			setvar infinityammo 0
			setvar infinityammotimer 60
			setvar infinityammoduration 450
			sound 195
			sound 84
		} else {
			ifvarg infinityammoduration 0 {
				setplayer[THISACTOR].ammo_amount 1 ammoamountone
				setplayer[THISACTOR].ammo_amount 2 ammoamounttwo
				setplayer[THISACTOR].ammo_amount 3 ammoamountthree
				setplayer[THISACTOR].ammo_amount 4 ammoamountfour
				setplayer[THISACTOR].ammo_amount 5 ammoamountfive
				setplayer[THISACTOR].ammo_amount 6 ammoamountsix
				setplayer[THISACTOR].ammo_amount 7 ammoamountseven
				setplayer[THISACTOR].ammo_amount 8 ammoamounteight
				setplayer[THISACTOR].ammo_amount 9 ammoamountnine
				setplayer[THISACTOR].ammo_amount 11 ammoamounteleven
				ifvare infinityammoduration 1 {
					subvar ammoamountone 1
					subvar ammoamounttwo 1
					subvar ammoamountthree 1
					subvar ammoamountfour 1
					subvar ammoamountfive 1
					subvar ammoamountsix 1
					subvar ammoamountseven 1
					subvar ammoamounteight 1
					subvar ammoamountnine 1
					subvar ammoamounteleven 1
					setplayer[THISACTOR].ammo_amount 1 ammoamountone
					setplayer[THISACTOR].ammo_amount 2 ammoamounttwo
					setplayer[THISACTOR].ammo_amount 3 ammoamountthree
					setplayer[THISACTOR].ammo_amount 4 ammoamountfour
					setplayer[THISACTOR].ammo_amount 5 ammoamountfive
					setplayer[THISACTOR].ammo_amount 6 ammoamountsix
					setplayer[THISACTOR].ammo_amount 7 ammoamountseven
					setplayer[THISACTOR].ammo_amount 8 ammoamounteight
					setplayer[THISACTOR].ammo_amount 9 ammoamountnine
					setplayer[THISACTOR].ammo_amount 11 ammoamounteleven
				}
			}
		}
	} else {
		setvar nuclear 0
		setvar maxammo 0
		setvar instakill 0
		setvar infinityammo 0
	}
ends

state buyandsetcd
	subvarvar moneyused itemcost
	setvar moneyusedcounter 60
	subvarvar finalplayermoney itemcost
	addvarvar moneyspent itemcost
	setvarvar buycooldown buycooldownvar
	getactor[HITSPRITE].picnum temp
	ifvare temp APLAYER palfrom 20 0 0 64
	else palfrom 20 0 64 0
ends

state buyandsetcdammo
	sound 297
	subvarvar moneyused itemcost
	setvar moneyusedcounter 60
	subvarvar finalplayermoney itemcost
	addvarvar moneyspent itemcost
	setvarvar buycooldown buycooldownvar
	getactor[HITSPRITE].picnum temp
	ifvare temp APLAYER palfrom 20 0 0 64
	else palfrom 20 0 64 0
ends

state movementspeed
	ifvarg haltcounter 0 {
		setplayer[THISACTOR].runspeed haltrunspeed
		subvar haltcounter 1
	} else setplayer[THISACTOR].runspeed playerrunspeed
ends

state manualreload
	getplayer[THISACTOR].curr_weapon PWEAPON // the player's current weapon
  getplayer[THISACTOR].kickback_pic KICKBACK // the frame of animation the player's weapon is at
  getplayer[THISACTOR].ammo_amount 1 PISTOLAMMO // the player's pistol ammo
  
  ifvare PWEAPON 1 // if the player has the pistol selected...
  {
    ifvarl PISTOLMAGAZINE 1 // and his magazine count is at zero...
    {
      getplayer[THISACTOR].weapon_pos PERPLAYER1
      
      ifvarn PERPLAYER1 0
        break // if he has a weapon that's lowering off screen, break
      else ifvarl PISTOLAMMO 2
        break
      else // otherwise, if he has ammo for the pistol, start the reloading anim
      {
        setplayer[THISACTOR].reloading 1
        setplayer[THISACTOR].kickback_pic 4
      }
    }
      
    ifvare KICKBACK 5 // if the reloading animation is on its second frame...
    {
      ifvarg PISTOLAMMO 12 // if the player has at least twelve pistol rounds left,
        setvar PISTOLMAGAZINE 12 // then set his magazine counter to a full magazine
      else {
      	subvar PISTOLAMMO 1
        setvarvar PISTOLMAGAZINE PISTOLAMMO // otherwise set the magazine counter equal to his remaining ammo
      }
    }
  }
ends

state preventoddammoamount
	getplayer[THISACTOR].ammo_amount 1 temp
	ifvare temp 0 addammo 1 1
	getplayer[THISACTOR].max_ammo_amount 1 temptwo
	ifvarvarg temp temptwo
	setplayer[THISACTOR].ammo_amount 1 temptwo
	getplayer[THISACTOR].ammo_amount 2 temp
	ifvare temp 0 addammo 2 1
	getplayer[THISACTOR].max_ammo_amount 2 temptwo
	ifvarvarg temp temptwo
	setplayer[THISACTOR].ammo_amount 2 temptwo
	getplayer[THISACTOR].ammo_amount 3 temp
	ifvare temp 0 addammo 3 1
	getplayer[THISACTOR].max_ammo_amount 3 temptwo
	ifvarvarg temp temptwo
	setplayer[THISACTOR].ammo_amount 3 temptwo
	getplayer[THISACTOR].ammo_amount 4 temp
	ifvare temp 0 addammo 4 1
	getplayer[THISACTOR].max_ammo_amount 4 temptwo
	ifvarvarg temp temptwo
	setplayer[THISACTOR].ammo_amount 4 temptwo
	getplayer[THISACTOR].ammo_amount 5 temp
	ifvare temp 0 addammo 5 1
	getplayer[THISACTOR].max_ammo_amount 5 temptwo
	ifvarvarg temp temptwo
	setplayer[THISACTOR].ammo_amount 5 temptwo
	getplayer[THISACTOR].ammo_amount 6 temp
	ifvare temp 0 addammo 6 1
	getplayer[THISACTOR].max_ammo_amount 6 temptwo
	ifvarvarg temp temptwo
	setplayer[THISACTOR].ammo_amount 6 temptwo
	getplayer[THISACTOR].ammo_amount 7 temp
	ifvare temp 0 addammo 7 1
	getplayer[THISACTOR].max_ammo_amount 7 temptwo
	ifvarvarg temp temptwo
	setplayer[THISACTOR].ammo_amount 7 temptwo
	getplayer[THISACTOR].ammo_amount 8 temp
	ifvare temp 0 addammo 8 1
	getplayer[THISACTOR].max_ammo_amount 8 temptwo
	ifvarvarg temp temptwo
	setplayer[THISACTOR].ammo_amount 8 temptwo
	getplayer[THISACTOR].ammo_amount 9 temp
	ifvare temp 0 addammo 9 1
	getplayer[THISACTOR].max_ammo_amount 9 temptwo
	ifvarvarg temp temptwo
	setplayer[THISACTOR].ammo_amount 9 temptwo
ends

state showinformation
	ifvarn HITSPRITE -1 {
		dist temp THISACTOR HITSPRITE
		ifvarl temp 1200 {
			getactor[HITSPRITE].picnum temptwo
			ifvare temptwo FIRSTGUNSPRITE setvarvar itemcost pistolcost 
			else ifvare temptwo SHOTGUNSPRITE setvarvar itemcost shotguncost
			else ifvare temptwo CHAINGUNSPRITE setvarvar itemcost chainguncost
			else ifvare temptwo RPGSPRITE setvarvar itemcost rpgcost
			else ifvare temptwo HBOMBAMMO setvarvar itemcost pipebombcost
			else ifvare temptwo SHRINKERSPRITE setvarvar itemcost shrinkercost
			else ifvare temptwo GROWSPRITEICON setvarvar itemcost expandercost
			else ifvare temptwo DEVISTATORSPRITE setvarvar itemcost devistatorcost
			else ifvare temptwo TRIPBOMBSPRITE setvarvar itemcost tripbombcost
			else ifvare temptwo FREEZESPRITE setvarvar itemcost freezercost
			else ifvare temptwo BOOTS setvarvar itemcost bootscost
			else ifvare temptwo JETPACK setvarvar itemcost backpackcost
			else ifvare temptwo HOLODUKE setvarvar itemcost autorevivecost
			else ifvare temptwo SHIELD setvarvar itemcost armorcost
			else ifvare temptwo 1234 setvarvar itemcost moneymultipliercost
			else ifvare temptwo 1667 setvarvar itemcost instakillcost
			else ifvare temptwo 4371 setvarvar itemcost perkprotectercost
			else ifvare temptwo ACCESSCARD setvarvar itemcost accesscardcost
			else ifvare temptwo AMMO setvarvar itemcost bigmagcost
			
			setvarvar tempfive finalplayermoney
			addvarvar tempfive playermoney
			addvarvar tempfive playermoneybonus
			getactor[HITSPRITE].hitag tempsix
			switch temptwo
				case ACCESSSWITCH2 {
					getactor[HITSPRITE].pal temp
					ifvare temp 0 gametextz STARTALPHANUM 320 125 130 0 0 0 0 0 xdim ydim 50000
					ifvare temp 21 gametextz STARTALPHANUM 320 125 131 0 0 0 0 0 xdim ydim 50000
					ifvare temp 23 gametextz STARTALPHANUM 320 125 132 0 0 0 0 0 xdim ydim 50000
					break
				}
				case ACCESSCARD {
					getactor[HITSPRITE].pal temp
					ifvare temp 0 gametextz STARTALPHANUM 320 125 133 0 0 0 0 0 xdim ydim 50000
					ifvare temp 21 gametextz STARTALPHANUM 320 125 134 0 0 0 0 0 xdim ydim 50000
					ifvare temp 23 gametextz STARTALPHANUM 320 125 135 0 0 0 0 0 xdim ydim 50000
					ifvarvarl tempfive itemcost digitalnumberz 2837 160 135 itemcost 0 2 0 0 0 xdim ydim 50000
					else digitalnumberz 2837 160 135 itemcost 0 0 0 0 0 xdim ydim 50000
					break
				}
				case FIRSTGUNSPRITE {
					
					setvar temp 1 //weaponspecific index for state beneath
					state showweaponorammofix
					ifvare temptwo 1 {
						gametextz STARTALPHANUM 320 125 157 0 0 0 0 0 xdim ydim 50000
						divvar itemcost 4
						ifvare tempsix 0 gametextz STARTALPHANUM 320 135 179 0 0 0 0 0 xdim ydim 50000
						else ifvarvarl tempfive itemcost digitalnumberz 2837 160 135 itemcost 0 2 0 0 0 xdim ydim 50000
						else digitalnumberz 2837 160 135 itemcost 0 0 0 0 0 xdim ydim 50000
					} else {
						gametextz STARTALPHANUM 320 125 136 0 0 0 0 0 xdim ydim 50000 //Weaponspecifik quote
						ifvare tempsix 0 gametextz STARTALPHANUM 320 135 179 0 0 0 0 0 xdim ydim 50000
						else ifvarvarl tempfive itemcost digitalnumberz 2837 160 135 itemcost 0 2 0 0 0 xdim ydim 50000
						else digitalnumberz 2837 160 135 itemcost 0 0 0 0 0 xdim ydim 50000
					}
					break
				}
				case SHOTGUNSPRITE {
					setvar temp 2 //weaponspecific index for state beneath
					state showweaponorammofix
					ifvare temptwo 1 {
						gametextz STARTALPHANUM 320 125 157 0 0 0 0 0 xdim ydim 50000
						divvar itemcost 4
						ifvare tempsix 0 gametextz STARTALPHANUM 320 135 179 0 0 0 0 0 xdim ydim 50000
						else ifvarvarl tempfive itemcost digitalnumberz 2837 160 135 itemcost 0 2 0 0 0 xdim ydim 50000
						else digitalnumberz 2837 160 135 itemcost 0 0 0 0 0 xdim ydim 50000
					} else {
						gametextz STARTALPHANUM 320 125 137 0 0 0 0 0 xdim ydim 50000 //Weaponspecifik quote
						ifvare tempsix 0 gametextz STARTALPHANUM 320 135 179 0 0 0 0 0 xdim ydim 50000
						else ifvarvarl tempfive itemcost digitalnumberz 2837 160 135 itemcost 0 2 0 0 0 xdim ydim 50000
						else digitalnumberz 2837 160 135 itemcost 0 0 0 0 0 xdim ydim 50000
					}
					break
				}
				case CHAINGUNSPRITE {
					setvar temp 3 //weaponspecific index for state beneath
					state showweaponorammofix
					ifvare temptwo 1 {
						gametextz STARTALPHANUM 320 125 157 0 0 0 0 0 xdim ydim 50000
						divvar itemcost 4
						ifvare tempsix 0 gametextz STARTALPHANUM 320 135 179 0 0 0 0 0 xdim ydim 50000
						else ifvarvarl tempfive itemcost digitalnumberz 2837 160 135 itemcost 0 2 0 0 0 xdim ydim 50000
						else digitalnumberz 2837 160 135 itemcost 0 0 0 0 0 xdim ydim 50000
					} else {
						gametextz STARTALPHANUM 320 125 138 0 0 0 0 0 xdim ydim 50000 //Weaponspecifik quote
						ifvare tempsix 0 gametextz STARTALPHANUM 320 135 179 0 0 0 0 0 xdim ydim 50000
						else ifvarvarl tempfive itemcost digitalnumberz 2837 160 135 itemcost 0 2 0 0 0 xdim ydim 50000
						else digitalnumberz 2837 160 135 itemcost 0 0 0 0 0 xdim ydim 50000
					}
					break
				}
				case RPGSPRITE {
					setvar temp 4 //weaponspecific index for state beneath
					state showweaponorammofix
					ifvare temptwo 1 {
						gametextz STARTALPHANUM 320 125 157 0 0 0 0 0 xdim ydim 50000
						divvar itemcost 4
						ifvare tempsix 0 gametextz STARTALPHANUM 320 135 179 0 0 0 0 0 xdim ydim 50000
						else ifvarvarl tempfive itemcost digitalnumberz 2837 160 135 itemcost 0 2 0 0 0 xdim ydim 50000
						else digitalnumberz 2837 160 135 itemcost 0 0 0 0 0 xdim ydim 50000
					} else {
						gametextz STARTALPHANUM 320 125 139 0 0 0 0 0 xdim ydim 50000 //Weaponspecifik quote
						ifvare tempsix 0 gametextz STARTALPHANUM 320 135 179 0 0 0 0 0 xdim ydim 50000
						else ifvarvarl tempfive itemcost digitalnumberz 2837 160 135 itemcost 0 2 0 0 0 xdim ydim 50000
						else digitalnumberz 2837 160 135 itemcost 0 0 0 0 0 xdim ydim 50000
					}
					break
				}
				case HBOMBAMMO {
					setvar temp 5 //weaponspecific index for state beneath
					state showweaponorammofix
					ifvare temptwo 1 {
						gametextz STARTALPHANUM 320 125 157 0 0 0 0 0 xdim ydim 50000
						divvar itemcost 4
						ifvare tempsix 0 gametextz STARTALPHANUM 320 135 179 0 0 0 0 0 xdim ydim 50000
						else ifvarvarl tempfive itemcost digitalnumberz 2837 160 135 itemcost 0 2 0 0 0 xdim ydim 50000
						else digitalnumberz 2837 160 135 itemcost 0 0 0 0 0 xdim ydim 50000
					} else {
						gametextz STARTALPHANUM 320 125 140 0 0 0 0 0 xdim ydim 50000 //Weaponspecifik quote
						ifvare tempsix 0 gametextz STARTALPHANUM 320 135 179 0 0 0 0 0 xdim ydim 50000
						else ifvarvarl tempfive itemcost digitalnumberz 2837 160 135 itemcost 0 2 0 0 0 xdim ydim 50000
						else digitalnumberz 2837 160 135 itemcost 0 0 0 0 0 xdim ydim 50000
					}
					break
				}
				case SHRINKERSPRITE {
					setvar temp 6 //weaponspecific index for state beneath
					state showweaponorammofix
					ifvare temptwo 1 {
						gametextz STARTALPHANUM 320 125 157 0 0 0 0 0 xdim ydim 50000
						divvar itemcost 4
						ifvare tempsix 0 gametextz STARTALPHANUM 320 135 179 0 0 0 0 0 xdim ydim 50000
						else ifvarvarl tempfive itemcost digitalnumberz 2837 160 135 itemcost 0 2 0 0 0 xdim ydim 50000
						else digitalnumberz 2837 160 135 itemcost 0 0 0 0 0 xdim ydim 50000
					} else {
						gametextz STARTALPHANUM 320 125 141 0 0 0 0 0 xdim ydim 50000 //Weaponspecifik quote
						ifvare tempsix 0 gametextz STARTALPHANUM 320 135 179 0 0 0 0 0 xdim ydim 50000
						else ifvarvarl tempfive itemcost digitalnumberz 2837 160 135 itemcost 0 2 0 0 0 xdim ydim 50000
						else digitalnumberz 2837 160 135 itemcost 0 0 0 0 0 xdim ydim 50000
					}
					break
				}
				case GROWSPRITEICON {
					setvar temp 11 //weaponspecific index for state beneath
					state showweaponorammofix
					ifvare temptwo 1 {
						gametextz STARTALPHANUM 320 125 157 0 0 0 0 0 xdim ydim 50000
						divvar itemcost 4
						ifvare tempsix 0 gametextz STARTALPHANUM 320 135 179 0 0 0 0 0 xdim ydim 50000
						else ifvarvarl tempfive itemcost digitalnumberz 2837 160 135 itemcost 0 2 0 0 0 xdim ydim 50000
						else digitalnumberz 2837 160 135 itemcost 0 0 0 0 0 xdim ydim 50000
					} else {
						gametextz STARTALPHANUM 320 125 142 0 0 0 0 0 xdim ydim 50000 //Weaponspecifik quote
						ifvare tempsix 0 gametextz STARTALPHANUM 320 135 179 0 0 0 0 0 xdim ydim 50000
						else ifvarvarl tempfive itemcost digitalnumberz 2837 160 135 itemcost 0 2 0 0 0 xdim ydim 50000
						else digitalnumberz 2837 160 135 itemcost 0 0 0 0 0 xdim ydim 50000
					}
					break
				}
				case DEVISTATORSPRITE {
					setvar temp 7 //weaponspecific index for state beneath
					state showweaponorammofix
					ifvare temptwo 1 {
						gametextz STARTALPHANUM 320 125 157 0 0 0 0 0 xdim ydim 50000
						divvar itemcost 4
						ifvare tempsix 0 gametextz STARTALPHANUM 320 135 179 0 0 0 0 0 xdim ydim 50000
						else ifvarvarl tempfive itemcost digitalnumberz 2837 160 135 itemcost 0 2 0 0 0 xdim ydim 50000
						else digitalnumberz 2837 160 135 itemcost 0 0 0 0 0 xdim ydim 50000
					} else {
						gametextz STARTALPHANUM 320 125 143 0 0 0 0 0 xdim ydim 50000 //Weaponspecifik quote
						ifvare tempsix 0 gametextz STARTALPHANUM 320 135 179 0 0 0 0 0 xdim ydim 50000
						else ifvarvarl tempfive itemcost digitalnumberz 2837 160 135 itemcost 0 2 0 0 0 xdim ydim 50000
						else digitalnumberz 2837 160 135 itemcost 0 0 0 0 0 xdim ydim 50000
					}
					break
				}
				case TRIPBOMBSPRITE {
					setvar temp 8 //weaponspecific index for state beneath
					state showweaponorammofix
					ifvare temptwo 1 {
						gametextz STARTALPHANUM 320 125 157 0 0 0 0 0 xdim ydim 50000
						divvar itemcost 4
						ifvare tempsix 0 gametextz STARTALPHANUM 320 135 179 0 0 0 0 0 xdim ydim 50000
						else ifvarvarl tempfive itemcost digitalnumberz 2837 160 135 itemcost 0 2 0 0 0 xdim ydim 50000
						else digitalnumberz 2837 160 135 itemcost 0 0 0 0 0 xdim ydim 50000
					} else {
						gametextz STARTALPHANUM 320 125 144 0 0 0 0 0 xdim ydim 50000 //Weaponspecifik quote
						ifvare tempsix 0 gametextz STARTALPHANUM 320 135 179 0 0 0 0 0 xdim ydim 50000
						else ifvarvarl tempfive itemcost digitalnumberz 2837 160 135 itemcost 0 2 0 0 0 xdim ydim 50000
						else digitalnumberz 2837 160 135 itemcost 0 0 0 0 0 xdim ydim 50000
					}
					break
				}
				case FREEZESPRITE {
					setvar temp 9 //weaponspecific index for state beneath
					state showweaponorammofix
					ifvare temptwo 1 {
						gametextz STARTALPHANUM 320 125 157 0 0 0 0 0 xdim ydim 50000
						divvar itemcost 4
						ifvare tempsix 0 gametextz STARTALPHANUM 320 135 179 0 0 0 0 0 xdim ydim 50000
						else ifvarvarl tempfive itemcost digitalnumberz 2837 160 135 itemcost 0 2 0 0 0 xdim ydim 50000
						else digitalnumberz 2837 160 135 itemcost 0 0 0 0 0 xdim ydim 50000
					} else {
						gametextz STARTALPHANUM 320 125 145 0 0 0 0 0 xdim ydim 50000 //Weaponspecifik quote
						ifvare tempsix 0 gametextz STARTALPHANUM 320 135 179 0 0 0 0 0 xdim ydim 50000
						else ifvarvarl tempfive itemcost digitalnumberz 2837 160 135 itemcost 0 2 0 0 0 xdim ydim 50000
						else digitalnumberz 2837 160 135 itemcost 0 0 0 0 0 xdim ydim 50000
					}
					break
				}
				case JETPACK {
					gametextz STARTALPHANUM 320 125 146 0 0 0 0 0 xdim ydim 50000
					ifvare gotbackpack 1 gametextz STARTALPHANUM 320 135 151 0 0 0 0 0 xdim ydim 50000
					else ifvare tempsix 0 gametextz STARTALPHANUM 320 135 179 0 0 0 0 0 xdim ydim 50000
					else ifvarvarl tempfive itemcost digitalnumberz 2837 160 135 itemcost 0 2 0 0 0 xdim ydim 50000
					else digitalnumberz 2837 160 135 itemcost 0 0 0 0 0 xdim ydim 50000
					break
				}
				case SHIELD {
					gametextz STARTALPHANUM 320 125 147 0 0 0 0 0 xdim ydim 50000
					ifvare gotarmor 1 gametextz STARTALPHANUM 320 135 151 0 0 0 0 0 xdim ydim 50000
					else ifvare tempsix 0 gametextz STARTALPHANUM 320 135 179 0 0 0 0 0 xdim ydim 50000
					else ifvarvarl tempfive itemcost digitalnumberz 2837 160 135 itemcost 0 2 0 0 0 xdim ydim 50000
					else digitalnumberz 2837 160 135 itemcost 0 0 0 0 0 xdim ydim 50000
					break
				}
				/*
				case BOOTS {
					gametextz STARTALPHANUM 320 125 148 0 0 0 0 0 xdim ydim 50000
					ifvare gotboots 1 gametextz STARTALPHANUM 320 135 151 0 0 0 0 0 xdim ydim 50000
					else ifvare tempsix 0 gametextz STARTALPHANUM 320 135 179 0 0 0 0 0 xdim ydim 50000
					else ifvarvarl tempfive itemcost digitalnumberz 2837 160 135 itemcost 0 2 0 0 0 xdim ydim 50000
					else digitalnumberz 2837 160 135 itemcost 0 0 0 0 0 xdim ydim 50000
					break
				}*/
				case 4371 {
					gametextz STARTALPHANUM 320 125 150 0 0 0 0 0 xdim ydim 50000
					ifvare gotperkprotection 1 gametextz STARTALPHANUM 320 135 151 0 0 0 0 0 xdim ydim 50000
					else ifvare tempsix 0 gametextz STARTALPHANUM 320 135 179 0 0 0 0 0 xdim ydim 50000
					else ifvarvarl tempfive itemcost digitalnumberz 2837 160 135 itemcost 0 2 0 0 0 xdim ydim 50000
					else digitalnumberz 2837 160 135 itemcost 0 0 0 0 0 xdim ydim 50000
					break
				}
				case 1667 {
					gametextz STARTALPHANUM 320 125 152 0 0 0 0 0 xdim ydim 50000
					ifvare gotpowershot 1 gametextz STARTALPHANUM 320 135 151 0 0 0 0 0 xdim ydim 50000
					else ifvare tempsix 0 gametextz STARTALPHANUM 320 135 179 0 0 0 0 0 xdim ydim 50000
					else ifvarvarl tempfive itemcost digitalnumberz 2837 160 135 itemcost 0 2 0 0 0 xdim ydim 50000
					else digitalnumberz 2837 160 135 itemcost 0 0 0 0 0 xdim ydim 50000
					break
				}
				case 1234 {
					gametextz STARTALPHANUM 320 125 153 0 0 0 0 0 xdim ydim 50000
					ifvare gotdoublemoney 1 gametextz STARTALPHANUM 320 135 151 0 0 0 0 0 xdim ydim 50000
					else ifvare tempsix 0 gametextz STARTALPHANUM 320 135 179 0 0 0 0 0 xdim ydim 50000
					else ifvarvarl tempfive itemcost digitalnumberz 2837 160 135 itemcost 0 2 0 0 0 xdim ydim 50000
					else digitalnumberz 2837 160 135 itemcost 0 0 0 0 0 xdim ydim 50000
					break
				}
				case HOLODUKE {
					gametextz STARTALPHANUM 320 125 176 0 0 0 0 0 xdim ydim 50000
					ifvare gotautorevive 1 gametextz STARTALPHANUM 320 135 151 0 0 0 0 0 xdim ydim 50000
					else ifvare tempsix 0 gametextz STARTALPHANUM 320 135 179 0 0 0 0 0 xdim ydim 50000
					else ifvarvarl tempfive itemcost digitalnumberz 2837 160 135 itemcost 0 2 0 0 0 xdim ydim 50000
					else digitalnumberz 2837 160 135 itemcost 0 0 0 0 0 xdim ydim 50000
					break
				}
				case AMMO {
					gametextz STARTALPHANUM 320 125 189 0 0 0 0 0 xdim ydim 50000
					ifvare gotbigmag 1 gametextz STARTALPHANUM 320 135 151 0 0 0 0 0 xdim ydim 50000
					else ifvare tempsix 0 gametextz STARTALPHANUM 320 135 179 0 0 0 0 0 xdim ydim 50000
					else ifvarvarl tempfive itemcost digitalnumberz 2837 160 135 itemcost 0 2 0 0 0 xdim ydim 50000
					else digitalnumberz 2837 160 135 itemcost 0 0 0 0 0 xdim ydim 50000
					break
				}
				case APLAYER {
					getactor[HITSPRITE].extra tempfour
					ifvarg tempfour 0 {
						gametextz STARTALPHANUM 320 125 149 0 0 0 0 0 xdim ydim 50000
						ifvarg tempfive 149 digitalnumberz 2837 160 135 150 0 0 0 0 0 xdim ydim 50000
						else digitalnumberz 2837 160 135 150 0 2 0 0 0 xdim ydim 50000
					} else {
						getactor[HITSPRITE].yvel temp
						getplayervar[temp].isdead temptwo
						ifvare temptwo 0 ifvare revivetimer 0 gametextz STARTALPHANUM 320 125 183 0 2 0 0 0 xdim ydim 50000
					}
					break
				}
				case BIGQ {
					gametextz STARTALPHANUM 320 125 184 0 0 0 0 0 xdim ydim 50000
					ifvarvarl tempfive mysteryboxcost digitalnumberz 2837 160 135 mysteryboxcost 0 2 0 0 0 xdim ydim 50000
					else digitalnumberz 2837 160 135 mysteryboxcost 0 0 0 0 0 xdim ydim 50000
					break
				}
				default break
			endswitch
		}
  }
ends

state keycardaccess
	getplayer[THISACTOR].access_spritenum accessspritenum
	setvar temp -1
	ifvarn accessspritenum -1 getactor[accessspritenum].pal temp
	ifvare temp 0 setvar accesstoblue 1
	ifvare temp 21 setvar accesstored 1
	ifvare temp 23 setvar accesstoyellow 1
ends

state generatemonster
	ifactor GETICON ifvare havecountedspawner 0 {
		setvar havecountedspawner 1
		addvar activespawners 1
	}
	ifvare intermission 0 {
		ifvarg monsterslefttospawn 0 {
			ifvarvarl monstersalive maxmonstersallowed {
				ifvarvarg spawncounter spawnrate {
					ifactor GETICON {				
						randvarvar temp activespawners
			  		ifvare temp 0 {
			  			ifvare monstertype 1 spawn NEWBEAST //Normal
			  			ifvare monstertype 2 spawn NEWBEAST //Rush round
			  			subvar monsterslefttospawn 1
			  			addvar spawnedthisiteration 1
			  		}
					}
				} else {
					addvar spawncounter 1
				}
			}
		}
	}
ends

/*
state generatemonster
	ifactor GETICON ifvare havecountedspawner 0 {
		setvar havecountedspawner 1
		addvar activespawners 1
	}
	ifvare intermission 0 {
		ifvarg monsterslefttospawn 0 {
			ifvarvarl monstersalive maxmonstersallowed {
				ifvarvarg spawncounter spawnrate {
					ifactor GETICON {
						randvar temp 1
			  		ifvare temp 1 {
			  			ifvare monstertype 1 spawn NEWBEAST //Normal
			  			ifvare monstertype 2 spawn NEWBEAST //Rush round
			  			subvar monsterslefttospawn 1
			  		}
					}
		  		setvar spawncounter 0
				} else {
					addvar spawncounter 1
				}
			}
		}
	}
ends
*/

state currentlyearnedmoney
	ifvare moneycounter 0 {
		addvarvar finalplayermoney playermoney
		setvar playermoney 0
	} else subvar moneycounter 1
	ifvare bonusmoneycounter 0 {
		addvarvar finalplayermoney playermoneybonus
		setvar playermoneybonus 0
	} else subvar bonusmoneycounter 1
	ifvare moneyusedcounter 0 {
		setvar moneyused 0
	} else subvar moneyusedcounter 1
ends

state dostuffonkill
	getactor[THISACTOR].htowner temp
  getactor[temp].yvel temptwo
  getplayervar[temptwo].totalkills tempthree
  addvar tempthree 1
  setplayervar[temptwo].totalkills tempthree
  getplayervar[temptwo].bonusmoneyonkills tempfive
  getplayervar[temptwo].playermoneybonus tempfour
  addvarvar tempfour tempfive
  setplayervar[temptwo].playermoneybonus tempfour
  setplayervar[temptwo].bonusmoneycounter 60
ends

state nextround
	setvar roundcompletetimer 90
	headspritestat temp 10
  setvarvar temptwo temp
  setvar tempfour 50
  mulvarvar tempfour round //Round bonus
  whilevarn temp -1 {
  	getactor[temp].yvel tempfive
  	getplayervar[tempfive].isdead tempsix //Check if player is not dead
  	ifvare tempsix 0 getplayervar[tempfive].isdown tempsix //or down...
  	ifvare tempsix 0 { //If the player is not dead by the end of the round then add round bonus
  		getplayervar[tempfive].playermoneybonus tempthree
	  	addvarvar tempthree tempfour
	  	setplayervar[tempfive].playermoneybonus tempthree //Money
	  	setplayervar[tempfive].bonusmoneycounter 60
	  	getplayervar[tempfive].bonuses tempthree
	  	addvarvar tempthree tempfour
	  	setplayervar[tempfive].bonuses tempthree
  	}
  	nextspritestat temp temp
  	ifvarvare temp temptwo setvar temp -1
  }
  setvar havespawnedorb 0
	addvar round 1
	state setupround
	setvar intermission 450
ends

state doonce
	ifvare id -1 { //Set id of the first player
		getplayer[THISACTOR].i temp
		getactor[temp].yvel temptwo
		setvarvar id temptwo
	} else ifvare idtwo -1 { //Set id of the second player
		getplayer[THISACTOR].i temp
		getactor[temp].yvel temptwo
		setvarvar idtwo temptwo
	}
	getactor[THISACTOR].yvel temp //For the first player only, do this
	ifvarvare temp id {
		ifvarg intermission 0 subvar intermission 1 //Decrement intermission
		ifvarg roundcompletetimer 0 subvar roundcompletetimer 1 //Decrement roundcompletetimer
		ifvarg rushroundtimer 0 subvar rushroundtimer 1 //Decrement rushroundtimer

		//Calculate amount of spawners on the map
		ifvare spawners -1 {
			setvar spawners 0
			headspritestat temp 1
		  setvarvar temptwo temp
		  whilevarn temp -1 {
		  	getactor[temp].picnum tempthree
		  	ifvare tempthree GETICON addvar spawners 1
		  	nextspritestat temp temp
		  	ifvarvare temp temptwo setvar temp -1
		  }
		}
		ifvarg orbtimer 0 subvar orbtimer 1

		//Calculate total players on the map
		ifvare numberofplayers -1 {
			setvar numberofplayers 0
			headspritestat temp 10
		  setvarvar temptwo temp
		  whilevarn temp -1 {
		  	getactor[temp].picnum tempthree
		  	ifvare tempthree APLAYER addvar numberofplayers 1
		  	nextspritestat temp temp
		  	ifvarvare temp temptwo setvar temp -1
		  }
		}

		//Calculate monsters currently alive
		setvar monstersalive 0
		headspritestat temp 1
	  setvarvar temptwo temp
	  whilevarn temp -1 {
	  	getactor[temp].picnum tempthree
	  	ifvare tempthree NEWBEAST {
	  		getactor[temp].extra tempfour
	  		ifvarg tempfour 0 addvar monstersalive 1
	  	}
	  	nextspritestat temp temp
	  	ifvarvare temp temptwo setvar temp -1
	  }
	  ifvare monsterslefttospawn 0 ifvare monstersalive 0 state nextround

	  //Calculate players not down
	  setvarvar tempsix numberofplayers
	  headspritestat temp 10
	  setvarvar temptwo temp
	  whilevarn temp -1 {
	  	getactor[temp].picnum tempthree
	  	ifvare tempthree APLAYER {
	  		getactor[temp].yvel tempfour
  			getplayervar[tempfour].isdown tempfive
  			subvarvar tempsix tempfive 
	  	}
	  	nextspritestat temp temp
	  	ifvarvare temp temptwo setvar temp -1
	  }
	  ifvarvare tempsix numberofplayers setvar idofdyingduke -1 //All players alive

	  //Calculate players currently alive
		setvarvar playersalive numberofplayers
		headspritestat temp 10
	  setvarvar temptwo temp
	  whilevarn temp -1 {
	  	getactor[temp].picnum tempthree
	  	getactor[temp].yvel tempsix
	  	ifvare tempthree APLAYER {
  			getplayervar[tempsix].isdead tempfour
  			getplayervar[tempsix].isdown tempfive
  			ifvare tempfour 1 { //Check duke is are dead
  				subvar playersalive 1
  			} else ifvare tempfive 1 {
  				subvar playersalive 1
  			}
	  	}
	  	nextspritestat temp temp
	  	ifvarvare temp temptwo setvar temp -1
	  }
	  ifvare playersalive 0 setvar eog 1 //Toggle endofgame

	  //Reset spawncounters when threshold is reached
		ifvarvarg spawnedthisiteration minimumthreshold {
			headspritestat temp 1
		  setvarvar temptwo temp
		  whilevarn temp -1 {
		  	getactor[temp].picnum tempthree
		  	ifvare tempthree GETICON {
	  			setactorvar[temp].spawncounter 0
		  	}
		  	nextspritestat temp temp
			}
			setvar spawnedthisiteration 0
			//Reset players spawncount too
			headspritestat temp 10
		  setvarvar temptwo temp
		  whilevarn temp -1 {
		  	getactor[temp].picnum tempthree
		  	ifvare tempthree APLAYER {
	  			setactorvar[temp].spawncounter 0
		  	}
		  	nextspritestat temp temp
			}
		}
	}
ends

state preventhbombpickup
	ifvarn primaryweapon HANDBOMB_WEAPON {
		ifvarn secondaryweapon HANDBOMB_WEAPON {
			ifvarn tertiaryweapon HANDBOMB_WEAPON {
				setplayer[THISACTOR].ammo_amount HANDBOMB_WEAPON 1
				setplayer[THISACTOR].gotweapon HANDBOMB_WEAPON 0
			}
		}
	}
ends

state handlenegativeammodevastator
	getplayer[THISACTOR].ammo_amount DEVISTATOR_WEAPON temp
	ifvare temp 0 setplayer[THISACTOR].ammo_amount DEVISTATOR_WEAPON 1
ends

state handlemaxammo
	setvarvar temptwo ammomultiplier
	ifvare gotbigmag 1 addvar temptwo 4

	setvar temp MAXPISTOLAMMO
	mulvarvar temp temptwo 
	addvar temp 1
	setplayer[THISACTOR].max_ammo_amount 1 temp
	setvar temp MAXSHOTGUNAMMO
	mulvarvar temp temptwo
	addvar temp 1
	setplayer[THISACTOR].max_ammo_amount 2 temp
	setvar temp MAXCHAINGUNAMMO
	mulvarvar temp temptwo
	addvar temp 1
	setplayer[THISACTOR].max_ammo_amount 3 temp
	setvar temp MAXRPGAMMO
	mulvarvar temp temptwo
	addvar temp 1
	setplayer[THISACTOR].max_ammo_amount 4 temp
	setvar temp MAXHANDBOMBAMMO
	mulvarvar temp temptwo
	addvar temp 1
	setplayer[THISACTOR].max_ammo_amount 5 temp
	setvar temp MAXSHRINKERAMMO
	mulvarvar temp temptwo
	addvar temp 1
	setplayer[THISACTOR].max_ammo_amount 6 temp
	setvar temp MAXGROWAMMO
	mulvarvar temp temptwo
	addvar temp 1
	setplayer[THISACTOR].max_ammo_amount 11 temp
	setvar temp MAXDEVISTATORAMMO
	mulvarvar temp temptwo
	addvar temp 1
	setplayer[THISACTOR].max_ammo_amount 7 temp
	setvar temp MAXFREEZEAMMO
	mulvarvar temp temptwo
	addvar temp 1
	setplayer[THISACTOR].max_ammo_amount 9 temp
	setvar temp MAXTRIPBOMBAMMO
	mulvarvar temp temptwo
	addvar temp 1    
	setplayer[THISACTOR].max_ammo_amount 8 temp

ends

state jumpheight
	getplayer[THISACTOR].jumping_counter temp
	ifvare temp 541	setplayer[THISACTOR].jumping_counter 0
ends

state nofalldmg
	getplayer[THISACTOR].falling_counter temp
	ifvarg temp 7 // not 8, because there's a slim chance the number won't set properly in time
	{
  	setvar temp 7 // any value under 9 does no damage
  	setplayer[THISACTOR].falling_counter temp
	}
ends

state hpregen 
	ifvare hpregencounter 0 {
		ifcount 4 {
			addphealth 1
			resetcount
		}
	} else subvar hpregencounter 1

	getactor[THISACTOR].extra temptwo
	getplayer[THISACTOR].max_player_health tempsix
	mulvar tempsix 2
	divvar tempsix 3
	addvar tempsix 1
	/*
	getplayer[THISACTOR].max_player_health tempthree
	setvarvar tempsix playerhealth
	mulvar tempsix 3
	divvar tempsix 5
	ifvare temptwo 0 nullop
	else ifvarg temptwo 400 palfrom 20 0 0 40
	else ifvarg temptwo 300 palfrom 20 0 0 30
	else ifvarg temptwo 200 palfrom 20 0 0 20
	else ifvarvarg temptwo tempthree palfrom 20 0 0 15
	else ifvarvarg temptwo tempsix nullop // normal screen - duke has 35-50(70) hp
	else ifvarg temptwo 10 palfrom 15 24 0 0
	else ifvarg temptwo 10 ifvarl temptwo 35 palfrom 15 24 0 0
	*/
	ifvarl temptwo 11 { //HP is 10 or less
    ifvarn temptwo 0 {
      ifcount 20 {
      	palfrom 43 30 0 0
        sound 39
        resetcount
      }
    }
  } else ifvarvarl temptwo tempsix {
  	palfrom 15 24 0 0
  } 
ends

state calculatetotalpoints
	setvar temp 0
	addvarvar temp damagedealt
	addvarvar temp moneyspent
	addvarvar temp finalplayermoney
	addvarvar temp playermoney
	addvarvar temp playermoneybonus
	subvar temp 500
	subvarvar temp moneyrecieved
	divvar temp 333
	setvarvar temptwo bonuses
	divvar temptwo 100
	addvarvar temp temptwo
	setvarvar totalpoints temp
ends

state setuplevelsystem
	switch currentlevel
		case 1 {
			setvar experienceneeded 1000
			break
		}
		case 2 {
			setvar experienceneeded 3000
			break
		}
		case 3 {
			setvar experienceneeded 9750
			break
		}
		case 4 {
			setvar experienceneeded 21250
			break
		}
		case 5 {
			setvar experienceneeded 37500
			break
		}
		case 6 {
			setvar experienceneeded 58500
			break
		}
		case 7 {
			setvar experienceneeded 84250
			break
		}
		case 8 {
			setvar experienceneeded 114750
			break
		}
		case 9 {
			setvar experienceneeded 150000
			break
		}
		case 10 {
			setvar experienceneeded 190000
			break
		}
		case 11 {
			setvar experienceneeded 234750
			break
		}
		case 12 {
			setvar experienceneeded 284250
			break
		}
		case 13 {
			setvar experienceneeded 338500
			break
		}
		case 14 {
			setvar experienceneeded 397500
			break
		}
		case 15 {
			setvar experienceneeded 461250
			break
		}
		case 16 {
			setvar experience 0
			break
		}
	endswitch
	ifvarvarg experience experienceneeded {
			addvar currentlevel 1
			addvar skillpoints 1
			subvarvar experience experienceneeded
			sound SHORT_CIRCUIT
			palfrom 50 64 64 64
		}
ends

state handleskills
	//Movement
	ifvare movespeedskill 1 setvar playerrunspeed 43000
	else ifvare movespeedskill 2 setvar playerrunspeed 44290
	else ifvare movespeedskill 3 setvar playerrunspeed 45580
	else ifvare movespeedskill 4 setvar playerrunspeed 46870
	else ifvare movespeedskill 5 setvar playerrunspeed 49450

	//Health
	ifvare healthskill 1 setvar playerhealth 20
	else ifvare healthskill 2 setvar playerhealth 30
	else ifvare healthskill 3 setvar playerhealth 40
	else ifvare healthskill 4 setvar playerhealth 50
	else ifvare healthskill 5 setvar playerhealth 60

	//Bonus money
	ifvare bonusmoneyskill 1 setvar bonusmoneyonkills 0
	else ifvare bonusmoneyskill 2 setvar bonusmoneyonkills 20
	else ifvare bonusmoneyskill 3 setvar bonusmoneyonkills 40
	else ifvare bonusmoneyskill 4 setvar bonusmoneyonkills 60
	else ifvare bonusmoneyskill 5 setvar bonusmoneyonkills 100

	//Mag size
	ifvare maxammoskill 1 setvar ammomultiplier 1
	else ifvare maxammoskill 2 setvar ammomultiplier 2
	else ifvare maxammoskill 3 setvar ammomultiplier 3
	else ifvare maxammoskill 4 setvar ammomultiplier 4
	else ifvare maxammoskill 5 setvar ammomultiplier 6

ends

state checkhitscan
  getplayer[THISACTOR].posx MY_X
  getplayer[THISACTOR].posy MY_Y
  getplayer[THISACTOR].posz MY_Z
  getplayer[THISACTOR].cursectnum MY_SECTOR
  getplayer[THISACTOR].ang MY_ANGLE
  getplayer[THISACTOR].horiz MY_ZDIST
  subvar MY_ZDIST 100
  mulvar MY_ZDIST -2048
  cos MY_COS MY_ANGLE
  sin MY_SIN MY_ANGLE

  hitscan MY_X MY_Y MY_Z MY_SECTOR MY_COS MY_SIN MY_ZDIST HITSECTOR HITWALL HITSPRITE HITX HITY HITZ 4294901808
ends

state giveexperince
	getactor[THISACTOR].htowner temp
	getactor[temp].yvel temptwo
	getplayervar[temptwo].experience tempthree
	addvarvar tempthree monsterhp
	randvarvar tempfour monsterhp
	addvarvar tempthree tempfour
	setplayervar[temptwo].experience tempthree
ends

state newbeastdrops
	///OBS HUSK AT ÆNDR IFVARL TEMP X SÅ DER KOMMER SPAWNEFFEKT PÅ NYE TING OGSÅ!!!///
	randvar temp 500 //500
  ifvarl temp 6 {
		spawn TRANSPORTERBEAM
		sound TELEPORTER
	}
  ifvare temp 0 spawn BATTERYAMMO
  else ifvare temp 1 spawn ATOMICHEALTH
  else ifvare temp 2 spawn BADGUYICON //Instakill
  else ifvare temp 3 spawn 2530 //Infinity ammo
  else ifvare temp 4 spawn 2825 //Money fest
  else ifvare temp 5 spawn 4520 //2000 points
  ifvarl temp 6 {
		spawn TRANSPORTERBEAM
		sound TELEPORTER
		sound SQUISHED
		state standard_jibs
		killit
	}

  randvar temp 3000 //3000
	ifvare temp 0 spawn SHIELD
	else ifvare temp 2 spawn 4371
	else ifvare temp 3 spawn 1667
	else ifvare temp 4 spawn 1234
	else ifvare temp 5 spawn HOLODUKE
	else ifvare temp 6 spawn JETPACK
	else ifvare temp 7 spawn FIRSTGUNSPRITE
	else ifvare temp 6 spawn SHOTGUNSPRITE
	else ifvare temp 9 spawn CHAINGUNSPRITE
	else ifvare temp 10 spawn RPGSPRITE
	else ifvare temp 11 spawn HBOMBAMMO
	else ifvare temp 12 spawn SHRINKERSPRITE
	else ifvare temp 13 spawn DEVISTATORSPRITE
	else ifvare temp 14 spawn TRIPBOMBSPRITE
	else ifvare temp 15 spawn FREEZESPRITE
	else ifvare temp 1 spawn RESPAWNMARKERYELLOW
		//else ifvare temp 1 spawn BOOTS
	ifvarl temp 16 {
		spawn TRANSPORTERBEAM
		sound TELEPORTER
		sound SQUISHED
		state standard_jibs
		killit
	}
ends

state buy
	ifvarg buycooldown 0 subvar buycooldown 1
ends

////////////////////EVENTS/////////////////

onevent EVENT_DISPLAYREST

	//Debuggg
	//getactor[THISACTOR].extra temp
	//digitalnumberz 2837 0 40 experience 0 0 0 0 0 xdim ydim 58000
	//digitalnumberz 2837 0 60 experienceneeded 0 0 0 0 0 xdim ydim 58000
	//digitalnumberz 2837 0 80 currentlevel 0 0 0 0 0 xdim ydim 58000
	//digitalnumberz 2837 0 100 skillpoints 0 0 0 0 0 xdim ydim 58000
	ifvare eog 1 {
		rotatesprite 160 100 500000 0 862 0 4 1 0 0 xdim ydim
		gametextz STARTALPHANUM 320 30 184 0 2 0 0 0 xdim ydim 80000
		ifvare showoverlay 0 {
			rotatesprite 123 100 58000 0 2957 0 0 0 0 0 xdim ydim
			rotatesprite 134 100 58000 0 2954 0 0 0 0 0 xdim ydim
			rotatesprite 145 100 58000 0 2960 0 0 0 0 0 xdim ydim
			rotatesprite 157 100 58000 0 2953 0 0 0 0 0 xdim ydim
			rotatesprite 168 100 58000 0 2943 0 0 0 0 0 xdim ydim
			digitalnumberz 2930 195 100 round 0 0 0 0 0 xdim ydim 58000
		}
	} else {
		//Reviving
		ifvarg revivetimer 0 {
			setvar temptwo 110
			setvar temp 100
			whilevarn temp 0 {
	      rotatesprite temptwo 145 65536 0 3163 0 2 49 0 0 xdim ydim 
	      addvar temptwo 1 
	      subvar temp 1
	    }
	    setvar temptwo 110
			setvarvar temp revivetimer
			mulvar temp 2
			divvar temp 3
			whilevarn temp 0 {
	      rotatesprite temptwo 145 65536 0 3163 0 2 16 0 0 xdim ydim 
	      addvar temptwo 1 
	      subvar temp 1
	    }
		}
		ifvarg successfulrevivetimer 0 {
			setvar temptwo 110
			setvar temp 100
			whilevarn temp 0 {
	      rotatesprite temptwo 145 65536 0 3163 0 8 16 0 0 xdim ydim 
	      addvar temptwo 1 
	      subvar temp 1
	    }
		}

		ifvarn idofdyingduke -1 {
			getplayervar[idofdyingduke].downtimer temp
			divvar temp 30
			addvar temp 1
			digitalnumberz 2930 170 30 temp 0 0 0 0 0 xdim ydim 58000
			rotatesprite 142 31 43000 0 2452 0 0 0 0 0 xdim ydim
		}

		//Intermission clock
		ifvarn intermission 0 {
			setvarvar temp intermission
			divvar temp 30
			addvar temp 1
			digitalnumberz 2930 300 20 temp 0 0 0 0 0 xdim ydim 58000
		}

		//Show access cards
	  getplayer[THISACTOR].got_access temp
	  ifvarg temp 3 {
	    rotatesprite 0 130 25000 0 60 0 23 16 0 0 xdim ydim
	    subvar temp 4
	  }
	  ifvarg temp 1 {
	    rotatesprite -5 130 25000 0 60 0 21 16 0 0 xdim ydim
	    subvar temp 2
	  }
	  ifvarg temp 0 {
	    rotatesprite -10 130 25000 0 60 0 0 16 0 0 xdim ydim
	    subvar temp 1
	  }
	  
	  //Magazine and ammo
	  ifvare PWEAPON PISTOL_WEAPON {
	  	ifvarg PISTOLMAGAZINE -1 {
				digitalnumberz 2837 192 108 PISTOLMAGAZINE 0 0 0 0 0 xdim ydim 40000
	  	} else {
	  		digitalnumberz 2837 192 108 0 0 0 0 0 0 xdim ydim 40000
	  	} 
	  }
	  ifvare PWEAPON PISTOL_WEAPON setvar temp 25
	  ifvare PWEAPON SHOTGUN_WEAPON setvar temp 6
	  ifvare PWEAPON CHAINGUN_WEAPON setvar temp 31
	  ifvare PWEAPON RPG_WEAPON setvar temp 4
	  ifvare PWEAPON HANDBOMB_WEAPON setvar temp 4
	  ifvare PWEAPON HANDREMOTE_WEAPON setvar temp 4
	  ifvare PWEAPON SHRINKER_WEAPON setvar temp 6
	  ifvare PWEAPON GROW_WEAPON setvar temp 11
	  ifvare PWEAPON DEVISTATOR_WEAPON setvar temp 31
	  ifvare PWEAPON TRIPBOMB_WEAPON setvar temp 3
	  ifvare PWEAPON FREEZE_WEAPON setvar temp 31
	  getplayer[THISACTOR].ammo_amount PWEAPON tempthree
	  getplayer[THISACTOR].ammo_amount HANDBOMB_WEAPON temptwo
	  ifvare PWEAPON HANDREMOTE_WEAPON setvarvar tempthree temptwo
	  subvar tempthree 1
	  ifvarvarl tempthree temp digitalnumberz 2837 180 108 tempthree 0 2 0 0 0 xdim ydim 40000

		//Round number
		rotatesprite -47 20 58000 0 2957 0 0 0 0 0 xdim ydim
		rotatesprite -36 20 58000 0 2954 0 0 0 0 0 xdim ydim
		rotatesprite -25 20 58000 0 2960 0 0 0 0 0 xdim ydim
		rotatesprite -13 20 58000 0 2953 0 0 0 0 0 xdim ydim
		rotatesprite -2 20 58000 0 2943 0 0 0 0 0 xdim ydim
		digitalnumberz 2930 25 20 round 0 0 0 0 0 xdim ydim 58000

		//Perks
		ifvare gotarmor 1 rotatesprite 341 181 35000 0 54 0 0 0 0 0 xdim ydim
		ifvare gotdoublemoney 1 {
			rotatesprite 319 183 19000 0 1234 0 0 0 0 0 xdim ydim
			digitalnumberz 2837 321 190 doublemoneygained 0 16 0 0 0 xdim ydim 35000
		} 
		ifvare gotboots 1 rotatesprite 294 184 40000 0 61 0 0 0 0 0 xdim ydim
		ifvare gotperkprotection 1 rotatesprite 341 165 35000 0 4371 0 0 0 0 0 xdim ydim
		ifvare gotbackpack 1 rotatesprite 320 163 35000 0 57 0 0 0 0 0 xdim ydim
		ifvare gotpowershot 1 {
			rotatesprite 305 164 20000 0 1667 0 0 0 0 0 xdim ydim
			digitalnumberz 2837 296 173 powershotmoney 0 16 0 0 0 xdim ydim 35000
		} 
		ifvare gotautorevive 1 rotatesprite 272 183 16500 0 HOLODUKE 0 0 0 0 0 xdim ydim
		ifvare gotbigmag 1 rotatesprite 271 166 18500 0 AMMO 0 0 0 0 0 xdim ydim

		//Powershot
		ifvare gotpowershot 1 {
			setvar temptwo 135
			setvar temp 50
			whilevarn temp 0 {
	      rotatesprite temptwo 185 65536 0 3163 0 0 49 0 0 xdim ydim 
	      addvar temptwo 1 
	      subvar temp 1
	    }
	    
	    setvar temptwo 135
			setvarvar temp powershotcd
			ifvare powershotcd 150 {
				divvar temp 3
				whilevarn temp 0 {
	        rotatesprite temptwo 185 65536 0 3163 0 2 16 0 0 xdim ydim 
	        addvar temptwo 1 
	        subvar temp 1
	      }
			} else {
				divvar temp 3
				whilevarn temp 0 {
	        rotatesprite temptwo 185 65536 0 3163 0 0 16 0 0 xdim ydim 
	        addvar temptwo 1 
	        subvar temp 1
	      }
			}

			digitalnumberz 2837 160 185 powershotkills 0 0 16 0 0 xdim ydim 43000
		}

		//Overheat bar
		ifvare primaryweapon CHAINGUN_WEAPON {
			setvar temptwo 135
			setvar temp 50
			whilevarn temp 0 {
	      rotatesprite temptwo 179 65536 0 3163 0 0 49 0 0 xdim ydim 
	      addvar temptwo 1 
	      subvar temp 1
	    }
	    setvar temptwo 135
			setvarvar temp chaingunheat
			ifvare hasoverheated 1 {
				divvar temp 5
				whilevarn temp 0 {
	        rotatesprite temptwo 179 65536 0 3163 0 2 16 0 0 xdim ydim 
	        addvar temptwo 1 
	        subvar temp 1
	      }
			} else ifvarg chaingunheat 150 {
				divvar temp 5
				whilevarn temp 0 {
	        rotatesprite temptwo 179 65536 0 3163 0 2 16 0 0 xdim ydim 
	        addvar temptwo 1 
	        subvar temp 1
	      }
			} else {
				divvar temp 5
				whilevarn temp 0 {
	        rotatesprite temptwo 179 65536 0 3163 0 0 16 0 0 xdim ydim 
	        addvar temptwo 1 
	        subvar temp 1
	      }
			}
		}

		//Levelbar
		setvar temptwo 110
		setvar temp 100
		whilevarn temp 0 {
      rotatesprite temptwo 191 65536 0 3163 0 12 49 0 0 xdim ydim 
      addvar temptwo 1 
      subvar temp 1
    }
    ifvarvarg experience experienceneeded {
    	nullop
    } else {
    	setvar temptwo 110
	    setvarvar temp experience
	    mulvar temp 100
	    divvarvar temp experienceneeded
			whilevarn temp 0 {
	      rotatesprite temptwo 191 65536 0 3163 0 12 16 0 0 xdim ydim 
	      addvar temptwo 1 
	      subvar temp 1
	    }
    }
    ifvare currentlevel 10 {
    	setvar temptwo 110
			setvar temp 100
			whilevarn temp 0 {
	      rotatesprite temptwo 191 65536 0 3163 0 12 16 0 0 xdim ydim 
	      addvar temptwo 1 
	      subvar temp 1
	    }
    }
    gametextz STARTALPHANUM 300 192 216 0 12 16 0 0 xdim ydim 30000
    digitalnumberz 2837 166 192 currentlevel 0 12 16 0 0 xdim ydim 30000
    ifvarg skillpoints 0 {
    	digitalnumberz 2837 216 191 skillpoints 0 7 16 0 0 xdim ydim 45000
    	rotatesprite 224 193 17500 0 RESPAWNMARKERYELLOW 0 16 0 0 0 xdim ydim
    }
    ifvarn currentlevel 10 {
    	digitalnumberz 2837 121 192 experience 10 12 16 0 0 xdim ydim 30000
	    digitalnumberz 2837 199 192 experienceneeded 10 12 16 0 0 xdim ydim 30000
    }
	    
		//Health
		ifp palive {
			setvar temptwo -15
			getplayer[THISACTOR].max_player_health temp
			whilevarn temp 0 {
	      rotatesprite temptwo 185 65536 0 3163 0 0 49 0 0 xdim ydim 
	      addvar temptwo 1 
	      subvar temp 1
	    }
	    
	    setvar temptwo -15
	    getactor[THISACTOR].extra temp
	    getplayer[THISACTOR].max_player_health tempthree
	    setvarvar tempsix tempthree
	    mulvar tempsix 2
	    divvar tempsix 3
	    ifvare gothit 0 {
	    	whilevarn tempthree 0 {
	        rotatesprite temptwo 185 65536 0 3163 0 15 16 0 0 xdim ydim 
	        addvar temptwo 1 
	        subvar tempthree 1
	      }
	      //ifvare gotarmor 0 gametextz STARTALPHANUM 4 188 188 0 15 0 0 0 xdim ydim 32000
	      //else gametextz STARTALPHANUM 24 188 188 0 15 0 0 0 xdim ydim 32000
	    } else ifvarvarg temp tempthree {
	    	whilevarn tempthree 0 {
	        rotatesprite temptwo 185 65536 0 3163 0 6 16 0 0 xdim ydim 
	        addvar temptwo 1 
	        subvar tempthree 1
	      }
	    } else ifvarvarg temp tempsix {
				whilevarn temp 0 {
	        rotatesprite temptwo 185 65536 0 3163 0 0 16 0 0 xdim ydim 
	        addvar temptwo 1 
	        subvar temp 1
	      }
			} else ifvarg temp 10 {
				whilevarn temp 0 {
	        rotatesprite temptwo 185 65536 0 3163 0 2 16 0 0 xdim ydim 
	        addvar temptwo 1 
	        subvar temp 1
	      }
			} else {
				whilevarn temp 0 {
	        rotatesprite temptwo 185 65536 0 3163 0 10 16 0 0 xdim ydim 
	        addvar temptwo 1 
	        subvar temp 1
	      }
	    }
	    addvar tempsix 1 //Make it hit the right branch and not off by one
	    getactor[THISACTOR].extra temp
	    ifvare gothit 0 digitalnumberz 2837 -8 186 temp 0 15 16 0 0 xdim ydim 30000
	    else ifvarl temp 11 digitalnumberz 2837 -8 186 temp 0 10 16 0 0 xdim ydim 30000
	    else ifvarvarg tempsix temp digitalnumberz 2837 -8 186 temp 0 2 16 0 0 xdim ydim 30000    
	    else digitalnumberz 2837 -8 186 temp 0 0 16 0 0 xdim ydim 30000
		}

		//Money
		ifvare gotdoublemoney 1 digitalnumberz 2837 315 96 finalplayermoney 0 7 0 0 0 xdim ydim 58000
		else digitalnumberz 2837 315 96 finalplayermoney 0 0 0 0 0 xdim ydim 58000
		ifvarn playermoney 0 digitalnumberz 2837 315 88 playermoney 0 8 0 0 0 xdim ydim 58000
		ifvarn playermoneybonus 0 digitalnumberz 2837 315 80 playermoneybonus 0 16 0 0 0 xdim ydim 58000
		ifvarn moneyused 0 digitalnumberz 2837 311 104 moneyused 0 10 0 0 0 xdim ydim 58000

		//Information
		ifvare buycooldown 0 state showinformation

		ifvarg roundcompletetimer 0 gametextz STARTALPHANUM 320 50 128 0 10 0 0 0 xdim ydim 65000
		else ifvarl rushroundtimer 180 ifvarg rushroundtimer 0 gametextz STARTALPHANUM 320 50 175 0 2 0 0 0 xdim ydim 65000
		
		ifvarg nohittimer 0 gametextz STARTALPHANUM 320 60 182 0 16 0 0 0 xdim ydim 65000
		else ifvarg moneyfestshowtimer 0 digitalnumberz 2837 160 60 moneyfrommoneyfestshow 0 7 0 0 0 xdim ydim 65000
		else ifvarg orbtimer 0 gametextz STARTALPHANUM 320 60 155 0 16 0 0 0 xdim ydim 65000
		else ifvarg moneyfromdroptimer 0 gametextz STARTALPHANUM 320 60 185 0 7 0 0 0 xdim ydim 65000
		else ifvarg maxammotimer 0 gametextz STARTALPHANUM 320 60 126 0 8 0 0 0 xdim ydim 65000
		else ifvarg nucleartimer 0 gametextz STARTALPHANUM 320 60 127 0 7 0 0 0 xdim ydim 65000
		else ifvarg instakilltimer 0 gametextz STARTALPHANUM 320 60 125 0 20 0 0 0 xdim ydim 65000
		else ifvarg moneyfesttimer 0 gametextz STARTALPHANUM 320 60 186 0 7 0 0 0 xdim ydim 65000
		else ifvarg infinityammotimer 0 gametextz STARTALPHANUM 320 60 154 0 20 0 0 0 xdim ydim 65000
		else ifvare round 30 gametextz STARTALPHANUM 320 60 178 0 2 0 0 0 xdim ydim 65000
		
		ifvarg infinityammoduration 0 {
			setvarvar temp infinityammoduration
			divvar temp 30
			addvar temp 1
			digitalnumberz 2930 325 120 temp 0 0 0 0 0 xdim ydim 50000
			rotatesprite 304 115 14000 0 2530 0 0 0 0 0 xdim ydim
		}
		ifvarg instakillduration 0 {
			setvarvar temp instakillduration
			divvar temp 30
			addvar temp 1
			digitalnumberz 2930 325 137 temp 0 0 0 0 0 xdim ydim 50000
			rotatesprite 303 133 50000 0 BADGUYICON 0 0 0 0 0 xdim ydim
		}
		ifvarg moneyfestduration 0 {
			setvarvar temp moneyfestduration
			divvar temp 30
			addvar temp 1
			digitalnumberz 2930 325 154 temp 0 0 0 0 0 xdim ydim 50000
			rotatesprite 304 152 100000 0 2825 0 7 0 0 0 xdim ydim
		}
		ifvarg autorevivetimer 0 {
			setvarvar temp autorevivetimer
			divvar temp 30
			addvar temp 1
			digitalnumberz 2930 167 106 temp 0 1 0 0 0 xdim ydim 80000
		}

		//Weaponicons
		getplayer[THISACTOR].ammo_amount primaryweapon temp
		subvar temp 1
		digitalnumberz 2837 20 152 temp 0 0 0 0 0 xdim ydim 58000 //162
		getplayer[THISACTOR].ammo_amount secondaryweapon temp
		subvar temp 1
		ifvarn secondaryweapon 0 digitalnumberz 2837 4 167 temp 0 0 0 0 0 xdim ydim 35000 //177
		getplayer[THISACTOR].ammo_amount tertiaryweapon temp
		subvar temp 1
		ifvarn tertiaryweapon 0 digitalnumberz 2837 4 177 temp 0 0 0 0 0 xdim ydim 35000 //187
		
		getplayer[THISACTOR].max_ammo_amount primaryweapon temp
		subvar temp 1
		digitalnumberz 2837 54 152 temp 0 0 0 0 0 xdim ydim 58000 //162
		getplayer[THISACTOR].max_ammo_amount secondaryweapon temp
		subvar temp 1
		ifvarn secondaryweapon 0 digitalnumberz 2837 24 167 temp 0 0 0 0 0 xdim ydim 35000 //177
		getplayer[THISACTOR].max_ammo_amount tertiaryweapon temp
		subvar temp 1
		ifvarn tertiaryweapon 0 digitalnumberz 2837 24 177 temp 0 0 0 0 0 xdim ydim 35000 //187
		
		rotatesprite 32 152 58000 0 2836 0 0 0 0 0 xdim ydim //162
		ifvarn secondaryweapon 0 rotatesprite 11 167 35000 0 2836 0 0 0 0 0 xdim ydim //177
		ifvarn tertiaryweapon 0 rotatesprite 11 177 35000 0 2836 0 0 0 0 0 xdim ydim //187
		
		ifvare primaryweapon 1 rotatesprite -20 147 35000 0 21 0 0 0 0 0 xdim ydim //157
		ifvare primaryweapon 2 rotatesprite -20 150 35000 0 28 0 0 0 0 0 xdim ydim //160
		ifvare primaryweapon 3 rotatesprite -20 147 35000 0 22 0 0 0 0 0 xdim ydim //157
		ifvare primaryweapon 4 rotatesprite -20 147 35000 0 23 0 0 0 0 0 xdim ydim //157
		ifvare primaryweapon 5 rotatesprite -20 147 35000 0 47 0 0 0 0 0 xdim ydim //157
		ifvare primaryweapon 6 rotatesprite -20 147 35000 0 25 0 0 0 0 0 xdim ydim //157
		ifvare primaryweapon 7 rotatesprite -20 150 35000 0 29 0 0 0 0 0 xdim ydim //160
		ifvare primaryweapon 8 rotatesprite -20 151 35000 0 27 0 0 0 0 0 xdim ydim //157
		ifvare primaryweapon 9 rotatesprite -20 147 35000 0 24 0 0 0 0 0 xdim ydim //157
		ifvare secondaryweapon 1 rotatesprite -20 165 20000 0 21 0 0 0 0 0 xdim ydim //175
		ifvare secondaryweapon 2 rotatesprite -20 167 20000 0 28 0 0 0 0 0 xdim ydim //177
		ifvare secondaryweapon 3 rotatesprite -20 165 20000 0 22 0 0 0 0 0 xdim ydim //175
		ifvare secondaryweapon 4 rotatesprite -20 165 20000 0 23 0 0 0 0 0 xdim ydim //175
		ifvare secondaryweapon 5 rotatesprite -20 165 20000 0 47 0 0 0 0 0 xdim ydim //175
		ifvare secondaryweapon 6 rotatesprite -20 165 20000 0 25 0 0 0 0 0 xdim ydim //175
		ifvare secondaryweapon 7 rotatesprite -20 165 20000 0 29 0 0 0 0 0 xdim ydim //175
		ifvare secondaryweapon 8 rotatesprite -20 165 20000 0 27 0 0 0 0 0 xdim ydim //175
		ifvare secondaryweapon 9 rotatesprite -20 165 20000 0 24 0 0 0 0 0 xdim ydim //175
		ifvare tertiaryweapon 1 rotatesprite -20 175 20000 0 21 0 0 0 0 0 xdim ydim //185
		ifvare tertiaryweapon 2 rotatesprite -20 177 20000 0 28 0 0 0 0 0 xdim ydim //187
		ifvare tertiaryweapon 3 rotatesprite -20 175 20000 0 22 0 0 0 0 0 xdim ydim //185
		ifvare tertiaryweapon 4 rotatesprite -20 175 20000 0 23 0 0 0 0 0 xdim ydim //185
		ifvare tertiaryweapon 5 rotatesprite -20 175 20000 0 47 0 0 0 0 0 xdim ydim //185
		ifvare tertiaryweapon 6 rotatesprite -20 175 20000 0 25 0 0 0 0 0 xdim ydim //185
		ifvare tertiaryweapon 7 rotatesprite -20 175 20000 0 29 0 0 0 0 0 xdim ydim //185
		ifvare tertiaryweapon 8 rotatesprite -20 175 20000 0 27 0 0 0 0 0 xdim ydim //185
		ifvare tertiaryweapon 9 rotatesprite -20 175 20000 0 24 0 0 0 0 0 xdim ydim //185
		
		ifvare invalidgame 1 gametextz STARTALPHANUM 320 60 174 0 2 0 0 0 xdim ydim 65000
	}
	//Overlay information
	ifvare showdebugging 1 {
		rotatesprite -106 40 140000 0 862 0 4 49 0 0 xdim ydim
		rotatesprite 20 40 140000 0 862 0 4 49 0 0 xdim ydim
		gametextz STARTALPHANUM -68 47 166 0 0 0 0 0 xdim ydim 55000
		gametextz STARTALPHANUM -50 55 167 0 0 0 0 0 xdim ydim 55000
		gametextz STARTALPHANUM -32 63 168 0 0 0 0 0 xdim ydim 55000
		gametextz STARTALPHANUM -80 71 169 0 0 0 0 0 xdim ydim 55000
		gametextz STARTALPHANUM -8 79 170 0 0 0 0 0 xdim ydim 55000
		gametextz STARTALPHANUM -50 87 171 0 0 0 0 0 xdim ydim 55000
		gametextz STARTALPHANUM -81 95 172 0 0 0 0 0 xdim ydim 55000
		gametextz STARTALPHANUM -50 103 173 0 0 0 0 0 xdim ydim 55000
		digitalnumberz 2837 82 47 totalmonsters 0 0 0 0 0 xdim ydim 55000
		digitalnumberz 2837 82 55 monsterslefttospawn 0 0 0 0 0 xdim ydim 55000
		digitalnumberz 2837 82 63 maxmonstersallowed 0 0 0 0 0 xdim ydim 55000
		digitalnumberz 2837 82 71 monstersalive 0 0 0 0 0 xdim ydim 55000
		digitalnumberz 2837 82 79 spawnrate 0 0 0 0 0 xdim ydim 55000
		digitalnumberz 2837 82 87 spawncounter 0 0 0 0 0 xdim ydim 55000
		digitalnumberz 2837 82 95 activespawners 0 0 0 0 0 xdim ydim 55000
	} else ifvare showskilloverlay 1 {
		rotatesprite 160 100 1000000 0 862 0 4 1 0 0 xdim ydim
		gametextz STARTALPHANUM 320 50 191 0 7 0 0 0 xdim ydim 55000
		//Movement speed
		gametextz STARTALPHANUM 320 60 192 0 12 0 0 0 xdim ydim 55000
		gametextz STARTALPHANUM 176 68 196 0 2 0 0 0 xdim ydim 44000
		gametextz STARTALPHANUM 236 68 197 0 2 0 0 0 xdim ydim 44000
		gametextz STARTALPHANUM 320 68 198 0 2 0 0 0 xdim ydim 44000
		gametextz STARTALPHANUM 356 68 199 0 2 0 0 0 xdim ydim 44000
		gametextz STARTALPHANUM 416 68 200 0 2 0 0 0 xdim ydim 44000

		digitalnumberz 2837 197 135 skillpoints 0 7 16 0 0 xdim ydim 55000
    gametextz STARTALPHANUM 220 135 217 0 12 16 0 0 xdim ydim 55000

		ifvare movespeedskill 1 gametextz STARTALPHANUM 176 68 196 0 0 0 0 0 xdim ydim 44000
		ifvare movespeedskill 2 gametextz STARTALPHANUM 236 68 197 0 0 0 0 0 xdim ydim 44000
		ifvare movespeedskill 3 gametextz STARTALPHANUM 320 68 198 0 0 0 0 0 xdim ydim 44000
		ifvare movespeedskill 4 gametextz STARTALPHANUM 356 68 199 0 0 0 0 0 xdim ydim 44000
		ifvare movespeedskill 5 gametextz STARTALPHANUM 416 68 200 0 0 0 0 0 xdim ydim 44000

		//Health
		gametextz STARTALPHANUM 320 80 193 0 12 0 0 0 xdim ydim 55000
		gametextz STARTALPHANUM 176 88 201 0 2 0 0 0 xdim ydim 44000
		gametextz STARTALPHANUM 236 88 202 0 2 0 0 0 xdim ydim 44000
		gametextz STARTALPHANUM 320 88 203 0 2 0 0 0 xdim ydim 44000
		gametextz STARTALPHANUM 356 88 204 0 2 0 0 0 xdim ydim 44000
		gametextz STARTALPHANUM 416 88 205 0 2 0 0 0 xdim ydim 44000

		ifvare healthskill 1 gametextz STARTALPHANUM 176 88 201 0 0 0 0 0 xdim ydim 44000
		ifvare healthskill 2 gametextz STARTALPHANUM 236 88 202 0 0 0 0 0 xdim ydim 44000
		ifvare healthskill 3 gametextz STARTALPHANUM 320 88 203 0 0 0 0 0 xdim ydim 44000
		ifvare healthskill 4 gametextz STARTALPHANUM 356 88 204 0 0 0 0 0 xdim ydim 44000
		ifvare healthskill 5 gametextz STARTALPHANUM 416 88 205 0 0 0 0 0 xdim ydim 44000

		//Bonus money
		gametextz STARTALPHANUM 320 100 194 0 12 0 0 0 xdim ydim 55000
		gametextz STARTALPHANUM 176 108 206 0 2 0 0 0 xdim ydim 44000
		gametextz STARTALPHANUM 236 108 207 0 2 0 0 0 xdim ydim 44000
		gametextz STARTALPHANUM 320 108 208 0 2 0 0 0 xdim ydim 44000
		gametextz STARTALPHANUM 356 108 209 0 2 0 0 0 xdim ydim 44000
		gametextz STARTALPHANUM 416 108 210 0 2 0 0 0 xdim ydim 44000

		ifvare bonusmoneyskill 1 gametextz STARTALPHANUM 176 108 206 0 0 0 0 0 xdim ydim 44000
		ifvare bonusmoneyskill 2 gametextz STARTALPHANUM 236 108 207 0 0 0 0 0 xdim ydim 44000
		ifvare bonusmoneyskill 3 gametextz STARTALPHANUM 320 108 208 0 0 0 0 0 xdim ydim 44000
		ifvare bonusmoneyskill 4 gametextz STARTALPHANUM 356 108 209 0 0 0 0 0 xdim ydim 44000
		ifvare bonusmoneyskill 5 gametextz STARTALPHANUM 416 108 210 0 0 0 0 0 xdim ydim 44000

		//Mag size
		gametextz STARTALPHANUM 320 120 195 0 12 0 0 0 xdim ydim 55000
		gametextz STARTALPHANUM 179 128 211 0 2 0 0 0 xdim ydim 44000
		gametextz STARTALPHANUM 236 128 212 0 2 0 0 0 xdim ydim 44000
		gametextz STARTALPHANUM 320 128 213 0 2 0 0 0 xdim ydim 44000
		gametextz STARTALPHANUM 356 128 214 0 2 0 0 0 xdim ydim 44000
		gametextz STARTALPHANUM 416 128 215 0 2 0 0 0 xdim ydim 44000

		ifvare maxammoskill 1 gametextz STARTALPHANUM 179 128 211 0 0 0 0 0 xdim ydim 44000
		ifvare maxammoskill 2 gametextz STARTALPHANUM 236 128 212 0 0 0 0 0 xdim ydim 44000
		ifvare maxammoskill 3 gametextz STARTALPHANUM 320 128 213 0 0 0 0 0 xdim ydim 44000
		ifvare maxammoskill 4 gametextz STARTALPHANUM 356 128 214 0 0 0 0 0 xdim ydim 44000
		ifvare maxammoskill 5 gametextz STARTALPHANUM 416 128 215 0 0 0 0 0 xdim ydim 44000

		ifvare choice 1 {
			rotatesprite 100 58 27000 0 RESPAWNMARKERYELLOW 0 0 0 0 0 xdim ydim
			rotatesprite 220 58 27000 0 RESPAWNMARKERYELLOW 0 0 0 0 0 xdim ydim
		} else ifvare choice 2 {
			rotatesprite 100 78 27000 0 RESPAWNMARKERYELLOW 0 0 0 0 0 xdim ydim
			rotatesprite 220 78 27000 0 RESPAWNMARKERYELLOW 0 0 0 0 0 xdim ydim
		} else ifvare choice 3 {
			rotatesprite 100 98 27000 0 RESPAWNMARKERYELLOW 0 0 0 0 0 xdim ydim
			rotatesprite 220 98 27000 0 RESPAWNMARKERYELLOW 0 0 0 0 0 xdim ydim
		}	else ifvare choice 4 {
			rotatesprite 100 118 27000 0 RESPAWNMARKERYELLOW 0 0 0 0 0 xdim ydim
			rotatesprite 220 118 27000 0 RESPAWNMARKERYELLOW 0 0 0 0 0 xdim ydim
		} 

	}	else ifvare showoverlay 1 {
		ifvare eog 0 rotatesprite 48 40 117000 0 862 0 4 49 0 0 xdim ydim
		ifvare eog 0 rotatesprite -57 40 117000 0 862 0 4 49 0 0 xdim ydim
		gametextz STARTALPHANUM -23 50 160 0 0 0 0 0 xdim ydim 55000
		gametextz STARTALPHANUM -87 58 190 0 0 0 0 0 xdim ydim 55000
		gametextz STARTALPHANUM -33 66 159 0 0 0 0 0 xdim ydim 55000
		gametextz STARTALPHANUM -80 74 161 0 0 0 0 0 xdim ydim 55000
		ifvarg numplayers 1 gametextz STARTALPHANUM -60 82 181 0 0 0 0 0 xdim ydim 55000		
		gametextz STARTALPHANUM 0 90 164 0 0 0 0 0 xdim ydim 55000
		gametextz STARTALPHANUM 186 90 165 0 0 0 0 0 xdim ydim 55000
		digitalnumberz 2837 84 50 totalpoints 0 0 0 0 0 xdim ydim 55000
		digitalnumberz 2837 84 58 totalkills 0 0 0 0 0 xdim ydim 55000
		digitalnumberz 2837 84 66 moneyspent 0 0 0 0 0 xdim ydim 55000
		digitalnumberz 2837 84 74 bonuses 0 0 0 0 0 xdim ydim 55000
		ifvarg numplayers 1 digitalnumberz 2837 84 90 moneyrecieved 0 0 0 0 0 xdim ydim 55000
		setvarvar temp hits
		mulvar temp 100
		divvarvar temp shots
		digitalnumberz 2837 84 90 temp 0 0 0 0 0 xdim ydim 55000
		ifvarg numplayers 1 {
			getactor[THISACTOR].yvel tempfour
			ifvarvare tempfour id setvarvar temp idtwo
			else setvarvar temp id
			getplayervar[temp].totalpoints temptwo
			digitalnumberz 2837 132 50 temptwo 0 2 0 0 0 xdim ydim 55000
			getplayervar[temp].totalkills temptwo
			digitalnumberz 2837 132 58 temptwo 0 2 0 0 0 xdim ydim 55000
			getplayervar[temp].moneyspent temptwo
			digitalnumberz 2837 132 66 temptwo 0 2 0 0 0 xdim ydim 55000
			getplayervar[temp].bonuses temptwo
			digitalnumberz 2837 132 74 temptwo 0 2 0 0 0 xdim ydim 55000	
			getplayervar[temp].moneyrecieved temptwo
			digitalnumberz 2837 132 82 temptwo 0 2 0 0 0 xdim ydim 55000
			getplayervar[temp].hits temptwo
			setvarvar tempthree temptwo
			mulvar tempthree 100
			getplayervar[temp].shots temptwo
			divvarvar tempthree temptwo
			digitalnumberz 2837 132 90 tempthree 0 2 0 0 0 xdim ydim 55000
			gametextz STARTALPHANUM 283 90 165 0 2 0 0 0 xdim ydim 55000
		}
	}
endevent

onevent EVENT_DISPLAYCROSSHAIR
	ifp palive nullop
	else setvar RETURN -1
	ifvare eog 1 setvar RETURN -1
	ifvare showskilloverlay 1 setvar RETURN -1
endevent

onevent EVENT_INVENTORYRIGHT
	setvar RETURN -1
	ifvare showdebugging 1 {
		setplayer[THISACTOR].max_player_health 1000
		addphealth 1000
	} 
endevent

onevent EVENT_HOLODUKEON
	setvar RETURN -1
	quote 177
	addlogvar finalplayermoney
	addlogvar primaryweapon
	addlogvar secondaryweapon
	addlogvar tertiaryweapon
	addlogvar gotbackpack
	addlogvar gotarmor
	addlogvar gotboots
	addlogvar gotperkprotection
	addlogvar gotpowershot
	addlogvar gotdoublemoney
	addlogvar gotautorevive
	addlogvar haltrunspeed
	addlogvar playerrunspeed
	addlogvar mysteryboxcost
	addlogvar intermission
	addlogvar round
	addlogvar monstertype
	addlogvar spawnrate
	addlogvar monsterslefttospawn
	addlogvar totalmonsters
	addlogvar monsterhp
	addlogvar maxmonstersallowed
	addlogvar downtimervar
	addlogvar autorevivetimervar
	addlogvar temp
	addlogvar temptwo
	addlogvar tempthree
	addlogvar tempfour
	addlogvar tempfive
	addlogvar tempsix
	addlogvar haltcounter
	addlogvar spawncounter
	addlogvar hpregencounter
	addlogvar accessspritenum
	addlogvar accesstoblue
	addlogvar accesstored
	addlogvar accesstoyellow
	addlogvar buycooldown
	addlogvar weaponswitchcd
	addlogvar tintscreen
	addlogvar id
	addlogvar idtwo
	addlogvar roundcompletetimer
	addlogvar nuclear
	addlogvar nucleartimer
	addlogvar maxammo
	addlogvar maxammotimer
	addlogvar instakill
	addlogvar instakilltimer
	addlogvar instakillduration
	addlogvar powershotcd
	addlogvar infinityammo
	addlogvar infinityammotimer
	addlogvar infinityammoduration
	addlogvar havespawnedorb
	addlogvar spawners 
	addlogvar orbtimer
	addlogvar moneyfromdroptimer
	addlogvar moneycounter
	addlogvar bonusmoneycounter
	addlogvar monstersalive
	addlogvar playersalive
	addlogvar instakillhpset
	addlogvar playermoney
	addlogvar playermoneybonus
	addlogvar buycooldownvar
	addlogvar hpregencountervar
	addlogvar debugvalue
	addlogvar debugvaluetwo
	addlogvar gotrevivedbyintermission
	addlogvar showoverlay
	addlogvar moneyspent
	addlogvar damagedealt
	addlogvar bonuses
	addlogvar doublemoneygained
	addlogvar hits
	addlogvar shots
	addlogvar showdebugging
	addlogvar havecountedspawner
	addlogvar activespawners
	addlogvar invalidgame
	addlogvar rushroundtimer
	addlogvar autorevivetimer
	addlogvar owner
	addlogvar totalpoints
	addlogvar moneyrecieved
	addlogvar moneydonated
	addlogvar gothit
	addlogvar nohittimer
	addlogvar revivetimer
	addlogvar downtimer
	addlogvar isdead
	addlogvar isdown
	addlogvar idofdyingduke
	addlogvar powershotkills
	addlogvar activemysterybox 
	addlogvar gotrevivedbyplayer
	addlogvar eog
	addlogvar numberofplayers
	addlogvar chaingunheat
	addlogvar hasoverheated
	addlogvar moneyfest
	addlogvar moneyfesttimer
	addlogvar moneyfestduration
	addlogvar moneyfrommoneyfest
	addlogvar moneyfrommoneyfestshow
	addlogvar moneyfestshowtimer
	addlogvar teleporttimer
	addlogvar teleporttimervar
	addlogvar ammoamountone
	addlogvar ammoamounttwo
	addlogvar ammoamountthree
	addlogvar ammoamountfour
	addlogvar ammoamountfive
	addlogvar ammoamountsix
	addlogvar ammoamountseven
	addlogvar ammoamounteight
	addlogvar ammoamountnine
	addlogvar ammoamounteleven
	addlogvar primaryweaponsave
	addlogvar secondaryweaponsave
	addlogvar tertiaryweaponsave
	addlogvar primaryammo
	addlogvar secondaryammo
	addlogvar tertiaryammo
	addlogvar MY_X
	addlogvar MY_Y
	addlogvar MY_Z
	addlogvar MY_SECTOR
	addlogvar MY_ANGLE
	addlogvar MY_ZDIST
	addlogvar MY_COS
	addlogvar MY_SIN
	addlogvar HITSECTOR
	addlogvar HITSPRITE
	addlogvar HITWALL
	addlogvar HITX
	addlogvar HITY
	addlogvar HITZ
	addlogvar PISTOLAMMO
	addlogvar KICKBACK
	addlogvar PWEAPON
	addlogvar PISTOLMAGAZINE
	addlogvar PERPLAYER1
	addlogvar WEAPON1_CLIP
endevent

onevent EVENT_LOOKLEFT	
	setvar RETURN -1
	ifvare showdebugging 1 addvar finalplayermoney 1000
endevent

onevent EVENT_DOFIRE
	addvar shots 1
	getplayer[THISACTOR].curr_weapon temp
	getplayer[THISACTOR].ammo_amount temp temptwo
	ifvare temp 6 {
  	setvarvar temp MY_ANGLE
  	eshoot 1660
  	setactor[RETURN].ang temp
  	addvar temp 50
  	eshoot 1660
  	setactor[RETURN].ang temp
  	eshoot 1660
  	subvar temp 100 //Ændr projectile til noget cool, evt
  	setactor[RETURN].ang temp
  	subvar temptwo 1
  	setplayer[THISACTOR].ammo_amount 6 temptwo 
  }
  ifvarn temp 10 ifvarl temptwo 2 setvar RETURN -1
  ifvare PWEAPON 1 {
  	ifvarl PISTOLMAGAZINE 1 {
  		break
  	} else {
  		ifvare infinityammoduration 0 subvar PISTOLMAGAZINE 1 // subtract 1 from the magazine count, unless it's already at zero
  	}
  } // if the player has the pistol selected when he fires a projectile...
    
      
    
     
endevent

onevent EVENT_INVENTORYLEFT
	setvar RETURN -1
	ifvare showdebugging 0 setvar showdebugging 1
	else setvar showdebugging 0
endevent

onevent EVENT_FIRE
	ifvare PWEAPON 10 addvar shots 1
	ifvare PWEAPON 7 addvar shots 1
endevent

onevent EVENT_USE
	dist temp THISACTOR HITSPRITE
	ifvarl temp 1200 {
		ifvare buycooldown 0  {
			
			getactor[HITSPRITE].picnum tempfive
			ifvare tempfive FIRSTGUNSPRITE {
				setvar tempfour 1
				setvarvar itemcost pistolcost 
			} else ifvare tempfive SHOTGUNSPRITE {
				setvar tempfour 2
				setvarvar itemcost shotguncost
			} else ifvare tempfive CHAINGUNSPRITE {
				setvar tempfour 3
				setvarvar itemcost chainguncost
			} else ifvare tempfive RPGSPRITE {
				setvar tempfour 4
				setvarvar itemcost rpgcost
			} else ifvare tempfive HBOMBAMMO {
				setvar tempfour 5
				setvarvar itemcost pipebombcost
			} else ifvare tempfive SHRINKERSPRITE {
				setvar tempfour 6
				setvarvar itemcost shrinkercost
			} else ifvare tempfive GROWSPRITEICON {
				setvar tempfour 11
				setvarvar itemcost expandercost
			} else ifvare tempfive DEVISTATORSPRITE {
				setvar tempfour 7
				setvarvar itemcost devistatorcost
			} else ifvare tempfive TRIPBOMBSPRITE {
				setvar tempfour 8
				setvarvar itemcost tripbombcost
			} else ifvare tempfive FREEZESPRITE {
				setvar tempfour 9
				setvarvar itemcost freezercost
			} else setvar tempfour -1

			ifvare tempfive SHIELD setvarvar itemcost armorcost
			else ifvare tempfive HOLODUKE setvarvar itemcost autorevivecost
			else ifvare tempfive BOOTS setvarvar itemcost bootscost
			else ifvare tempfive JETPACK setvarvar itemcost backpackcost
			else ifvare tempfive 1234 setvarvar itemcost moneymultipliercost
			else ifvare tempfive 1667 setvarvar itemcost instakillcost
			else ifvare tempfive 4371 setvarvar itemcost perkprotectercost
			else ifvare tempfive ACCESSCARD setvarvar itemcost accesscardcost
			else ifvare tempfive AMMO setvarvar itemcost bigmagcost
			
			getactor[HITSPRITE].hitag temptwo
			ifvare temptwo 0 setvar itemcost 0

			ifvarvare tempfour primaryweapon divvar itemcost 4
			ifvarvare tempfour secondaryweapon divvar itemcost 4
			ifvarvare tempfour tertiaryweapon divvar itemcost 4

			setvarvar tempthree finalplayermoney
			addvarvar tempthree playermoney
			addvarvar tempthree playermoneybonus 
			ifvarvarl tempthree itemcost nullop
			else {
				getactor[HITSPRITE].picnum temp
				switch temp
					case ACCESSCARD {
						state buyandsetcd
						sound 210
						getactor[HITSPRITE].pal temp
						ifvare temp 0 {
							getplayer[THISACTOR].got_access temp
							addvar temp 1
							setplayer[THISACTOR].got_access temp
							setactor[HITSPRITE].xrepeat 0
						}
						ifvare temp 21 {
							getplayer[THISACTOR].got_access temp
							addvar temp 2
							setplayer[THISACTOR].got_access temp
							setactor[HITSPRITE].xrepeat 0
						}
						ifvare temp 23 {
							getplayer[THISACTOR].got_access temp
							addvar temp 4
							setplayer[THISACTOR].got_access temp
							setactor[HITSPRITE].xrepeat 0
						}
						break
					}
					case FIRSTGUNSPRITE {
						getplayer[THISACTOR].ammo_amount 1 temp
						getplayer[THISACTOR].max_ammo_amount 1 temptwo
						ifvarvare temp temptwo break
						setplayer[THISACTOR].gotweapon 1 1
						addammo 1 MAXPISTOLAMMO
						ifvarg infinityammoduration 0 addvar ammoamountone 100
						ifvare primaryweapon 1 state buyandsetcdammo
						else ifvare tertiaryweapon 1 state buyandsetcdammo
						else ifvare secondaryweapon 1 state buyandsetcdammo
						else ifvarn primaryweapon 1 {
							sound 5
							state buyandsetcd
							ifvare secondaryweapon 0 {
								setvarvar secondaryweapon primaryweapon
							} else ifvare gotbackpack 1 {
								ifvarn tertiaryweapon 0 {
									setplayer[THISACTOR].ammo_amount primaryweapon 1
									setplayer[THISACTOR].gotweapon primaryweapon 0
								} else {
									setvarvar tertiaryweapon secondaryweapon
									setvarvar secondaryweapon primaryweapon
								}
							} else {
								setplayer[THISACTOR].ammo_amount primaryweapon 1
								setplayer[THISACTOR].gotweapon primaryweapon 0
							}
							setvar primaryweapon 1
							setplayer[THISACTOR].curr_weapon 1
						}
						getactor[HITSPRITE].hitag temp
						ifvare temp 0 setactor[HITSPRITE].hitag -1
						break
					}
					case SHOTGUNSPRITE {
						getplayer[THISACTOR].ammo_amount 2 temp
						getplayer[THISACTOR].max_ammo_amount 2 temptwo
						ifvarvare temp temptwo break
						setplayer[THISACTOR].gotweapon 2 1
						addammo 2 MAXSHOTGUNAMMO
						ifvarg infinityammoduration 0 addvar ammoamounttwo 15
						ifvare primaryweapon 2 state buyandsetcdammo
						else ifvare tertiaryweapon 2 state buyandsetcdammo
						else ifvare secondaryweapon 2 state buyandsetcdammo
						else ifvarn primaryweapon 2 {
							state buyandsetcd
							sound 169
							ifvare secondaryweapon 0 {
								setvarvar secondaryweapon primaryweapon
							} else ifvare gotbackpack 1 {
								ifvarn tertiaryweapon 0 {
									setplayer[THISACTOR].ammo_amount primaryweapon 1
									setplayer[THISACTOR].gotweapon primaryweapon 0
								} else {
									setvarvar tertiaryweapon secondaryweapon
									setvarvar secondaryweapon primaryweapon
								}
							} else {
								setplayer[THISACTOR].ammo_amount primaryweapon 1
								setplayer[THISACTOR].gotweapon primaryweapon 0
							}
							setvar primaryweapon 2
							setplayer[THISACTOR].curr_weapon 2
						}
						getactor[HITSPRITE].hitag temp
						ifvare temp 0 setactor[HITSPRITE].hitag -1
						break
					}
					case CHAINGUNSPRITE {
						getplayer[THISACTOR].ammo_amount 3 temp
						getplayer[THISACTOR].max_ammo_amount 3 temptwo
						ifvarvare temp temptwo break
						setplayer[THISACTOR].gotweapon 3 1
						addammo 3 MAXCHAINGUNAMMO
						ifvarg infinityammoduration 0 addvar ammoamountthree 100
						ifvare primaryweapon 3 state buyandsetcdammo
						else ifvare tertiaryweapon 3 state buyandsetcdammo
						else ifvare secondaryweapon 3 state buyandsetcdammo
						else ifvarn primaryweapon 3 {
							state buyandsetcd
							sound 219
							ifvare secondaryweapon 0 {
								setvarvar secondaryweapon primaryweapon
							} else ifvare gotbackpack 1 {
								ifvarn tertiaryweapon 0 {
									setplayer[THISACTOR].ammo_amount primaryweapon 1
									setplayer[THISACTOR].gotweapon primaryweapon 0
								} else {
									setvarvar tertiaryweapon secondaryweapon
									setvarvar secondaryweapon primaryweapon
								}
							} else {
								setplayer[THISACTOR].ammo_amount primaryweapon 1
								setplayer[THISACTOR].gotweapon primaryweapon 0
							}
							setvar primaryweapon 3
							setplayer[THISACTOR].curr_weapon 3
						}
						getactor[HITSPRITE].hitag temp
						ifvare temp 0 setactor[HITSPRITE].hitag -1
						break
					}
					case RPGSPRITE {
						getplayer[THISACTOR].ammo_amount 4 temp
						getplayer[THISACTOR].max_ammo_amount 4 temptwo
						ifvarvare temp temptwo break
						setplayer[THISACTOR].gotweapon 4 1
						addammo 4 MAXRPGAMMO
						ifvarg infinityammoduration 0 addvar ammoamountfour 10
						ifvare primaryweapon 4 state buyandsetcdammo
						else ifvare tertiaryweapon 4 state buyandsetcdammo
						else ifvare secondaryweapon 4 state buyandsetcdammo
						else ifvarn primaryweapon 4 {
							state buyandsetcd
							sound 219
							ifvare secondaryweapon 0 {
								setvarvar secondaryweapon primaryweapon
							} else ifvare gotbackpack 1 {
								ifvarn tertiaryweapon 0 {
									setplayer[THISACTOR].ammo_amount primaryweapon 1
									setplayer[THISACTOR].gotweapon primaryweapon 0
								} else {
									setvarvar tertiaryweapon secondaryweapon
									setvarvar secondaryweapon primaryweapon
								}
							} else {
								setplayer[THISACTOR].ammo_amount primaryweapon 1
								setplayer[THISACTOR].gotweapon primaryweapon 0
							}
							setvar primaryweapon 4
							setplayer[THISACTOR].curr_weapon 4
						}
						getactor[HITSPRITE].hitag temp
						ifvare temp 0 setactor[HITSPRITE].hitag -1
						break
					}
					case HBOMBAMMO {
						getplayer[THISACTOR].ammo_amount 5 temp
						getplayer[THISACTOR].max_ammo_amount 5 temptwo
						ifvarvare temp temptwo break
						setplayer[THISACTOR].gotweapon 5 1
						addammo 5 MAXHANDBOMBAMMO
						ifvarg infinityammoduration 0 addvar ammoamountfive 5
						ifvare primaryweapon 5 state buyandsetcdammo
						else ifvare tertiaryweapon 5 state buyandsetcdammo
						else ifvare secondaryweapon 5 state buyandsetcdammo
						else ifvarn primaryweapon 5 {
							state buyandsetcd
							sound 297
							ifvare secondaryweapon 0 {
								setvarvar secondaryweapon primaryweapon
							} else ifvare gotbackpack 1 {
								ifvarn tertiaryweapon 0 {
									setplayer[THISACTOR].ammo_amount primaryweapon 1
									setplayer[THISACTOR].gotweapon primaryweapon 0
								} else {
									setvarvar tertiaryweapon secondaryweapon
									setvarvar secondaryweapon primaryweapon
								}
							} else {
								setplayer[THISACTOR].ammo_amount primaryweapon 1
								setplayer[THISACTOR].gotweapon primaryweapon 0
							}
							setvar primaryweapon 5
							setplayer[THISACTOR].curr_weapon 5
						}
						getactor[HITSPRITE].hitag temp
						ifvare temp 0 setactor[HITSPRITE].hitag -1
						break
					}
					case SHRINKERSPRITE {
						getplayer[THISACTOR].ammo_amount 6 temp
						getplayer[THISACTOR].max_ammo_amount 6 temptwo
						ifvarvare temp temptwo break
						setplayer[THISACTOR].gotweapon 6 1
						addammo 6 MAXSHRINKERAMMO
						ifvarg infinityammoduration 0 addvar ammoamountsix 25
						ifvare primaryweapon 6 state buyandsetcdammo
						else ifvare tertiaryweapon 6 state buyandsetcdammo
						else ifvare secondaryweapon 6 state buyandsetcdammo
						else ifvarn primaryweapon 6 {
							state buyandsetcd
							sound 219
							ifvare secondaryweapon 0 {
								setvarvar secondaryweapon primaryweapon
							} else ifvare gotbackpack 1 {
								ifvarn tertiaryweapon 0 {
									setplayer[THISACTOR].ammo_amount primaryweapon 1
									setplayer[THISACTOR].gotweapon primaryweapon 0
								} else {
									setvarvar tertiaryweapon secondaryweapon
									setvarvar secondaryweapon primaryweapon
								}
							} else {
								setplayer[THISACTOR].ammo_amount primaryweapon 1
								setplayer[THISACTOR].gotweapon primaryweapon 0
							}
							setvar primaryweapon 6
							setplayer[THISACTOR].curr_weapon 6
						}
						getactor[HITSPRITE].hitag temp
						ifvare temp 0 setactor[HITSPRITE].hitag -1
						break
					}
					/*case GROWSPRITEICON {
						getplayer[THISACTOR].ammo_amount 11 temp
						getplayer[THISACTOR].max_ammo_amount 11 temptwo
						ifvarvare temp temptwo break
						setplayer[THISACTOR].gotweapon 11 1
						addammo 11 MAXGROWAMMO
						ifvarg infinityammoduration 0 addvar ammoamounteleven 75
						ifvare primaryweapon 11 state buyandsetcdammo
						else ifvare tertiaryweapon 11 state buyandsetcdammo
						else ifvare secondaryweapon 11 state buyandsetcdammo
						else ifvarn primaryweapon 11 {
							state buyandsetcd
							sound 219
							ifvare secondaryweapon 0 {
								setvarvar secondaryweapon primaryweapon
							} else ifvare gotbackpack 1 {
								ifvarn tertiaryweapon 0 {
									setplayer[THISACTOR].ammo_amount primaryweapon 1
									setplayer[THISACTOR].gotweapon primaryweapon 0
								} else {
									setvarvar tertiaryweapon secondaryweapon
									setvarvar secondaryweapon primaryweapon
								}
							} else {
								setplayer[THISACTOR].ammo_amount primaryweapon 1
								setplayer[THISACTOR].gotweapon primaryweapon 0
							}
							setvar primaryweapon 11
							setplayer[THISACTOR].curr_weapon 11
						}
						getactor[HITSPRITE].hitag temp
						ifvare temp 0 setactor[HITSPRITE].hitag -1
						break
					}*/
					case DEVISTATORSPRITE {
						getplayer[THISACTOR].ammo_amount 7 temp
						getplayer[THISACTOR].max_ammo_amount 7 temptwo
						ifvarvare temp temptwo break
						setplayer[THISACTOR].gotweapon 7 1
						addammo 7 MAXDEVISTATORAMMO
						ifvarg infinityammoduration 0 addvar ammoamountseven 75
						ifvare primaryweapon 7 state buyandsetcdammo
						else ifvare tertiaryweapon 7 state buyandsetcdammo
						else ifvare secondaryweapon 7 state buyandsetcdammo
						else ifvarn primaryweapon 7 {
							state buyandsetcd
							sound 219
							ifvare secondaryweapon 0 {
								setvarvar secondaryweapon primaryweapon
							} else ifvare gotbackpack 1 {
								ifvarn tertiaryweapon 0 {
									setplayer[THISACTOR].ammo_amount primaryweapon 1
									setplayer[THISACTOR].gotweapon primaryweapon 0
								} else {
									setvarvar tertiaryweapon secondaryweapon
									setvarvar secondaryweapon primaryweapon
								}
							} else {
								setplayer[THISACTOR].ammo_amount primaryweapon 1
								setplayer[THISACTOR].gotweapon primaryweapon 0
							}
							setvar primaryweapon 7
							setplayer[THISACTOR].curr_weapon 7
						}
						getactor[HITSPRITE].hitag temp
						ifvare temp 0 setactor[HITSPRITE].hitag -1
						break
					}
					case TRIPBOMBSPRITE {
						getplayer[THISACTOR].ammo_amount 8 temp
						getplayer[THISACTOR].max_ammo_amount 8 temptwo
						ifvarvare temp temptwo break
						setplayer[THISACTOR].gotweapon 8 1
						addammo 8 MAXTRIPBOMBAMMO
						ifvarg infinityammoduration 0 addvar ammoamounteight 5
						ifvare primaryweapon 8 state buyandsetcdammo
						else ifvare tertiaryweapon 8 state buyandsetcdammo
						else ifvare secondaryweapon 8 state buyandsetcdammo
						else ifvarn primaryweapon 8 {
							state buyandsetcd
							sound 297
							ifvare secondaryweapon 0 {
								setvarvar secondaryweapon primaryweapon
							} else ifvare gotbackpack 1 {
								ifvarn tertiaryweapon 0 {
									setplayer[THISACTOR].ammo_amount primaryweapon 1
									setplayer[THISACTOR].gotweapon primaryweapon 0
								} else {
									setvarvar tertiaryweapon secondaryweapon
									setvarvar secondaryweapon primaryweapon
								}
							} else {
								setplayer[THISACTOR].ammo_amount primaryweapon 1
								setplayer[THISACTOR].gotweapon primaryweapon 0
							}
							setvar primaryweapon 8
							setplayer[THISACTOR].curr_weapon 8
						}
						getactor[HITSPRITE].hitag temp
						ifvare temp 0 setactor[HITSPRITE].hitag -1
						break
					}
					case FREEZESPRITE {
						getplayer[THISACTOR].ammo_amount 9 temp
						getplayer[THISACTOR].max_ammo_amount 9 temptwo
						ifvarvare temp temptwo break
						setplayer[THISACTOR].gotweapon 9 1
						addammo 9 MAXFREEZEAMMO
						ifvarg infinityammoduration 0 addvar ammoamountnine 50
						ifvare primaryweapon 9 state buyandsetcdammo
						else ifvare tertiaryweapon 9 state buyandsetcdammo
						else ifvare secondaryweapon 9 state buyandsetcdammo
						else ifvarn primaryweapon 9 {
							state buyandsetcd
							sound 219
							ifvare secondaryweapon 0 {
								setvarvar secondaryweapon primaryweapon
							} else ifvare gotbackpack 1 {
								ifvarn tertiaryweapon 0 {
									setplayer[THISACTOR].ammo_amount primaryweapon 1
									setplayer[THISACTOR].gotweapon primaryweapon 0
								} else {
									setvarvar tertiaryweapon secondaryweapon
									setvarvar secondaryweapon primaryweapon
								}
							} else {
								setplayer[THISACTOR].ammo_amount primaryweapon 1
								setplayer[THISACTOR].gotweapon primaryweapon 0
							}
							setvar primaryweapon 9
							setplayer[THISACTOR].curr_weapon 9
						}
						getactor[HITSPRITE].hitag temp
						ifvare temp 0 setactor[HITSPRITE].hitag -1
						break
					}
					case JETPACK {
						ifvare gotbackpack 0 {
							state buyandsetcd
							setvar gotbackpack 1
							sound 295
							getactor[HITSPRITE].hitag temp
							ifvare temp 0 setactor[HITSPRITE].hitag -1
						}
						break
					}
					case SHIELD {
						ifvare gotarmor 0 {
							state buyandsetcd
							setvar gotarmor 1
							sound 298
							getactor[HITSPRITE].hitag temp
							ifvare temp 0 setactor[HITSPRITE].hitag -1
						}
						break
					}
					/*
					case BOOTS {
						ifvare gotboots 0 {
							state buyandsetcd
							setvar gotboots 1
							sound 0
							getactor[HITSPRITE].hitag temp
							ifvare temp 0 setactor[HITSPRITE].hitag -1
						}
						break
					}
					*/
					case 4371 {
						ifvare gotperkprotection 0 {
							state buyandsetcd
							setvar gotperkprotection 1
							sound 85
							getactor[HITSPRITE].hitag temp
							ifvare temp 0 setactor[HITSPRITE].hitag -1
						}
						break
					}
					case 1667 {
						ifvare gotpowershot 0 {
							state buyandsetcd
							setvar gotpowershot 1
							sound 9
							getactor[HITSPRITE].hitag temp
							ifvare temp 0 setactor[HITSPRITE].hitag -1
						}
						break
					}
					case 1234 {
						ifvare gotdoublemoney 0 {
							state buyandsetcd
							setvar gotdoublemoney 1
							sound 303
							getactor[HITSPRITE].hitag temp
							ifvare temp 0 setactor[HITSPRITE].hitag -1
							subvarvar doublemoneygained moneymultipliercost
						}
						break
					}
					case HOLODUKE {
						ifvare gotautorevive 0 {
							state buyandsetcd
							setvar gotautorevive 1
							sound 35
							getactor[HITSPRITE].hitag temp
							ifvare temp 0 setactor[HITSPRITE].hitag -1
						}
						break
					}
					case AMMO {
						ifvare gotbigmag 0 {
							state buyandsetcd
							setvar gotbigmag 1
							sound 297
							getactor[HITSPRITE].hitag temp
							ifvare temp 0 setactor[HITSPRITE].hitag -1
						}
						break
					}
					case APLAYER {
						getactor[HITSPRITE].extra tempfive
						ifvarg tempfive 0 {
							ifvarg finalplayermoney 149 {
								subvar finalplayermoney 150
								addvar moneyspent 150
								addvar moneydonated 100
								getactor[HITSPRITE].yvel temp
								getplayervar[temp].playermoneybonus temptwo
								addvar temptwo 100
								setplayervar[temp].playermoneybonus temptwo
								setplayervar[temp].tintscreen 1
								setplayervar[temp].bonusmoneycounter 60
								getplayervar[temp].moneyrecieved temptwo
								addvar temptwo 100
								setplayervar[temp].moneyrecieved temptwo
								addvar moneyused -150
								setvar moneyusedcounter 60
								setvar buycooldown 10
								sound 210
							}
						} else {
							getactor[HITSPRITE].yvel temp
							getplayervar[temp].isdead tempthree
							ifvare tempthree 0 {
								addvar revivetimer 3
								getplayervar[temp].downtimer tempfour
								addvar tempfour 1
								setplayervar[temp].downtimer tempfour
								getplayervar[temp].revivetimer tempfour
								addvar tempfour 3
								setplayervar[temp].revivetimer tempfour
								ifvarg revivetimer 150 {
									setplayervar[temp].successfulrevivetimer 15
									setplayervar[temp].gotrevivedbyplayer 1
									setplayervar[temp].revivetimer 0
									setvar successfulrevivetimer 15
									setvar revivetimer 0
									setvar buycooldown 60
								}
							}
						}
						break
					}
					case BIGQ {
						state buyandsetcd
						setactor[HITSPRITE].lotag -1
						break
					}
					default break
				endswitch
				state weaponswitchfix
			}
		}
	}
endevent

onevent EVENT_EGS
	getactor[THISACTOR].owner owner
endevent

onevent EVENT_SPAWN
	ifactor NEWBEAST setactor[THISACTOR].extra monsterhp
	ifactor DRONE setactor[THISACTOR].extra monsterhp
endevent

onevent EVENT_USESTEROIDS
	setvar RETURN -1 // disable the event
	subvar PISTOLAMMO 1
  ifvare PWEAPON 1 // if the player has the pistol armed
  {
    ifvare PISTOLMAGAZINE 12 // and his magazine is full, break
      break
    else ifvarvare PISTOLMAGAZINE PISTOLAMMO // if his magazine is equal to his pistol ammo, break
      break
    else // otherwise, start the reloading sequence
    {
      setplayer[THISACTOR].reloading 1
      setplayer[THISACTOR].kickback_pic 4
    }
  }
endevent

onevent EVENT_USENIGHTVISION
	setvar RETURN -1
	ifvare showoverlay 0 setvar showoverlay 1
	else ifvare showoverlay 1 setvar showoverlay 0
endevent

onevent EVENT_RESETPLAYER
  ifvarn autorevivetimer 1 {
  	setplayer[THISACTOR].gotweapon 1 1
		setplayer[THISACTOR].gotweapon 2 0
		setplayer[THISACTOR].gotweapon 3 0
		setplayer[THISACTOR].gotweapon 4 0
		setplayer[THISACTOR].gotweapon 5 0
		setplayer[THISACTOR].gotweapon 6 0
		setplayer[THISACTOR].gotweapon 7 0
		setplayer[THISACTOR].gotweapon 8 0
		setplayer[THISACTOR].gotweapon 9 0
		setplayer[THISACTOR].gotweapon 11 0
	  ifvare gotrevivedbyintermission 1 {
	  	setvar gotrevivedbyintermission 0
	  	setplayer[THISACTOR].ammo_amount 1 1
	  } else setplayer[THISACTOR].ammo_amount 1 101
	  setplayer[THISACTOR].ammo_amount 2 1
	  setplayer[THISACTOR].ammo_amount 3 1
	  setplayer[THISACTOR].ammo_amount 4 1
	  setplayer[THISACTOR].ammo_amount 5 1
	  setplayer[THISACTOR].ammo_amount 6 1
	  setplayer[THISACTOR].ammo_amount 7 1
	  setplayer[THISACTOR].ammo_amount 8 1
	  setplayer[THISACTOR].ammo_amount 9 1
	  setplayer[THISACTOR].ammo_amount 11 1
		setplayer[THISACTOR].curr_weapon PISTOL_WEAPON
		setvar primaryweapon PISTOL_WEAPON
		setvar secondaryweapon 0
		setvar tertiaryweapon 0
	  setvar PISTOLMAGAZINE 0
	  ifvare PWEAPON 1 {
	    setplayer[THISACTOR].reloading 1 
	    setplayer[THISACTOR].kickback_pic 4
	  }
  } else addammo 1 234
  state loseperks
endevent

onevent EVENT_PRESSEDFIRE // when the player presses the fire button..
  getplayer[THISACTOR].curr_weapon temp
	getplayer[THISACTOR].ammo_amount temp temptwo
	ifvare infinityammoduration 0 {
		ifvarn temp 10 ifvarl temptwo 2 setvar RETURN -1
	  ifvare PWEAPON 1 // and he has the pistol armed...
	    ifvarl PISTOLMAGAZINE 1
	      setvar RETURN -1 // if his magazine is at zero, disable the firing key
	}
	ifvare temp CHAINGUN_WEAPON {
		ifvare hasoverheated 0 ifvarg temptwo 1 addvar chaingunheat 4
		else setvar RETURN -1
	}
endevent

onevent EVENT_TURNAROUND
	setvar RETURN -1
	ifvare showskilloverlay 0 setvar showskilloverlay 1
	else setvar showskilloverlay 0
endevent

onevent EVENT_DISPLAYSBAR
	ifvare showdebugging 0 setvar RETURN -1
endevent

onevent EVENT_WEAPKEY1
	setvar RETURN -1
	ifvare choice 1 setvar choice 4
	else subvar choice 1
	sound KICK_HIT
endevent

onevent EVENT_WEAPKEY2
	setvar RETURN -1
	ifvare choice 4 setvar choice 1
	else addvar choice 1
	sound KICK_HIT
endevent

onevent EVENT_WEAPKEY3
	setvar RETURN -1
	ifvare showskilloverlay 1 {
		ifvarg skillpoints 0 {
			ifvare choice 1 ifvarl movespeedskill 5 {
				addvar movespeedskill 1
				subvar skillpoints 1
				setvar autooffcounter 15
				sound 243
			} 
			ifvare choice 2 ifvarl healthskill 5 {
				addvar healthskill 1
				setvarvar temp playerhealth
				addvar temp 10
				setactor[THISACTOR].extra temp
				subvar skillpoints 1
				setvar autooffcounter 15
				sound 243
			} 
			ifvare choice 3 ifvarl bonusmoneyskill 5 {
				addvar bonusmoneyskill 1
				subvar skillpoints 1
				setvar autooffcounter 15
				sound 243
			} 
			ifvare choice 4 ifvarl maxammoskill 5 {
				addvar maxammoskill 1
				subvar skillpoints 1
				setvar autooffcounter 15
				sound 243
			}
		}
	}
endevent

onevent EVENT_WEAPKEY4
	setvar RETURN -1
endevent

onevent EVENT_WEAPKEY5
	setvar RETURN -1
endevent

onevent EVENT_WEAPKEY6
	setvar RETURN -1
endevent

onevent EVENT_WEAPKEY7
	setvar RETURN -1
endevent

onevent EVENT_WEAPKEY8
	setvar RETURN -1
endevent

onevent EVENT_WEAPKEY9
	setvar RETURN -1
endevent

onevent EVENT_WEAPKEY10
	setvar RETURN -1
endevent

onevent EVENT_NEXTWEAPON
	ifvare hasoverheated 1 {
		setvar RETURN -1
	} else {
		ifvare PWEAPON 10 {
			setvar RETURN -1
			break
		}
		getplayer[THISACTOR].kickback_pic temptwo
		getplayer[THISACTOR].quick_kick temp
		ifvare temp 0 {
			ifvare temptwo 0 {
				ifvarn secondaryweapon 0 {
					ifvarn tertiaryweapon 0 {
						setvarvar temp primaryweapon
						setvarvar primaryweapon secondaryweapon
						setvarvar secondaryweapon tertiaryweapon
						setvarvar tertiaryweapon temp
					} else {
						setvarvar temp primaryweapon
						setvarvar primaryweapon secondaryweapon
						setvarvar secondaryweapon temp
					}
				}
			}
		}
	}
endevent

onevent EVENT_PREVIOUSWEAPON
	ifvare hasoverheated 1 {
		setvar RETURN -1
	} else {
		ifvare PWEAPON 10 {
			setvar RETURN -1
			break
		}
		getplayer[THISACTOR].kickback_pic temptwo
		getplayer[THISACTOR].quick_kick temp
		ifvare temp 0 {
			ifvare temptwo 0 {
				ifvarn secondaryweapon 0 {
					ifvarn tertiaryweapon 0 {
						setvarvar temp tertiaryweapon
						setvarvar tertiaryweapon secondaryweapon
						setvarvar secondaryweapon primaryweapon
						setvarvar primaryweapon temp
					} else {
						setvarvar temp secondaryweapon
						setvarvar secondaryweapon primaryweapon
						setvarvar primaryweapon temp
					}
				}
			}
		}
	}
endevent

onevent EVENT_GAME
  ifactor GETICON changespritestat THISACTOR 1
  ifactor 1234 changespritestat THISACTOR 1
  ifactor 1667 changespritestat THISACTOR 1
  ifactor 4371 changespritestat THISACTOR 1
  ifactor JETPACK changespritestat THISACTOR 1
  ifactor SHIELD changespritestat THISACTOR 1
  ifactor HOLODUKE changespritestat THISACTOR 1
  ifactor BOOTS changespritestat THISACTOR 1
  ifvare showdebugging 1 setvar invalidgame 1
  ifactor NEWBEAST {
  	changespritestat THISACTOR 1
    setactor[THISACTOR].httimetosleep 780
  }
endevent

onevent EVENT_ENTERLEVEL
	setvar FFIRE 0
	state setupround
endevent

//////////////////////////////////// S U R V I V A L /////////////////////////////////////////////////

define SPACESHUTTLE 487
move SHUTTLEVELS 16
actor SPACESHUTTLE TOUGH
//  ifmove 0          //  Init once
//    move SHUTTLEVELS getv geth
enda


actor SATELLITE TOUGH
  //  ifmove 0 move SHUTTLEVELS getv geth
  //  ifcount 120 move SHUTTLEVELS getv geth randomangle
enda

state genericshrunkcode
  ifcount 32
  {
    ifpdistl SQUISHABLEDISTANCE
    pstomp
  }
  else
  {
    sizeto MINXSTRETCH MINYSTRETCH
    spawn FRAMEEFFECT1
  }
ends

state genericgrowcode
  ifcount 32
  {
    guts JIBS4 24
    guts JIBS6 28
    addkills 1
    sound SQUISHED
    sound PIPEBOMB_EXPLODE
    hitradius 2048 60 70 80 90
    spawn BLOODPOOL
    spawn EXPLOSION2
    killit
  }
  else
  {
    ifactor COMMANDER
      sizeto 100 100
    else
      ifactor SHARK
        sizeto 84 84
    else
      sizeto MAXXSTRETCH MAXYSTRETCH
    break
  }
ends




action ASHARKCRUZING 0 8 5 1 24
action ASHARKFLEE  0 8 5 1 10
action ASHARKATACK   0 8 5 1 6
action ASHARKSHRUNK  0 8 5 1 24
action ASHARKGROW  0 8 5 1 24
action ASHARKFROZEN  0 1 5 1 24

move SHARKVELS 24
move SHARKFASTVELS 72
move SHARKFLEEVELS 40

actor SHARK SHARKSTRENGTH ASHARKCRUZING SHARKVELS randomangle geth
  ifaction ASHARKSHRUNK
  {
    ifcount SHRUNKDONECOUNT
      action ASHARKCRUZING
    else ifcount SHRUNKCOUNT
      sizeto 60 60
    else
      state genericshrunkcode
    break
  }
  else
    ifaction ASHARKGROW
  {
    ifcount SHRUNKDONECOUNT
      action ASHARKCRUZING
    else
      ifcount SHRUNKCOUNT
        sizeto 24 24
    else
      state genericgrowcode
  }
  else
    ifaction ASHARKFROZEN
  {
    fall

    ifp pfacing
      ifpdistl FROZENQUICKKICKDIST
        pkick

    ifcount THAWTIME
    {
      action ASHARKFLEE
      getlastpal
      break
    }
    else
      ifcount FROZENDRIPTIME
        ifactioncount 26
          resetactioncount

    ifhitweapon
    {
      ifwasweapon FREEZEBLAST
        break

      lotsofglass 30
      sound GLASS_BREAKING
      addkills 1
      killit
    }
    break
  }
  else
    ifaction ASHARKFLEE
  {
    ifcount 16
      ifrnd 48
    {
      action ASHARKCRUZING
      move SHARKVELS randomangle geth
    }
  }
  else
    ifaction ASHARKCRUZING
  {
    ifcansee
      ifcount 48
        ifrnd 2
          ifcanshoottarget
    {
      action ASHARKATACK
      move SHARKFASTVELS faceplayerslow getv break
    }
    ifcount 32
      ifnotmoving
    {
      ifrnd 128
        move SHARKVELS randomangle geth
      else
        move SHARKFASTVELS randomangle geth
    }
  }
  else
    ifaction ASHARKATACK
  {
    ifcount 4
    {
      ifpdistl 1280
      {
        ifp palive ifcanshoottarget
        {
          sound DUKE_GRUNT
          palfrom 32 32
          addphealth SHARKBITESTRENGTH
        }
        action ASHARKFLEE
        move SHARKFLEEVELS fleeenemy
      }
    }
    else
      ifnotmoving
    {
      ifcount 32
      {
        action ASHARKCRUZING
        move SHARKVELS randomangle geth
      }
    }
    else
      ifcount 48
        ifrnd 2
    {
      action ASHARKCRUZING
      move SHARKFASTVELS randomangle geth
    }
  }

  ifhitweapon
  {
    ifdead
    {
      ifwasweapon GROWSPARK
      {
        move 0
        cstat 0
        action ASHARKGROW
        sound ACTOR_GROWING
        break
      }
      else
        ifwasweapon FREEZEBLAST
      {
        spritepal 1
        strength 0
        action ASHARKFROZEN
        sound SOMETHINGFROZE
      }
      else
      {
        sound SQUISHED
        guts JIBS6 5
        addkills 1
        killit
      }
    }
    else
    {
      ifwasweapon SHRINKSPARK
      {
        action ASHARKSHRUNK
        sound ACTOR_SHRINKING
        move 0
        break
      }
      else
        ifwasweapon GROWSPARK
          sound EXPANDERHIT

      move SHARKVELS randomangle geth
    }
  }
enda


action BLIMPWAITTORESPAWN

state blimphitstate
  cstat 0
  spawn FIRSTGUNSPRITE
  spawn EXPLOSION2

  debris SCRAP1 40      // Weapons and ammo!
  debris SCRAP2 32
  debris SCRAP3 32
  debris SCRAP4 32
  debris SCRAP5 32

  sound PIPEBOMB_EXPLODE
  ifrespawn
  {
    action BLIMPWAITTORESPAWN
    count 0
    cstat 32768
  }
  else
    killit
ends

actor BLIMP 1

  ifaction BLIMPWAITTORESPAWN
  {
    ifcount BLIMPRESPAWNTIME
    {
      action 0
      cstat 0
    }
    break
  }

  ifhitweapon
  {
    ifwasweapon RADIUSEXPLOSION
      state blimphitstate
    ifwasweapon RPG
      state blimphitstate
    strength 1
  }
enda



state rats
  ifrnd 128
    spawn RAT
  ifrnd 128
    spawn RAT
  ifrnd 128
    spawn RAT
  ifrnd 128
    spawn RAT
  ifrnd 128
    spawn RAT
  ifrnd 128
    spawn RAT
  ifrnd 128
    spawn RAT
  ifrnd 128
    spawn RAT
ends

move RESPAWN_ACTOR_FLAG
move MOUSEVELS 32

action RUBCANDENT 1 1 1 1 1

actor RUBBERCAN WEAK
  ifaction RUBCANDENT
  {
    ifactioncount 16
    {
      strength 0
      action ANULLACTION
      break
    }
  }
  else
    ifhitweapon
  {
    ifwasweapon RADIUSEXPLOSION
    {
      state rats
      ifrnd 48
        spawn BURNING
      debris SCRAP3 12
      killit
    }
    else
      action RUBCANDENT
  }
enda

state toughgalspeech
  ifrnd 64
  {
    ifnosounds
      soundonce TOUGHGALSND1
  }
  else
    ifrnd 64
  {
    ifnosounds
      soundonce TOUGHGALSND2
  }
  else
    ifrnd 64
  {
    ifnosounds
      soundonce TOUGHGALSND3
  }
  else
    ifnosounds
      soundonce TOUGHGALSND4
ends

state jibfood
  sound SQUISHED
  guts JIBS6 3
  killit
ends

state breakobject
  ifaction 0
  {
    action ANULLACTION
    cstator 257
    ifactor ROBOTMOUSE
      clipdist 64
  }
  else
    ifactor ROBOTMOUSE
  {
      ifdead
      {
        ifcount 32
        {
          globalsound MOUSEANNOY
          killit
        }
        break
      }
      ifcount 64 ifrnd 6
      {
        ifrnd 128
          move MOUSEVELS randomangle geth
        else
        {
          ifrnd 64
            soundonce HAPPYMOUSESND1
          else
            ifrnd 64
              soundonce HAPPYMOUSESND2
          else
            ifrnd 64
              soundonce HAPPYMOUSESND3
          else
            soundonce HAPPYMOUSESND4
        }
        resetcount
      }
  }

  ifhitweapon
  {
    ifdead
    {
      ifactor FOODOBJECT6
        state jibfood
      else
        ifactor FOODOBJECT11
          state jibfood
      else
        ifactor FOODOBJECT12
          state jibfood
      else
        ifactor FOODOBJECT13
          state jibfood
      else
        ifactor FOODOBJECT14
          state jibfood
      else
        ifactor FOODOBJECT15
          state jibfood
      else
        ifactor FOODOBJECT16
          state jibfood
      else
        ifactor FOODOBJECT17
          state jibfood
      else
        ifactor SKINNEDCHICKEN
          state jibfood
      else
        ifactor SHOPPINGCART
      {
        debris SCRAP1 5
        debris SCRAP2 5
        debris SCRAP3 5
        sound GLASS_HEAVYBREAK
        killit
      }
      else
        ifactor ROBOTDOG2
      {
        soundonce DEAD_DOG
        guts JIBS2 1
        guts JIBS3 2
        guts JIBS6 3
        killit
      }
      else
        ifactor FEATHEREDCHICKEN
          state jibfood
      else
        ifactor DOLPHIN1
      {
        guts JIBS2 1
        guts JIBS3 2
        guts JIBS4 3
        guts JIBS5 2
        state jibfood
      }
      else
        ifactor DOLPHIN2
      {
        guts JIBS2 1
        guts JIBS3 2
        guts JIBS4 3
        guts JIBS5 2
        state jibfood
      }
      else
        ifactor SNAKEP
      {
        guts JIBS2 1
        guts JIBS3 2
        guts JIBS4 3
        guts JIBS5 2
        state jibfood
      }
      else
        ifactor DONUTS
      {
        spritepal 7
        guts JIBS6 2
        killit
      }
      else
        ifactor DONUTS2
      {
        debris SCRAP1 1
        spritepal 7
        guts JIBS6 2
        killit
      }
      else
        ifactor MAILBAG
        {
          mail 30
          debris SCRAP3 5
          debris SCRAP4 3
          killit
        }
      else
        ifactor TEDDYBEAR
      {
        debris SCRAP3 5
        spritepal 1
        debris SCRAP3 6
      }
      else
      {
        ifrnd 128
          sound GLASS_BREAKING
        else
          sound GLASS_HEAVYBREAK
      }

      ifactor CLOCK
      {
        cactor BROKENCLOCK
        break
      }
      else
        ifactor JOLLYMEAL
      {
        spawn ATOMICHEALTH
        debris SCRAP3 1
        debris SCRAP4 2
      }
      else
        ifactor GUMBALLMACHINE
      {
        cactor GUMBALLMACHINEBROKE
        strength 1
        debris SCRAP4 2
        lotsofglass 10
        break
      }
      else
        ifactor GUMBALLMACHINEBROKE
      {
        debris SCRAP3 3
        debris SCRAP4 2
        lotsofglass 10
      }
      else
        ifactor DUKEBURGER
      {
        debris SCRAP3 14
        debris SCRAP1 13
        debris SCRAP4 12
        debris SCRAP2 12
        debris SCRAP5 11
      }
      else
        ifactor POLICELIGHTPOLE
      {
        debris SCRAP3 4
        debris SCRAP1 3
        debris SCRAP4 2
        debris SCRAP2 2
        debris SCRAP5 1
      }
      else
        ifactor TOPSECRET
          paper 10
      else
        ifactor GUNPOWDERBARREL
      {
        spawn EXPLOSION2
        sound PIPEBOMB_EXPLODE
        hitradius 2048 WEAKEST WEAK MEDIUMSTRENGTH TOUGH
        ifpdistl 2048
          wackplayer
        debris SCRAP1 10      // Weapons and ammo!
        debris SCRAP2 13
        debris SCRAP3 4
        debris SCRAP4 17
        debris SCRAP5 6
      }
      else
        ifactor FLOORBASKET
      {
        spawn PUKE
        debris SCRAP1 2
        debris SCRAP3 3
        debris SCRAP4 2
      }
      else
        ifactor ROBOTMOUSE
      {
        debris SCRAP2 10
        spritepal 1
        debris SCRAP3 4
        resetcount
        cstat 32768
        break
      }
      else
        ifactor ROBOTPIRATE
      {
        debris SCRAP2 10
        debris SCRAP1 5
        debris SCRAP3 3
        lotsofglass 10
      }
      else
        ifactor PIRATE1A
      {
        debris SCRAP2 10
        debris SCRAP1 5
        debris SCRAP3 3
        lotsofglass 10
      }
      else
        ifactor MAN
      {
        debris SCRAP2 10
        debris SCRAP1 5
        debris SCRAP3 3
        lotsofglass 10
      }
      else
        ifactor MAN2
      {
        debris SCRAP2 10
        debris SCRAP1 5
        debris SCRAP3 3
        lotsofglass 10
      }
      else
        ifactor PIRATE2A
      {
        debris SCRAP2 10
        debris SCRAP1 5
        debris SCRAP3 3
        lotsofglass 10
      }
      else
        ifactor PIRATE3A
      {
        debris SCRAP2 10
        debris SCRAP1 5
        debris SCRAP3 3
        lotsofglass 10
      }
      else
        ifactor PIRATE4A
      {
        debris SCRAP2 10
        debris SCRAP1 5
        debris SCRAP3 3
        lotsofglass 10
      }
      else
        ifactor PIRATE4A
      {
        debris SCRAP2 10
        debris SCRAP1 5
        debris SCRAP3 3
        lotsofglass 10
      }
      else
        ifactor PIRATE5A
      {
        debris SCRAP2 10
        debris SCRAP1 5
        debris SCRAP3 3
        lotsofglass 10
      }
      else
        ifactor PIRATE6A
      {
        debris SCRAP2 10
        debris SCRAP1 5
        debris SCRAP3 3
        lotsofglass 10
      }
      else
      {
        lotsofglass 10
        debris SCRAP4 3
      }
      killit
    }
    else
      ifactor DOLPHIN1
    {
      guts JIBS6 1
      soundonce DOLPHINSND
      ifstrength TOUGH
      {
        cactor DOLPHIN2
        sound SQUISHED
      }
    }
    else
      ifactor DOLPHIN2
    {
      guts JIBS6 1
      soundonce DOLPHINSND
    }
    else
      ifactor ROBOTDOG2
    {
      guts JIBS6 1
      soundonce WHINING_DOG
    }
  }
  else
  {
    ifactor CLOCK
      nullop
    else
      ifactor TOPSECRET
        nullop
    else
      ifactor SKINNEDCHICKEN
        nullop
    else
      ifactor FEATHEREDCHICKEN
        nullop
    else
      ifactor FOODOBJECT2
        nullop
    else
      ifactor FOODOBJECT6
        nullop
    else
      ifactor DOLPHIN1
        nullop
    else
      ifactor DOLPHIN2
        nullop
    else
      fall
  }


ends

action ABURGERROTS 0 1 5
useractor notenemy DUKEBURGER PIRATEGALSTRENGTH ABURGERROTS state breakobject enda

useractor notenemy MOP WEAK state breakobject enda

useractor notenemy BROOM WEAK state breakobject enda

useractor notenemy WETFLOOR WEAK state breakobject enda

useractor notenemy DESKLAMP WEAK state breakobject enda

// useractor notenemy DUKECUTOUT WEAK state breakobject enda

useractor notenemy HATRACK WEAK state breakobject enda

useractor notenemy GUNPOWDERBARREL TOUGH state breakobject enda

useractor notenemy COFFEEMACHINE WEAK state breakobject enda

useractor notenemy TEDDYBEAR WEAK state breakobject enda

useractor notenemy TOPSECRET WEAK state breakobject enda

useractor notenemy ROBOTMOUSE ROBOTMOUSESTRENGTH state breakobject enda

useractor notenemy MAN PIRATEGALSTRENGTH state breakobject enda

useractor notenemy MAN2 PIRATEGALSTRENGTH state breakobject enda

useractor notenemy WOMAN PIRATEGALSTRENGTH state breakobject enda

useractor notenemy PIRATE1A PIRATEGALSTRENGTH state breakobject enda

useractor notenemy PIRATE2A PIRATEGALSTRENGTH state breakobject enda

useractor notenemy PIRATE3A PIRATEGALSTRENGTH state breakobject enda

useractor notenemy PIRATE4A PIRATEGALSTRENGTH state breakobject enda

useractor notenemy PIRATE5A PIRATEGALSTRENGTH state breakobject enda

useractor notenemy PIRATE6A PIRATEGALSTRENGTH state breakobject enda

useractor notenemy ROBOTPIRATE PIRATEGALSTRENGTH state breakobject enda

useractor notenemy PIRATEHALF TOUGH state breakobject enda

useractor notenemy CHESTOFGOLD WEAK state breakobject enda

useractor notenemy ROBOTDOG PIRATEGALSTRENGTH state breakobject enda

useractor notenemy ROBOTDOG2 TOUGH state breakobject enda

useractor notenemy PLEASEWAIT state breakobject enda

useractor notenemy FOODOBJECT1 WEAK state breakobject enda

useractor notenemy FOODOBJECT2 WEAK state breakobject enda

useractor notenemy FOODOBJECT3 WEAK state breakobject enda

useractor notenemy FOODOBJECT4 WEAK state breakobject enda

useractor notenemy FOODOBJECT5 WEAK state breakobject enda

useractor notenemy FOODOBJECT6 WEAK state breakobject enda

useractor notenemy FOODOBJECT7 WEAK state breakobject enda

useractor notenemy FOODOBJECT8 WEAK state breakobject enda

useractor notenemy FOODOBJECT9 WEAK state breakobject enda

useractor notenemy FOODOBJECT10 WEAK state breakobject enda

useractor notenemy FOODOBJECT11 WEAK state breakobject enda

useractor notenemy FOODOBJECT12 WEAK state breakobject enda

useractor notenemy FOODOBJECT13 WEAK state breakobject enda

useractor notenemy FOODOBJECT14 WEAK state breakobject enda

useractor notenemy FOODOBJECT15 WEAK state breakobject enda

useractor notenemy FOODOBJECT16 WEAK state breakobject enda

useractor notenemy FOODOBJECT17 WEAK state breakobject enda

useractor notenemy FOODOBJECT18 WEAK state breakobject enda

useractor notenemy FOODOBJECT19 WEAK state breakobject enda

useractor notenemy FOODOBJECT20 WEAK state breakobject enda

useractor notenemy JOLLYMEAL WEAK state breakobject enda

useractor notenemy GUMBALLMACHINE WEAK state breakobject enda

useractor notenemy GUMBALLMACHINEBROKE WEAK state breakobject enda

useractor notenemy POLICELIGHTPOLE TOUGH state breakobject enda

useractor notenemy CLOCK WEAK state breakobject enda

useractor notenemy MAILBAG WEAK state breakobject enda

useractor notenemy FEATHEREDCHICKEN WEAK state breakobject enda

useractor notenemy SKINNEDCHICKEN WEAK state breakobject enda

useractor notenemy HEADLAMP WEAK state breakobject enda

useractor notenemy DOLPHIN1 DOLPHINSTRENGTH state breakobject enda

useractor notenemy DOLPHIN2 DOLPHINSTRENGTH state breakobject enda

useractor notenemy SNAKEP MEDIUMSTRENGTH state breakobject enda

useractor notenemy DONUTS WEAK state breakobject enda

useractor notenemy GAVALS WEAK state breakobject enda

useractor notenemy GAVALS2 WEAK state breakobject enda

useractor notenemy CUPS WEAK state breakobject enda

useractor notenemy DONUTS2 WEAK state breakobject enda

useractor notenemy FLOORBASKET WEAK state breakobject enda

useractor notenemy METER WEAK state breakobject enda

useractor notenemy DESKPHONE WEAK state breakobject enda

useractor notenemy MACE WEAK state breakobject enda

useractor notenemy SHOPPINGCART WEAK state breakobject enda

useractor notenemy COFFEEMUG WEAK state breakobject enda



state headhitstate

// Unrem the following line to invoke screen tilting during
// low player hitpoint damage.

// wackplayer

ends


action EXPBARRELFRAME     0   2   1   1   15
actor EXPLODINGBARREL 26
  fall
  ifaction EXPBARRELFRAME
  {
    ifactioncount 2
    {
      hitradius 1024 WEAKEST WEAK MEDIUMSTRENGTH TOUGH
      spawn EXPLOSION2
      debris SCRAP2 2
      sound PIPEBOMB_EXPLODE
      killit
    }
    break
  }
  ifsquished
  {
    debris SCRAP1 5
    killit
    break
  }
  ifhitweapon
    action EXPBARRELFRAME
enda

action BURNING_FLAME  0   12   1   1   2
move BURNING_VELS 

state burningstate

  sleeptime 300


  ifspawnedby BURNING
  {
    ifgapzl 16
      break
  }
  else
    ifspawnedby BURNING2
  {
    ifgapzl 16
      break
  }

  ifpdistg 10240
    break

  ifcount 128
  {
    ifspawnedby TIRE
    {
      ifactioncount 512
        killit
      ifrnd 16
        sizeto 64 48
    }
    else
    {
      sizeto 8 8
      sizeto 8 8
      ifcount 192
        killit
    }
  }
  else
  {
    ifmove 0
      move BURNING_VELS

    sizeto 52 52

    ifp palive
      ifpdistl 844
        ifrnd 32
          ifcansee
    {
      soundonce DUKE_LONGTERM_PAIN
      addphealth -1
      palfrom 24 16
    }
  }

ends

actor BURNING WEAK BURNING_FLAME
  state burningstate
enda

actor BURNING2 WEAK BURNING_FLAME
  state burningstate
enda

action TOILETWATERFRAMES 0 4 1 1 1
actor TOILETWATER 0 TOILETWATERFRAMES
  ifpdistl 8192
  {
    soundonce WATER_GURGLE
    ifspawnedby TOILET
      sizeto 34 34
    else
    {
      ifspawnedby WATERFOUNTAINBROKE
        sizeto 6 15
      else
        ifspawnedby TOILETWATER
          nullop
      else
        sizeto 24 32
    }

    ifp palive
      ifpdistl RETRIEVEDISTANCE
        ifp pfacing
          ifactioncount 32
            ifphealthl MAXPLAYERHEALTH
              ifhitspace
                ifcansee
    {
      addphealth 1
      globalsound DUKE_DRINKING
      resetactioncount
    }
  }
enda

action WOODENHORSEFRAME  0   1   4
action WOODENFALLFRAME  122  1   5

actor HORSEONSIDE WEAKEST
  cactor WOODENHORSE
  action WOODENFALLFRAME
enda
actor WOODENHORSE WEAK WOODENHORSEFRAME
  fall
  ifhitweapon
  {
    ifdead
    {
      debris SCRAP1 4
      debris SCRAP2 3
      killit
    }
    else
      action WOODENFALLFRAME
  }
enda

state steamcode
  ifpdistl 6144
    soundonce STEAM_HISSING

  ifcount 20
    {
      resetcount
      ifp palive
        ifpdistl 1024
      {
        addphealth -1
        palfrom 16 16
      }
    }
  else
  {
    ifspawnedby STEAM
      break
    else
      ifspawnedby CEILINGSTEAM
        break

    sizeto 24 24
  }
ends

action STEAMFRAMES    0     5     1     1     1
actor STEAM 0 STEAMFRAMES
  state steamcode
enda

actor CEILINGSTEAM 0 STEAMFRAMES
  state steamcode
enda

actor WATERBUBBLEMAKER 0 0 randomangle
  ifpdistl 3084
    ifrnd 24
      spawn WATERBUBBLE
enda

action BUBBLE
action CRACKEDBUBBLE  1
move BUBMOVE       -10 -36
move BUBMOVEFAST     -10 -52

actor WATERBUBBLE 0 BUBBLE BUBMOVE getv geth randomangle

  ifaction CRACKEDBUBBLE
  {
    ifinwater
      ifrnd 192
        killit
    ifactioncount 7
      killit
  }
  else
  {
    ifcount 4
    {
      ifrnd 192
        move BUBMOVE getv geth randomangle
      else
        move BUBMOVEFAST getv geth randomangle
      resetcount

      ifrnd 84
        sizeat 8 10
      else
        ifrnd 84
          sizeat 10 8
      else
        sizeat 9 9
    }

    ifonwater
    {
      iffloordistl 8
        action CRACKEDBUBBLE
    }
    else
      ifactioncount 40
        action CRACKEDBUBBLE
  }
enda


move SMOKEVEL 8 -16
move ENGINE_SMOKE 64 -64
move SMOKESHOOTOUT -192
action SMOKEFRAMES 0 4 1 1 10
actor SMALLSMOKE 0 SMOKEFRAMES
  ifmove 0
  {
    ifspawnedby RECON
      move SMOKESHOOTOUT geth
    else
      ifspawnedby SECTOREFFECTOR
        move ENGINE_SMOKE geth getv
    else
      move SMOKEVEL geth getv faceplayer
    ifspawnedby RPG
      cstat 2
  }
  ifpdistl 1596
    ifspawnedby RPG
      killit
  ifactioncount 4
    killit
enda

action BARREL_DENTING  2 2 1 1 6
action BARREL_DENTED   1
action BARREL_DENTED2  2

move SPAWNED_BLOOD

actor NUKEBARRELDENTED WEAK
  cactor NUKEBARREL
  action BARREL_DENTED
enda

actor NUKEBARRELLEAKED WEAK
  cactor NUKEBARREL
  action BARREL_DENTED2
enda

state random_ooz
  ifrnd 128
    spawn OOZ2
  else
    spawn OOZ
ends

actor NUKEBARREL MEDIUMSTRENGTH
  ifsquished
  {
    debris SCRAP1 32
    spawn BLOODPOOL
    state random_ooz
    killit
  }
  fall
  ifaction BARREL_DENTING
  {
    ifactioncount 2
    {
      debris SCRAP1 10
      ifrnd 2 spawn BLOODPOOL
      killit
    }
  }
  else
    ifhitweapon
  {
    ifdead
    {
      sound VENT_BUST

      ifrnd 128
        spawn BLOODPOOL
      action BARREL_DENTING
    }
    else
    {
      ifaction 0
        action BARREL_DENTED
      else
        ifaction BARREL_DENTED
      {
        action BARREL_DENTED2
        spawn BLOODPOOL
      }
      else
        ifaction BARREL_DENTED2
          action BARREL_DENTING
    }
  }
enda

state burningbarrelcode
  fall
  ifcount 32
  {
    resetcount
    ifp palive
      ifpdistl 1480
        ifp phigher
    {
      addphealth -1
      palfrom 16 16
      ifrnd 96
        sound DUKE_LONGTERM_PAIN
    }
  }
  ifhitweapon
  {
    sound VENT_BUST
    debris SCRAP1 10
    ifrnd 128
      spawn BURNING
    else
      spawn BURNING2
    killit
  }
ends

actor FIREBARREL
  state burningbarrelcode
enda
actor FIREVASE
  state burningbarrelcode
enda

action SHRINKERFRAMES 0 4 1 1 10
actor SHRINKEREXPLOSION 0 SHRINKERFRAMES
  ifactioncount 4
    killit
enda

action EXPLOSION_FRAMES 0 20 1 1  4
actor EXPLOSION2 1 EXPLOSION_FRAMES
  ifactioncount 20
    killit
enda

actor EXPLOSION2BOT 1 EXPLOSION_FRAMES
  ifactioncount 20
    killit
enda

action FFLAME_FR 0 16 1 1 1
action FFLAME 0 1 1 1 1

actor FLOORFLAME 0 FFLAME_FR
  ifaction FFLAME_FR
  {
    ifpdistl 1024
      hitradius 1024 WEAKEST WEAKEST WEAKEST WEAKEST
    ifactioncount 16
      action FFLAME
  }
  ifaction FFLAME
    ifrnd 4
  {
    action FFLAME_FR
    sound CAT_FIRE
    resetactioncount
  }
enda



action ASATNSPIN     0 5 1 1 4
action ASATSHOOTING   -10 3 5 1 40
action ASATWAIT      0 1 5 1 1
move TURRVEL

actor ROTATEGUN ROTTURRETSTRENGTH
// ASATSHOOTING TURRVEL faceplayer

  ifaction 0
  {
    action ASATSHOOTING
    move TURRVEL faceplayer
  }
  else
    ifaction ASATNSPIN
  {
    ifactioncount 32
    {
      action ASATWAIT
      move TURRVEL faceplayer
    }
  }
  else
    ifaction ASATSHOOTING
  {
    ifactioncount 12
      ifrnd 32
    {
      action ASATWAIT
      move 0
    }
    ifcount 32
      resetcount
    else
      ifcount 16
    {
      ifcount 17 nullop
      else
      {
        sound PRED_ATTACK
        shoot FIRELASER
      }
    }
    else
      ifcount 4
    {
      ifcount 5 nullop
      else
      {
        ifcansee
          ifcanshoottarget
        {
          sound PRED_ATTACK
          shoot FIRELASER
        }
      }
    }
  }
  else
    ifaction ASATWAIT
  {
    ifactioncount 64
      ifrnd 32
        ifp palive
          ifcansee
    {
      action ASATSHOOTING
      move TURRVEL faceplayer
    }
  }
  ifhitweapon
  {
    ifdead
    {
      addkills 1
      sound LASERTRIP_EXPLODE
      debris SCRAP1 15
      spawn EXPLOSION2
      killit
    }
    else
    {
      action ASATNSPIN
      debris SCRAP1 4
    }
    move 0
  }
enda

action RIP_F 0 8 1 1 1
actor FORCERIPPLE 0 RIP_F
  ifactioncount 8
    killit
enda

action TRANSFOWARD 0  6  1  1  2
action TRANSBACK   5  6  1 -1  2
actor TRANSPORTERSTAR 0 TRANSFOWARD
  ifaction TRANSFOWARD
  {
    ifactioncount 6
      action TRANSBACK
  }
  else
    ifactioncount 6
      killit
enda

action BEAMFOWARD  0  4  1  1  9
actor TRANSPORTERBEAM 0 BEAMFOWARD
  sizeto 32 64
  sizeto 32 64
  sizeto 32 64
  ifactioncount 4
    killit
enda

state getcode
  ifactor ATOMICHEALTH
    //globalsound GETATOMICHEALTH
  else
    globalsound DUKE_GET
  //palfrom 16 0 32
  ifrespawn
  {
    move RESPAWN_ACTOR_FLAG
    spawn RESPAWNMARKERRED
    cstat 32768
  }
  else
    killit
ends

state randgetweapsnds
  ifrnd 64
    globalsound DUKE_GETWEAPON1
  else
    ifrnd 96
      globalsound DUKE_GETWEAPON2
  else
    ifrnd 128
      globalsound DUKE_GETWEAPON3
  else
    ifrnd 140
      globalsound DUKE_GETWEAPON4
  else
    globalsound DUKE_GETWEAPON6
ends

state getweaponcode

  state randgetweapsnds

  palfrom 32 0 32
  ifgotweaponce 1
    break
  ifrespawn
  {
    move RESPAWN_ACTOR_FLAG
    spawn RESPAWNMARKERRED
    cstat 32768
  }
  else
    killit
ends


state respawnit
  ifcount RESPAWNITEMTIME
  {
    spawn TRANSPORTERSTAR
    move 0
    cstat 0
    sound TELEPORTER
  }
ends

state quikget
  ifactor ATOMICHEALTH
    //globalsound GETATOMICHEALTH
  	nullop
  else
    globalsound DUKE_GET
  //palfrom 16 0 32
  killit
ends

state quikweaponget
  state randgetweapsnds
  palfrom 32 0 32
  ifgotweaponce 1
    break
  killit
ends

actor STEROIDS
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk
      nullop
    else
      ifp palive
        ifcount 6
          ifpdistl RETRIEVEDISTANCE
            ifpinventory GET_STEROIDS STEROID_AMOUNT
              ifcanseetarget
      {
        addinventory GET_STEROIDS STEROID_AMOUNT
        quote 37
        ifspawnedby STEROIDS
          state getcode
        else
          state quikget
      }
enda

actor HEATSENSOR
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk
      nullop
  else
    ifp palive
      ifcount 6
        ifpdistl RETRIEVEDISTANCE
          ifpinventory GET_HEATS HEAT_AMOUNT
            ifcanseetarget
      {
        addinventory GET_HEATS HEAT_AMOUNT
        quote 101
        ifspawnedby HEATSENSOR
          state getcode
        else
          state quikget
      }
enda

actor AIRTANK
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifcount 6
          ifpdistl RETRIEVEDISTANCE
            ifpinventory GET_SCUBA SCUBA_AMOUNT
              ifcanseetarget
      {
        addinventory GET_SCUBA SCUBA_AMOUNT
        quote 39
        ifspawnedby AIRTANK
          state getcode
        else
          state quikget
      }
enda



//Actor Perks Useractors
actor RESPAWNMARKERYELLOW
	fall
	cstat 1
	sizeat 32 32
  ifcount 450 killit
  ifcount 360 setactor[THISACTOR].cstat 3
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
            ifcanseetarget
      {
        addvar skillpoints 1
        palfrom 40 64 64 64
        sound DUKE_GET
        killit
      }
enda

actor AMMO
	fall
  cstat 1
  sizeat 24 24
  getactor[THISACTOR].hitag temp
  ifvare temp -1 killit
  else ifvare temp 0 {
  	ifcount 450 killit
  	ifcount 360 setactor[THISACTOR].cstat 3
  }
enda

actor 4371 //Perk protector
	fall
  cstat 1
  sizeat 38 38
  getactor[THISACTOR].hitag temp
  ifvare temp -1 killit
  else ifvare temp 0 {
  	ifcount 450 killit
  	ifcount 360 setactor[THISACTOR].cstat 3
  }
enda

actor 1667 //Powershot
	fall
  cstat 1
  sizeat 27 22
  getactor[THISACTOR].hitag temp
  ifvare temp -1 killit
  else ifvare temp 0 {
  	ifcount 450 killit
  	ifcount 360 setactor[THISACTOR].cstat 3
  }
enda

actor BOOTS
	fall
  cstat 1
  getactor[THISACTOR].hitag temp
  ifvare temp -1 killit
  else ifvare temp 0 {
  	ifcount 450 killit
  	ifcount 360 setactor[THISACTOR].cstat 3
  }
enda

actor SHIELD
  fall
  cstat 1
  getactor[THISACTOR].hitag temp
  ifvare temp -1 killit
  else ifvare temp 0 {
  	ifcount 450 killit
  	ifcount 360 setactor[THISACTOR].cstat 3
  }
enda

action HOLODUKE_FRAMES 0 4 1 1 8
actor HOLODUKE 0 HOLODUKE_FRAMES
  fall
  cstat 1
  getactor[THISACTOR].hitag temp
  ifvare temp -1 killit
  else ifvare temp 0 {
  	ifcount 450 killit
  	ifcount 360 setactor[THISACTOR].cstat 3
  }
enda

actor 1234 //Money multiplier
	fall
  cstat 1
  sizeat 24 24
  getactor[THISACTOR].hitag temp
  ifvare temp -1 killit
  else ifvare temp 0 {
  	ifcount 450 killit
  	ifcount 360 setactor[THISACTOR].cstat 3
  }
enda

actor JETPACK
  fall
  cstat 1
  getactor[THISACTOR].hitag temp
  ifvare temp -1 killit
  else ifvare temp 0 {
  	ifcount 450 killit
  	ifcount 360 setactor[THISACTOR].cstat 3
  }
enda

actor GETICON //Spawner
	fall
  cstat 32768
  sizeat 2 2
  getactor[THISACTOR].hitag temp
  ifvare temp 0 {
  	state generatemonster
  } else ifvare temp 1 {
  	ifvare accesstoblue 1 state generatemonster
  } else ifvare temp 2 {
  	ifvare accesstored 1 state generatemonster
  } else ifvare temp 3 {
  	ifvare accesstoyellow 1 state generatemonster
  }
  ifvare intermission 0 {
  	randvarvar temp spawners
		ifvare temp 0 {
			ifvare havespawnedorb 0 {
				setvar havespawnedorb 1
				spawn CRYSTALAMMO
			}
		}
  }
enda

actor ACCESSCARD
  fall
enda

actor BADGUYICON //Instakill
	state countitemcounter
	sizeat 64 64
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
            ifcanseetarget
      {
        headspritestat temp 10
        setvarvar temptwo temp
        whilevarn temp -1 {
        	setactorvar[temp].instakill 1
        	nextspritestat temp temp
        	ifvarvare temp temptwo setvar temp -1
        }
        killit
      }
enda

actor 2530 //Infinityammo
	sizeat 19 19
	state countitemcounter
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
            ifcanseetarget
      {
        headspritestat temp 10
        setvarvar temptwo temp
        whilevarn temp -1 {
        	getactor[temp].yvel tempfive
        	setplayervar[tempfive].infinityammo 1
        	//setactorvar[temp].infinityammo 1
        	nextspritestat temp temp
        	ifvarvare temp temptwo setvar temp -1
        }
        killit
      }
enda

actor BATTERYAMMO //Maxammo
	state countitemcounter
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
            ifcanseetarget
      {
        headspritestat temp 10
        setvarvar temptwo temp
        whilevarn temp -1 {
        	setactorvar[temp].maxammo 1
        	nextspritestat temp temp
        	ifvarvare temp temptwo setvar temp -1
        }
        killit
      }
enda

actor 4520 //Money
	state countitemcounter
	sizeat 28 28
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
            ifcanseetarget
      {
        addvar playermoneybonus 2000
        setvar bonusmoneycounter 60
        setvar moneyfromdroptimer 60
        palfrom 40 64 64 0
        sound DUKE_GET
        killit
      }
enda

actor 2825 //Double money powerup moneyfest
	state countitemcounter
	setactor[THISACTOR].pal 7
	sizeat 100 100
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
            ifcanseetarget
      {
        headspritestat temp 10
        setvarvar temptwo temp
        whilevarn temp -1 {
        	setactorvar[temp].moneyfest 1
        	nextspritestat temp temp
        	ifvarvare temp temptwo setvar temp -1
        }
        killit
      }
enda

actor CRYSTALAMMO //Orb
  ifvarn intermission 0 killit
  ifcount 900 killit
  sizeat 30 64
  setactor[THISACTOR].pal 17
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
            ifcanseetarget
      {
        setvar temp 50
        mulvarvar temp round
        addvarvar playermoneybonus temp //money
        addvarvar bonuses temp
        mulvar temp 4
        addvarvar experience temp
        setvar bonusmoneycounter 60
        palfrom 30 0 0 64
        setvar orbtimer 60
        sound 70

        killit
      }
enda

actor ATOMICHEALTH //Nuclear
  state countitemcounter
  fall
  setactor[THISACTOR].pal 23
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
            ifcanseetarget
      {
        headspritestat temp 1
        setvarvar temptwo temp
        whilevarn temp -1 {
        	setactorvar[temp].nuclear 1
        	nextspritestat temp temp
        	ifvarvare temp temptwo setvar temp -1
        }
        headspritestat temp 10
        setvarvar temptwo temp
        whilevarn temp -1 {
        	setactorvar[temp].nuclear 1
        	nextspritestat temp temp
        	ifvarvare temp temptwo setvar temp -1
        }
        killit
      }
enda

//WEAPONS
actor FIRSTGUNSPRITE
  fall
  cstat 1
  getactor[THISACTOR].hitag temp
  ifvare temp -1 killit
  else ifvare temp 0 {
  	ifcount 450 killit
  	ifcount 360 setactor[THISACTOR].cstat 3
  }
enda

actor SHOTGUNSPRITE
  fall
  cstat 1
  getactor[THISACTOR].hitag temp
  ifvare temp -1 killit
  else ifvare temp 0 {
  	ifcount 450 killit
  	ifcount 360 setactor[THISACTOR].cstat 3
  }
enda

actor CHAINGUNSPRITE
  fall
  cstat 1
  getactor[THISACTOR].hitag temp
  ifvare temp -1 killit
  else ifvare temp 0 {
  	ifcount 450 killit
  	ifcount 360 setactor[THISACTOR].cstat 3
  }
enda

actor RPGSPRITE
  fall
  cstat 1
  getactor[THISACTOR].hitag temp
  ifvare temp -1 killit
  else ifvare temp 0 {
  	ifcount 450 killit
  	ifcount 360 setactor[THISACTOR].cstat 3
  }
enda

actor HBOMBAMMO
  fall
  cstat 1
  getactor[THISACTOR].hitag temp
  ifvare temp -1 killit
  else ifvare temp 0 {
  	ifcount 450 killit
  	ifcount 360 setactor[THISACTOR].cstat 3
  }
enda

actor SHRINKERSPRITE
  fall
  cstat 1
  getactor[THISACTOR].hitag temp
  ifvare temp -1 killit
  else ifvare temp 0 {
  	ifcount 450 killit
  	ifcount 360 setactor[THISACTOR].cstat 3
  }
enda

actor DEVISTATORSPRITE
  fall
  cstat 1
  getactor[THISACTOR].hitag temp
  ifvare temp -1 killit
  else ifvare temp 0 {
  	ifcount 450 killit
  	ifcount 360 setactor[THISACTOR].cstat 3
  }
enda

actor TRIPBOMBSPRITE
  fall
  cstat 1
  getactor[THISACTOR].hitag temp
  ifvare temp -1 killit
  else ifvare temp 0 {
  	ifcount 450 killit
  	ifcount 360 setactor[THISACTOR].cstat 3
  }
enda

actor FREEZESPRITE
  fall
  cstat 1
  getactor[THISACTOR].hitag temp
  ifvare temp -1 killit
  else ifvare temp 0 {
  	ifcount 450 killit
  	ifcount 360 setactor[THISACTOR].cstat 3
  }
enda







actor FREEZEAMMO
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifcount 6
          ifpdistl RETRIEVEDISTANCE
            ifcanseetarget
      {
        addammo FREEZE_WEAPON FREEZEAMMOAMOUNT
        quote 66
        ifspawnedby FREEZEAMMO
          state getcode
        else
          state quikget
      }
enda

actor SHOTGUNAMMO
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifcount 6
          ifpdistl RETRIEVEDISTANCE
            ifcanseetarget
      {
        addammo SHOTGUN_WEAPON SHOTGUNAMMOAMOUNT
        quote 69
        ifspawnedby SHOTGUNAMMO
          state getcode
        else
          state quikget
      }
enda

actor AMMOLOTS
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifcount 6
          ifpdistl RETRIEVEDISTANCE
            ifcanseetarget
      {
        addammo PISTOL_WEAPON 48
        quote 65
        ifspawnedby AMMOLOTS
          state getcode
        else
          state quikget
      }
enda

actor GROWAMMO
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
            ifcanseetarget
      {
        addammo GROW_WEAPON GROWCRYSTALAMMOAMOUNT
        quote 123
        ifspawnedby GROWAMMO
          state getcode
        else
          state quikget
      }
enda

actor DEVISTATORAMMO
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
            ifcanseetarget
      {
        addammo DEVISTATOR_WEAPON DEVISTATORAMMOAMOUNT
        quote 14
        ifspawnedby DEVISTATORAMMO
          state getcode
        else
          state quikget
      }
enda

actor RPGAMMO
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else ifp palive
      ifpdistl RETRIEVEDISTANCE
        ifcount 6
          ifcanseetarget
      {
        addammo RPG_WEAPON RPGAMMOBOX
        quote 64
        ifspawnedby RPGAMMO
          state getcode
        else
          state quikget
      }
enda

actor SIXPAK
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
            ifphealthl MAXPLAYERHEALTH
              ifcanseetarget
      {
        addphealth 30
        quote 62
        ifspawnedby SIXPAK
          state getcode
        else
          state quikget
      }
enda

actor COLA
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
            ifphealthl MAXPLAYERHEALTH
              ifcanseetarget
      {
        addphealth 10
        quote 61
        ifspawnedby COLA
          state getcode
        else
          state quikget
      }
enda

actor FIRSTAID
  fall
  ifmove RESPAWN_ACTOR_FLAG state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
            ifpinventory GET_FIRSTAID FIRSTAID_AMOUNT
              ifcanseetarget
      {
        addinventory GET_FIRSTAID FIRSTAID_AMOUNT
        quote 3

        ifspawnedby FIRSTAID
          state getcode
        else
          state quikget
      }
enda

action FIRE_FRAMES   -1 14 1 1 1
move FIREVELS

state firestate

  ifaction 0
    ifrnd 16
    {
      action FIRE_FRAMES
      cstator 128
    }

  sleeptime 300         // Never let it fall to sleep

  ifspawnedby FIRE
  {
    ifgapzl 16
      break
  }
  else
    ifspawnedby FIRE2
  {
    ifgapzl 16
      break
  }

  ifinwater
    killit

  ifp palive
    ifpdistl 844
      ifrnd 32
        ifcansee
  {
    soundonce DUKE_LONGTERM_PAIN
    addphealth -1
    palfrom 32 32
  }

  ifactor FIRE
  {
    ifspawnedby FIRE
      break
  }
  else
    ifactor FIRE2
      ifspawnedby FIRE2
        break

  iffloordistl 128
  {
    ifrnd 128
    {
      ifcount 84
        killit
                // This line(and the else below)
                // is not necessary, since actors
                // with zero x-size are automatically
                // deleted anyway!
      else
        ifcount 80
          sizeto 0 0
      else
        sizeto 32 32
    }
  }
  else
    killit

ends

useractor notenemy FIRE WEAK 0 FIREVELS state firestate enda
useractor notenemy FIRE2 WEAK 0 FIREVELS state firestate enda

actor FECES
  ifcount 24
  {
    ifpdistl RETRIEVEDISTANCE
    {
      ifrnd SWEARFREQUENCY
        soundonce DUKE_STEPONFECES

      sound STEPNIT

      spawn BLOODPOOL   // Will be brown
      killit
    }
  }
  else
    sizeto 32 32
enda

state drop_ammo
  ifrnd SPAWNAMMOODDS
    spawn AMMO
ends

state drop_battery
  ifrnd SPAWNAMMOODDS
    spawn BATTERYAMMO
ends
state drop_sgshells
  ifrnd SPAWNAMMOODDS
    spawn SHOTGUNAMMO
ends
state drop_shotgun
  ifrnd SPAWNAMMOODDS
    spawn SHOTGUNSPRITE
ends
state drop_chaingun
  ifrnd SPAWNAMMOODDS
  {
    ifrnd 32
      spawn CHAINGUNSPRITE
    else
      spawn BATTERYAMMO
  }
ends


state random_wall_jibs
  ifrnd 96
    shoot BLOODSPLAT1
  ifrnd 96
    shoot BLOODSPLAT2
  ifrnd 96
    shoot BLOODSPLAT3
  ifrnd 96
    shoot BLOODSPLAT4
  ifrnd 96
    shoot BLOODSPLAT1
ends




action FEMSHRUNK
action FEMFROZEN1 1
action FEMGROW
action FEMFROZEN2
action FEMDANCE1 19 1 1 1 16
action FEMDANCE3 19 1 1 1 26
action FEMDANCE2 20 2 1 1 10

action FEMANIMATESLOW 0 2 1 1 100
action TOUGHGALANIM   0 5 1 1 25
action FEMANIMATE

state femcode

  ifactor NAKED1 nullop
  else
    ifactor FEM6 nullop
    else
    {
      fall
      ifactor BLOODYPOLE
        ifhitweapon
          ifdead
      {
        state standard_jibs
        killit
      }
    }

  ifaction FEMSHRUNK
  {
    ifcount SHRUNKDONECOUNT
    {
      action FEMANIMATE
      cstat 257
    }
    else
      ifcount SHRUNKCOUNT
        sizeto 40 40
    else
      state genericshrunkcode
  }
  else ifaction FEMGROW
  {
    ifcount 32
    {
      respawnhitag
      guts JIBS4 20
      guts JIBS6 20
      spritepal 6
      soundonce LADY_SCREAM
      ifactor NAKED1
        debris SCRAP3 4
      else
        ifactor PODFEM1
          debris SCRAP3 4
      sound SQUISHED
      killit
    }
    else
      sizeto MAXXSTRETCH MAXYSTRETCH
  }

  else
    ifaction FEMDANCE1
  {
    ifactioncount 2
      action FEMDANCE2
  }
  else
    ifaction FEMDANCE2
  {
    ifactioncount 8
      action FEMDANCE3
  }
  else
    ifaction FEMDANCE3
  {
    ifactioncount 2
    action FEMANIMATE
  }
  else
    ifaction FEMFROZEN1
  {
    ifcount THAWTIME
    {
      action FEMANIMATE
      getlastpal
    }
    else
      ifcount FROZENDRIPTIME
    {
      ifactioncount 26
      {
        spawn WATERDRIP
        resetactioncount
      }
    }

    ifhitweapon
    {
      ifwasweapon FREEZEBLAST
      {
        strength 0
        break
      }
      lotsofglass 30
      sound GLASS_BREAKING
      respawnhitag
      ifrnd 84
        spawn BLOODPOOL
      killit
    }
    else
      ifp pfacing
        ifpdistl FROZENQUICKKICKDIST
          pkick
    break
  }
  else ifaction FEMFROZEN2
  {
    ifcount THAWTIME
    {
      ifactor TOUGHGAL
        action TOUGHGALANIM
      else
        ifactor FEM10
          action FEMANIMATESLOW
      else
        action FEMANIMATE

      getlastpal
    }
    else
      ifcount FROZENDRIPTIME
    {
      ifactioncount 26
      {
        spawn WATERDRIP
        resetactioncount
      }
    }

    ifhitweapon
    {
      ifwasweapon FREEZEBLAST
      {
        strength 0
          break
      }

      lotsofglass 30

      sound GLASS_BREAKING
      ifrnd 84
        spawn BLOODPOOL
      respawnhitag

      ifrnd 128
        sound DUKE_HIT_STRIPPER1
      else
        sound DUKE_HIT_STRIPPER2

      killit
    }
    else
      ifp pfacing
        ifpdistl FROZENQUICKKICKDIST
          pkick
    break
  }

  ifhitweapon
  {
    ifdead
    {
      ifwasweapon GROWSPARK
      {
        cstat 0
        move 0
        sound ACTOR_GROWING
        action FEMGROW
        break
      }
      else ifwasweapon FREEZEBLAST
      {
        ifaction FEMSHRUNK
          break

        ifactor NAKED1
          action FEMFROZEN2
        else
          ifactor FEM5
            action FEMFROZEN2
        else
          ifactor FEM6
            action FEMFROZEN2
        else
          ifactor FEM8
            action FEMFROZEN2
        else
          ifactor FEM9
            action FEMFROZEN2
        else
          ifactor FEM10
            action FEMFROZEN2
        else
          ifactor TOUGHGAL
            action FEMFROZEN2
        else
          ifactor PODFEM1
            action FEMFROZEN2
        else
          action FEMFROZEN1

        move 0
        spritepal 1
        strength 0

        sound SOMETHINGFROZE

        break
      }

      ifrnd 128
        sound DUKE_HIT_STRIPPER1
      else
        sound DUKE_HIT_STRIPPER2

      respawnhitag
      state standard_jibs
      state random_wall_jibs
      spawn BLOODPOOL

      ifactor FEM1
        money 5
      else
        ifactor FEM2
      {
        money 7
        cactor BARBROKE
        cstat 0
      }
      else
        ifactor FEM3
          money 4
      else
        ifactor FEM7
          money 8

      ifactor FEM5
      {
        strength TOUGH
        cactor BLOODYPOLE
      }
      else ifactor FEM6
      {
        cstat 0
        cactor FEM6PAD
      }
      else
        ifactor FEM8
      {
        strength TOUGH
        cactor BLOODYPOLE
      }
      else
      {
        spritepal 6
        soundonce LADY_SCREAM
        ifactor NAKED1
          debris SCRAP3 18
        else
          ifactor PODFEM1
            debris SCRAP3 18
        killit
      }
    }
    else
    {
      ifwasweapon SHRINKSPARK
      {
        sound ACTOR_SHRINKING
        move 0
        action FEMSHRUNK
        //cstat 0
        break
      }
      else
        ifwasweapon GROWSPARK
          sound EXPANDERHIT
      ifactor FEM8
        break

      ifactor TOUGHGAL
          state toughgalspeech
      else sound SQUISHED

      guts JIBS6 1
    }
  }
ends

state killme
  ifinwater nullop
  else
    ifp pfacing
      ifpdistl 1280
        ifhitspace
          soundonce KILLME
ends

state tipme
  ifp pfacing
    ifpdistl 1280
      ifhitspace
  {
    tip
    ifrnd 128
      soundonce DUKE_TIP1
    else
      soundonce DUKE_TIP2
    ifactor FEM1
      action FEMDANCE1
  }
ends

state toughgaltalk
  ifp pfacing
    ifpdistl 1280
      ifhitspace
        state toughgalspeech
ends

actor FEM1 TOUGH FEMANIMATE
  state tipme
  state femcode
enda
actor FEM2 TOUGH FEMANIMATE
  state tipme
  state femcode
enda
actor FEM3 TOUGH FEMANIMATE
  state tipme
  state femcode
enda
actor FEM4 TOUGH FEMANIMATE
  state femcode
enda
actor FEM5 TOUGH FEMANIMATE
  state killme
  state femcode
enda
actor FEM6 TOUGH FEMANIMATE
  state killme
  state femcode
enda
actor FEM7 TOUGH FEMANIMATE
  state tipme
  state femcode
enda
actor FEM8 TOUGH FEMANIMATE
  state femcode
enda
actor FEM9 TOUGH FEMANIMATE
  state femcode
enda
actor FEM10 TOUGH FEMANIMATESLOW
  state tipme
  state femcode
enda

actor TOUGHGAL MANWOMANSTRENGTH TOUGHGALANIM
  state toughgaltalk
  state femcode
enda

actor NAKED1 TOUGH FEMANIMATE
  state killme
  state femcode
enda
actor PODFEM1 TOUGH FEMANIMATE
  state killme
  state femcode
enda
actor BLOODYPOLE TOUGH
  state femcode
enda
actor STATUEFLASH
  fall
  ifcount 32
    cactor STATUE
enda
actor STATUE
  fall
  ifp pfacing
    ifpdistl 1280
      ifhitspace
  {
    cactor STATUEFLASH
    move 0
  }
enda

actor MIKE
  ifp pfacing
    ifpdistl 1280
      ifhitspace
        mikesnd
enda



state troop_body_jibs
  ifrnd 64
    guts HEADJIB1 1
  ifrnd 64
    guts LEGJIB1 2
  ifrnd 64
    guts ARMJIB1 1
  ifrnd 48
    spawn BLOODPOOL
ends

state liz_body_jibs
  ifrnd 64
    guts LIZMANHEAD1 1
  ifrnd 64
    guts LIZMANLEG1 2
  ifrnd 64
    guts LIZMANARM1 1
  ifrnd 48
    spawn BLOODPOOL
ends

action BLOODFRAMES 0 4 1 1 15
actor BLOOD 0 BLOODFRAMES
  sizeto 72 72 sizeto 72 72 sizeto 72 72
  ifpdistg 3144 killit
  ifactioncount 4 killit
enda

action EGGOPEN1 1 1 1 1 4
action EGGOPEN2 2 1 1 1 4
action EGGOPEN3 2 1 1 1 4
action EGGWAIT  0
action EGGFROZEN 1
action EGGGROW 1
action EGGSHRUNK 1

actor EGG TOUGH
  fall
  ifaction 0
  {
    ifcount 64
    {
      ifrnd 128
      {
        action EGGWAIT
        move 0
      }
      else
      {
        sound SLIM_HATCH
        action EGGOPEN1
      }
    }
  }
  else
    ifaction EGGOPEN1
      ifactioncount 4
        action EGGOPEN2
  else
    ifaction EGGOPEN2
      ifactioncount 4
    {
      spawn GREENSLIME
      action EGGOPEN3
    }
  else
    ifaction EGGGROW
      state genericgrowcode
  else
    ifaction EGGSHRUNK
      state genericshrunkcode
  else
    ifaction EGGFROZEN
  {
    ifcount THAWTIME
    {
      action 0
      getlastpal
    }
    else
      ifcount FROZENDRIPTIME
    {
      ifactioncount 26
      {
        spawn WATERDRIP
        resetactioncount
      }
    }

    ifhitweapon
    {
      ifwasweapon FREEZEBLAST
      {
        strength 0
        break
      }
      lotsofglass 30

      sound GLASS_BREAKING
      ifrnd 84
        spawn BLOODPOOL

      addkills 1
      killit
    }

    // ifp pducking
    ifp pfacing
      ifpdistl FROZENQUICKKICKDIST
        pkick

    break
  }

  ifhitweapon
  {
    ifdead
    {
      ifwasweapon FREEZEBLAST
      {
        sound SOMETHINGFROZE
        spritepal 1
        move 0
        action EGGFROZEN
        strength 0
        break
      }
      else
        ifwasweapon GROWSPARK
      {
        cstat 0
        move 0
        sound ACTOR_GROWING
        action EGGGROW
        break
      }

      addkills 1

      sound SQUISHED

      state standard_jibs
      killit
    }
    else
      ifwasweapon SHRINKSPARK
      {
        move 0
        sound ACTOR_SHRINKING
        action EGGSHRUNK
        break
      }

      ifwasweapon GROWSPARK
        sound EXPANDERHIT
  }
  else
    ifaction EGGWAIT
  {
    ifcount 512
      ifrnd 2
    {
      ifaction EGGSHRUNK
        break
      sound SLIM_HATCH
      action EGGOPEN1
    }
  }

enda

actor KNEE KNEE_WEAPON_STRENGTH enda
actor SPIT SPIT_WEAPON_STRENGTH enda
actor CHAINGUN CHAINGUN_WEAPON_STRENGTH enda
actor SHOTGUN SHOTGUN_WEAPON_STRENGTH enda
actor FIRELASER FIRELASER_WEAPON_STRENGTH enda
actor HEAVYHBOMB HANDBOMB_WEAPON_STRENGTH enda
//actor BOUNCEMINE BOUNCEMINE_WEAPON_STRENGTH enda
actor MORTER MORTER_WEAPON_STRENGTH enda
actor SHRINKSPARK SHRINKER_WEAPON_STRENGTH enda



actor GROWSPARK GROWSPARK_WEAPON_STRENGTH
  ifcount 18
    killit
  else
    ifcount 9
  {
    sizeto 0 0
    sizeto 0 0
    sizeto 0 0
    sizeto 0 0
  }
  else
  {
    sizeto 28 28
    sizeto 28 28
    sizeto 28 28
    sizeto 28 28
  }
enda

actor RPG RPG_WEAPON_STRENGTH enda
actor FREEZEBLAST FREEZETHROWER_WEAPON_STRENGTH enda
actor DEVISTATORBLAST FREEZETHROWER_WEAPON_STRENGTH enda
actor COOLEXPLOSION1 COOL_EXPLOSION_STRENGTH enda
actor TRIPBOMB TRIPBOMB_STRENGTH enda

action WEAP2FRAMES 0  4  1  1  6
actor SHOTSPARK1 PISTOL_WEAPON_STRENGTH WEAP2FRAMES
  ifdead
    killit
  ifactioncount 4
    killit
  else
  {
    ifactioncount 3
    {
      ifinwater
      spawn WATERBUBBLE
    }
    else
      ifcount 2 nullop
      else
        ifonwater
          spawn WATERSPLASH2
  }
enda

state standard_pjibs
  guts JIBS1 1
  guts JIBS3 2
  guts JIBS4 1
  guts JIBS5 1
  guts JIBS6 2
  guts DUKETORSO 1
  guts DUKELEG 2
  guts DUKEGUN 1
ends

move DUKENOTMOVING
state handle_dead_dukes
  fall
  ifmove 0   // 1st time initializiation...
  {
    ifrnd 128
      cstat 4
    else
      cstat 0
    move DUKENOTMOVING
  }

  ifsquished
  {
    sound SQUISHED
    state random_ooz
    killit
  }
  else
    ifcount 1024
      ifpdistg 4096
        killit
  else
  {
    strength 0
    ifhitweapon
      ifwasweapon RADIUSEXPLOSION
    {
      state standard_jibs
      killit
    }
  }
ends

action PLYINGFRAMES 0 1 0 1 1
actor DUKELYINGDEAD 0 PLYINGFRAMES
  state handle_dead_dukes
enda

action PGROWING   0
action PSTAND     0   1   5   1  1
action PEXPLODE   106   5   1   1   10
action PEXPLODEAD   113   1   1
action PJPHOUVER  15   1   5   1
action PWALK    20   4   5   1   16
action PRUN     20   4   5   1   10
action PWALKBACK  45   4   5  -1   16
action PRUNBACK   45   4   5  -1   10
action PJUMPING   50   4   5   1   30
action PFALLING   65   1   5
action PDUCKING   86   1   5
action PCRAWLING  86   3   5   1   20
action PAKICKING  40   2   5   1   25
action PFLINTCHING  106  1   1   1   10
action PTHROWNBACK  106  5   1   1   18
action PFROZEN     20  1   5
action PLYINGDEAD   113  1   1

action PSWIMMINGGO   375   1   5   1   10
action PSWIMMING   375   4   5   1   13
action PSWIMMINGWAIT 395   1   5   1   13
action PTREDWATER  395   2   5   1   17

move PSTOPED
move PSHRINKING // used as a var only

state check_pstandard
  ifp pwalking
    action PWALK
  else
    ifp pkicking
      action PAKICKING
  else
    ifp pwalkingback
      action PWALKBACK
  else
    ifp prunning
      action PRUN
  else
    ifp prunningback
      action PRUNBACK
  else
    ifp pjumping
      action PJUMPING
  else
    ifp pducking
      action PDUCKING
ends



move PGROWINGPOP        // Used only as a variable

actor APLAYER MAXPLAYERHEALTH PSTAND 0 0
	state handleskills
	state handlemaxammo
	state endgame
	state preventhbombpickup
	state handlenegativeammodevastator
	state calculatetotalpoints
	state movementspeed
	state generatemonster
	state currentlyearnedmoney
	state nofalldmg
	state keycardaccess
	state checkhitscan
	state buy
	state manualreload
	state doonce
	state handlepowershot
	state jumpheight
	state hpregen //Pal
	state handlemonsterdrops //Pal
	state gotmoneyfromteammate //Pal
	state setuplevelsystem
	state preventoddammoamount

	ifvarg autooffcounter 0 {
		subvar autooffcounter 1
		ifvare autooffcounter 1 {
			setvar showskilloverlay 0
		}
	}

	ifvare gotarmor 1 {
		setvarvar temp playerhealth
		addvar temp 20
		setplayer[THISACTOR].max_player_health temp
		ifvare gothit 0 ifvare armorhpgiven 0 {
			addphealth 20
			setvar armorhpgiven 1
		} 
	}
	else {
		setplayer[THISACTOR].max_player_health playerhealth
		setvar armorhpgiven 0
	}

	getactor[THISACTOR].htextra temp
	ifvarg temp 0 {
	  getactor[THISACTOR].htowner temp
	  getactor[THISACTOR].htpicnum temptwo
	  ifvarvare temp THISACTOR {
	  	setvarvar hpregencounter hpregencountervar
	  	ifvare temptwo RPG setactor[THISACTOR].htextra 30
	  	else ifvare temptwo FREEZEBLAST setactor[THISACTOR].htextra 3
	  	else ifvare temptwo RADIUSEXPLOSION setactor[THISACTOR].htextra 49
	  }               
	}
	

	ifvarg chaingunheat 0 {
		ifvarg chaingunheat 250 {
			sound STEAM_HISSING
			setvar hasoverheated 1
		} 
		ifvarg chaingunheat 150 subvar chaingunheat 1
		else subvar chaingunheat 2
	} else setvar hasoverheated 0
	ifvarg successfulrevivetimer 0 subvar successfulrevivetimer 1
	ifvarg revivetimer 0 subvar revivetimer 2 //Always reduce revivetimer bar
	ifvarl revivetimer 0 setvar revivetimer 0 //Make sure its not negative
	ifp palive {
		cstat 257 //Blockable + hitable
		setvarvar downtimer downtimervar
		setvar isdown 0
		setvar isdead 0
		getactor[THISACTOR].extra temp
		getplayer[THISACTOR].max_player_health temptwo
		ifvarvarg temp temptwo {
			subvar temp 1
			setactor[THISACTOR].extra temp
		}
		//Intermission
		ifvarg intermission 0 { 
			ifvare gothit 0 {
				setvarvar temp round
				mulvar temp 100
				subvar temp 100
				addvarvar playermoneybonus temp
				addvarvar bonuses temp 
				mulvar temp 2
				addvarvar experience temp
				setvar gothit -1
				setvar nohittimer 60
			} else ifvarg nohittimer 0 subvar nohittimer 1
			ifvare intermission 1 setvar gothit 0
		} else { //Intermission over
			getplayer[THISACTOR].max_player_health temp
			getactor[THISACTOR].extra temptwo
			ifvarvarl temptwo temp setvar gothit 1
		} 
	}
	ifdead { //Handle revive and perks and stuff
		ifvare isdead 0 { //If duke is NOT entirely dead
			cstat 1 //Blockable
			
			//Autorevive perk
			ifvare gotautorevive 1 {
    		setvar gotautorevive 0
    		setvarvar autorevivetimer autorevivetimervar
    	} 
    	ifvarg autorevivetimer 0 {
    		setvar isdown 0 //Duke is not down bc he is about to respawn from autorevive
				subvar autorevivetimer 1
				state autoreviveeffects
				ifvare autorevivetimer 1 {
					state respawnfromautorevive
					action PSTAND
				}
			} else setvar isdown 1 //If duke has no autorevive he is down
   		
   		ifvare isdown 1 {
   			subvar downtimer 1
				getactor[THISACTOR].yvel temptwo //Populating idofdyingduke
				setvarvar idofdyingduke temptwo //Populating idofdyingduke
   			ifvare gotrevivedbyplayer 1 {
   				addlog
   				randvar temp 10
   				addlogvar temp
   				ifvare temp 0 sound DUKE_GETWEAPON1
   				ifvare temp 1 sound DUKE_GETWEAPON2
   				ifvare temp 2 sound DUKE_GETWEAPON3
   				ifvare temp 3 sound DUKE_GETWEAPON4
   				ifvare temp 4 sound DUKE_GETWEAPON6
   				ifvare temp 5 sound DUKE_PISSRELIEF
   				ifvare temp 6 sound BONUS_SPEECH1
   				ifvare temp 7 sound BONUS_SPEECH2
   				ifvare temp 8 sound BONUS_SPEECH3
   				ifvare temp 9 sound BONUS_SPEECH4
   				ifvare temp 10 sound DUKE_GOTHEALTHATLOW
   				setvar gotrevivedbyplayer 0
   				state respawnfromplayerrevive
   				action PSTAND
   			}
   		} 			
			ifvare downtimer 0 {
				setvar isdead 1
				state dieeffects
			} 
			
		} else { //Duke is entirely dead
			cstat 32768 //Invisible
			setvar isdown 0
			setvar showoverlay 1
			ifvarg intermission 0 { //If duke is dead but there's intermission, respawn
				state respawnfromintermission
				action PSTAND
			}
		}
	}

  ifaction 0
    action PSTAND

  ifaction PFROZEN
  {
    cstat 257

    fall

    palfrom 16 0 0 24

    ifmove 0
    {
      ifhitweapon
      {
        ifwasweapon FREEZEBLAST
          break
        lotsofglass 60
        ifrnd 84
          spawn BLOODPOOL

        sound GLASS_BREAKING
        spawn ATOMICHEALTH

        getlastpal

        move 1
        break
      }
    }
    else
    {
      //quote 13
      ifhitspace
      {
        //action PSTAND
        //resetplayer
      }
      break
    }

    ifactioncount THAWTIME
    {
      getlastpal
      strength 1
      move 0
      action PSTAND
    }
    else
      ifactioncount FROZENDRIPTIME
    {
      ifrnd 32
      spawn WATERDRIP
    }

    ifp pfacing   // assumes another other player  (multiplayer)
      ifpdistl FROZENQUICKKICKDIST
        pkick

    break
  }

  ifdead
  {
    ifaction PGROWING
    {
      ifmove PGROWINGPOP
      {
        //quote 13
        ifhitspace
        {
          //action 0
          //resetplayer
        }
        break
      }
      else
      {
        ifcount 32
        {
          sound SQUISHED
          palfrom 48 64

          state standard_pjibs

          guts JIBS4 20
          guts JIBS6 20
          move PGROWINGPOP
          cstat 32768
          //tossweapon

          hitradius 2048 60 70 80 90

        }
        else
          sizeto MAXXSTRETCH MAXYSTRETCH
      }
      break
    }

    ifsquished
      palfrom 32 63 63 63
    else
      fall

    ifactioncount 7
      move 0
    else
      ifactioncount 6
    {
      ifmultiplayer nullop
      else
      {
        ifrnd 32
          sound DUKE_KILLED5
        else
          ifrnd 32
            sound DUKE_KILLED3
        else
          ifrnd 32
            sound DUKE_KILLED1
        else
          ifrnd 32
            sound DUKE_KILLED2
      }
    }

    ifaction PLYINGDEAD
    {
      ifactioncount 3
        move PSTOPED
      //quote 13
      ifhitspace
      {
        //action PSTAND
        //spawn DUKELYINGDEAD
        //resetplayer
      }
      break
    }

    ifaction PTHROWNBACK
    {
      ifactioncount 5
      {
        spawn BLOODPOOL
        action PLYINGDEAD
      }
      else
        ifactioncount 1
          move 0
      break
    }

    ifaction PEXPLODEAD
    {
      //quote 13
      ifhitspace
      {
        //resetplayer
        //action PSTAND
      }
      break
    }
    ifaction PEXPLODE
    {
      ifactioncount 5
      {
        action PEXPLODEAD
        spawn BLOODPOOL
      }
      break
    }

    ifp pshrunk
    {
      state standard_pjibs
      spawn BLOODPOOL

      sound SQUISHED
      sound DUKE_DEAD

      cstat 32768         // Hide the sprite

      action PLYINGDEAD
    }
    else
    {
      ifinwater
      {
        action PLYINGDEAD
        spawn WATERBUBBLE
        spawn WATERBUBBLE
      }
      else
      {
        action PEXPLODE
        state standard_pjibs
        cstat 32768
        sound SQUISHED
        sound DUKE_DEAD
      }
    }

    //tossweapon

    break
  }

  ifsquished
  {
    strength -1
    sound SQUISHED
    state random_ooz
    break
  }



  ifp ponsteroids
  {
    ifp pstanding nullop
    else
      spawn FRAMEEFFECT1
  }

  ifmove PSHRINKING
  {
    /*
    ifcount 32
    {
      ifcount SHRUNKDONECOUNT
      {
        move 0
        cstat 257
      }
      else
        ifcount SHRUNKCOUNT
      {
        sizeto 42 36
        ifgapzl 24
        {
          strength 0
          sound SQUISHED
          palfrom 48 64
          break
        }
      }
      else
        ifp ponsteroids
          count SHRUNKCOUNT
    }
    else
    {
      ifp ponsteroids
        count SHRUNKCOUNT
      else
      {
        sizeto 8 9
        spawn FRAMEEFFECT1
      }
    }
  */
  }
  else ifhitweapon
  {
    ifdead
    {
      ifmultiplayer
        sound DUKE_KILLED4

      ifwasweapon GROWSPARK
      {
        palfrom 48 48
        action PGROWING
        count 0
        move 0
        sound ACTOR_GROWING
        cstat 0
        break
      }
    }
    else
    {
      ifmultiplayer
      {
        ifphealthl YELLHURTSOUNDSTRENGTHMP
        {
          ifrnd 64
            sound DUKE_LONGTERM_PAIN2
          else
            ifrnd 64
              sound DUKE_LONGTERM_PAIN3
          else
            ifrnd 64
              sound DUKE_LONGTERM_PAIN4
          else
            sound DUKE_DEAD
        }
        else
        {
          ifrnd 64
            sound DUKE_LONGTERM_PAIN5
          else ifrnd 64
            sound DUKE_LONGTERM_PAIN6
          else ifrnd 64
            sound DUKE_LONGTERM_PAIN7
          else
            sound DUKE_LONGTERM_PAIN8
        }
      }
      else
      {
        ifphealthl YELLHURTSOUNDSTRENGTH
        {
          ifrnd 74
            sound DUKE_LONGTERM_PAIN2
          else
            ifrnd 8
              sound DUKE_LONGTERM_PAIN3
          else
            sound DUKE_LONGTERM_PAIN4
        }
        ifrnd 128
          sound DUKE_LONGTERM_PAIN
      }
    }
    ifstrength TOUGH
    {
      state headhitstate
      sound DUKE_GRUNT
      ifp pstanding
        action PFLINTCHING
    }

    ifwasweapon RPG
    {
      ifrnd 32
        spawn BLOOD
      ifdead
        state standard_pjibs
      palfrom 48 52
      break
    }
    ifwasweapon RADIUSEXPLOSION
    {
      setvarvar hpregencounter hpregencountervar
      ifrnd 32
        spawn BLOOD
      ifdead
        state standard_pjibs
      palfrom 48 52
      break
    }
    ifwasweapon FIREEXT
    {
      ifrnd 32
        spawn BLOOD
      ifdead
        state standard_pjibs
      palfrom 48 52
      break
    }
    ifwasweapon GROWSPARK
    {
      palfrom 48 52
      sound EXPANDERHIT
      break
    }
    ifwasweapon SHRINKSPARK
    {
      //setvar gothit 1
      palfrom 56 0 0 0
      //move PSHRINKING // used as a var only.
      //sound ACTOR_SHRINKING
      //cstat 0
      setvar haltcounter 30
      break
    }
    ifwasweapon SHOTSPARK1
      palfrom 24 48
    ifwasweapon FREEZEBLAST
    {
      palfrom 48 0 0 48
      ifdead
      {
        //sound SOMETHINGFROZE
        //spritepal 1
        //move 0
        //action PFROZEN
        break
      }
    }
    ifwasweapon COOLEXPLOSION1
      palfrom 48 48 0 48
    ifwasweapon KNEE
      palfrom 16 32
    ifwasweapon FIRELASER
      palfrom 32 32

    ifdead
    {
      action PTHROWNBACK
      //tossweapon
    }

    state random_wall_jibs

    break
  }

  ifaction PFLINTCHING
  {
    ifactioncount 2
      action PSTAND
    break
  }

  ifinwater
  {
    ifaction PTREDWATER
    {
      ifp pwalking prunning
        action PSWIMMINGGO
    }
    else
      ifp pstanding pwalkingback prunningback
        action PTREDWATER
    else
    {
      ifaction PSWIMMING
      {
        ifrnd 4
          spawn WATERBUBBLE
        ifactioncount 4
          action PSWIMMINGWAIT
      }
      else
        ifaction PSWIMMINGWAIT
      {
        ifactioncount 2
          action PSWIMMINGGO
      }
      else
        ifaction PSWIMMINGGO
      {
        ifactioncount 2
          action PSWIMMING
      }
      else
        action PTREDWATER
    }

    ifrnd 4
      spawn WATERBUBBLE // For effect

    break
  }
  else ifp pjetpack
  {
    ifaction PJPHOUVER
    {
      ifactioncount 4
        resetactioncount
    }
    else
      action PJPHOUVER
    break
  }
  else
  {
    ifaction PTREDWATER
      action PSTAND
    ifaction PSWIMMING
      action PSTAND
    ifaction PSWIMMINGWAIT
      action PSTAND
    ifaction PSWIMMINGGO
      action PSTAND
    ifaction PJPHOUVER
      action PFALLING
  }

  ifaction PFALLING
  {
    ifp ponground
      action PSTAND
    else
    {
      ifp pfalling
        break
      else
        state check_pstandard
    }
  }

  ifaction PDUCKING
  {
    ifgapzl 48
    {
      ifp pwalking pwalkingback prunning prunningback
        action PCRAWLING
    }
    else ifp pducking
    {
      ifp pwalking pwalkingback prunning prunningback
        action PCRAWLING
    }
    else
    {
      ifp pstanding
        action PSTAND
      else
        state check_pstandard
    }
  }

  else ifaction PCRAWLING
  {
    ifgapzl 48
    {
      ifp pstanding
        action PCRAWLING
    }
    else
      ifp pducking
    {
      ifp pstanding
        action PDUCKING
    }
    else
    {
      ifp pstanding
        action PSTAND
      else
        state check_pstandard
    }
  }
  else
    ifgapzl 48
      action PDUCKING

  else
    ifaction PJUMPING
  {
    ifp ponground
      action PSTAND
    else
      ifactioncount 4
        ifp pfalling
          action PFALLING
  }

  ifp pfalling
    action PFALLING
  else
    ifaction PSTAND
      state check_pstandard
  else
    ifaction PAKICKING
  {
    ifactioncount 2
      action PSTAND
    break
  }
  else
    ifaction PWALK
  {
    ifp pfalling
      action PFALLING
    else
      ifp pstanding
        action PSTAND
    else
      ifp prunning
        action PRUN
    else
      ifp pwalkingback
        action PWALKBACK
    else
      ifp prunningback
        action PRUNBACK
    else
      ifp pjumping
        action PJUMPING
    else
      ifp pducking
        action PDUCKING
  }

  else
    ifaction PRUN
  {
    ifp pstanding
      action PSTAND
    else
      ifp pwalking
        action PWALK
    else
      ifp pwalkingback
        action PWALKBACK
    else
      ifp prunningback
        action PRUNBACK
    else
      ifp pjumping
        action PJUMPING
    else
      ifp pducking
        action PDUCKING
  }

  else
    ifaction PWALKBACK
  {
    ifp pstanding
      action PSTAND
    else
      ifp pwalking
        action PWALK
    else
      ifp prunning
        action PRUN
    else
      ifp prunningback
        action PRUNBACK
    else
      ifp pjumping
        action PJUMPING
    else
      ifp pducking
        action PDUCKING
  }

  else
    ifaction PRUNBACK
  {
    ifp pstanding
      action PSTAND
    else
      ifp pwalking
        action PWALK
    else
      ifp prunning
        action PRUN
    else
      ifp pwalkingback
        action PWALKBACK
    else
      ifp pjumping
        action PJUMPING
    else
      ifp pducking
        action PDUCKING
  }
enda





actor ORGANTIC TURRETSTRENGTH
  ifcount 48
    resetcount
  else
  {
    ifcount 32
    sizeto 32 32
  }
  else
    ifcount 16
    {
      sizeto 48 18
      ifpdistl 2048
      {
        sound TURR_ATTACK
        addphealth -2
        palfrom 32 16
      }
    }
  ifhitweapon
  {
    ifdead
    {
      addkills 1
      sound TURR_DYING
      guts JIBS5 10
      killit
    }
    sound TURR_PAIN
    break
  }
  ifrnd 1
    soundonce TURR_ROAM
enda

state rf
  ifrnd 128
    cstat 4
  else
    cstat 0
ends


//
//
//    TROOP/LIZTROOP CODE
//
//

action ATROOPSTAND     0  1  5  1  1
action ATROOPGROW    0  1  5  1  1
action ATROOPSTAYSTAND  -2  1  5  1  1
action ATROOPWALKING   0  4  5  1   12
action ATROOPWALKINGBACK 15   4  5   -1   12
action ATROOPRUNNING   0  4  5  1  8
action ATROOPSHOOT    35  1  5  1   30
action ATROOPJETPACK  40  1  5  1  1
action ATROOPJETPACKILL 40  2  5  1   50
action ATROOPFLINTCH  50  1  1  1  6
action ATROOPDYING    50  5  1  1   16
action ATROOPDEAD     54
action ATROOPPLAYDEAD   54
action ATROOPSUFFERDEAD 58  2  1   -4   24
action ATROOPSUFFERING  59  2  1  1   21
action ATROOPDUCK     64  1  5  1  3
action ATROOPDUCKSHOOT  64  2  5  1   25
action ATROOPABOUTHIDE  74  1  1  1   25
action ATROOPHIDE     79  1  1  1   25
action ATROOPREAPPEAR   74  1  1  1   25
action ATROOPFROZEN    0  1  5

move TROOPWALKVELS 72
move TROOPWALKVELSBACK -72
move TROOPJETPACKVELS 64 -84
move TROOPJETPACKILLVELS 192 -38
move TROOPRUNVELS 108
move TROOPSTOPPED
move DONTGETUP
move SHRUNKVELS 32

ai AITROOPSEEKENEMY  ATROOPWALKING   TROOPWALKVELS seekplayer
ai AITROOPSEEKPLAYER ATROOPWALKING   TROOPWALKVELS seekplayer
ai AITROOPFLEEING  ATROOPWALKING   TROOPWALKVELS fleeenemy
ai AITROOPFLEEINGBACK ATROOPWALKINGBACK   TROOPWALKVELSBACK faceplayer
ai AITROOPDODGE    ATROOPWALKING   TROOPRUNVELS  dodgebullet
ai AITROOPSHOOTING   ATROOPSHOOT   TROOPSTOPPED  faceplayer
ai AITROOPDUCKING  ATROOPDUCK    TROOPSTOPPED  faceplayer
ai AITROOPJETPACK  ATROOPJETPACK   TROOPJETPACKVELS seekplayer
ai AITROOPSHRUNK   ATROOPWALKING   SHRUNKVELS fleeenemy
ai AITROOPHIDE     ATROOPABOUTHIDE TROOPSTOPPED faceplayer
ai AITROOPGROW     ATROOPGROW    DONTGETUP faceplayerslow

state troophidestate
  ifaction ATROOPREAPPEAR
  {
    ifactioncount 2
    {
      sound TELEPORTER
      ai AITROOPSHOOTING
      cstat 257
    }
    else
    {
      sizeto 41 40
      sizeto 41 40
      sizeto 41 40
      sizeto 41 40
      spawn FRAMEEFFECT1
    }
  }
  else
    ifaction ATROOPWALKING
  {
    ifpdistl 2448
      ifpdistg 1024
    {
      ifceilingdistl 48
        break
      ifp pfacing
        break

      ifgapzl 64 nullop
      else
        ifawayfromwall
      {
        spawn TRANSPORTERSTAR
        action ATROOPREAPPEAR
        move 0
        break
      }
    }
  }
  else
    ifaction ATROOPHIDE
  {
    ifactioncount 2
    {
      spawn TRANSPORTERSTAR
      sound TELEPORTER
      action ATROOPWALKING
      move TROOPWALKVELS faceplayer
      cstat 32768
    }
    else
    {
      sizeto 4 40
      sizeto 4 40
      sizeto 4 40
      sizeto 4 40
      spawn FRAMEEFFECT1
    }
  }
  else
    ifaction ATROOPABOUTHIDE
      ifactioncount 2
    {
      action ATROOPHIDE
      cstat 0
    }
ends


state troopgunnashoot
  ifp palive
  {
    ifpdistl 1024
      ai AITROOPSHOOTING
    else
      ifactornotstayput
    {
      ifactioncount 12
        ifrnd 16
          ifcanshoottarget
      {
        ifspritepal 21
          ifrnd 4
            ifpdistg 4096
              ai AITROOPHIDE
        else
        {
          ifpdistl 1100
            ai AITROOPFLEEING
          else
          {
            ifpdistl 4096
              ifcansee
                ifcanshoottarget
                  ai AITROOPSHOOTING
            else
            {
              move TROOPRUNVELS seekplayer
              action ATROOPRUNNING
            }
          }
        }
      }
    }
    else
      ifcount 26
        ifrnd 32
          ai AITROOPSHOOTING
  }
ends

state troopseekstate
  state troopgunnashoot
  ifinwater
  {
    ai AITROOPJETPACK
    break
  }
  ifcansee
  {
    ifmove TROOPRUNVELS
      ifpdistl 1596
        ai AITROOPDUCKING
    ifp phigher
    {
      ifceilingdistl 128 nullop
      else
        ifactornotstayput
          ai AITROOPJETPACK
      break
    }
    else
      ifrnd 2
    {
      ifspritepal 21
        ifpdistg 1596
      {
        ai AITROOPHIDE
        break
      }
      ifbulletnear
      {
        ifrnd 128
          ai AITROOPDODGE
        else
          ai AITROOPDUCKING
        break
      }
    }
  }
  ifnotmoving
  {
    ifrnd 32
      operate
    else
      ifcount 32
        ifp palive
          ifcansee
            ifcanshoottarget
              ai AITROOPSHOOTING
  }
  ifrnd 1
  {
    ifrnd 128
      soundonce PRED_ROAM
    else
      soundonce PRED_ROAM2
  }
ends

state troopduckstate
  ifaction ATROOPDUCK
  {
    ifactioncount 8
    {
      ifp palive
      {
        ifrnd 128
          action ATROOPDUCKSHOOT
      }
      else
        ifmove DONTGETUP
          break
        else
          ai AITROOPSEEKPLAYER
    }
  }
  else
    ifaction ATROOPDUCKSHOOT
  {
    ifcount 64
    {
      ifmove DONTGETUP
        resetcount
      else
      {
        ifpdistl 1100
          ai AITROOPFLEEING
        else
          ai AITROOPSEEKPLAYER
      }
    }
    else
      ifactioncount 2
      {
        ifcanshoottarget
        {
          sound PRED_ATTACK
          resetactioncount
          shoot FIRELASER
        }
        else ai AITROOPSEEKPLAYER
      }
  }
ends

state troopshootstate
  ifactioncount 2
  {
    ifcanshoottarget
    {
      shoot FIRELASER
      sound PRED_ATTACK
      resetactioncount
      ifrnd 128
        ai AITROOPSEEKPLAYER
      ifcount 24
      {
        ifrnd 96
          ifpdistg 2048
            ai AITROOPSEEKPLAYER
          else
          {
            ifpdistg 1596
              ai AITROOPFLEEING
            else
              ai AITROOPFLEEINGBACK
          }
      }
    }
    else
      ai AITROOPSEEKPLAYER
  }
ends

state troopfleestate
  ifactioncount 7
  {
    ifpdistg 3084
    {
      ai AITROOPSEEKPLAYER
      break
    }
    else
      ifrnd 32
        ifp palive
          ifcansee
            ifcanshoottarget
      {
        ifrnd 128
          ai AITROOPDUCKING
        else
          ai AITROOPSHOOTING
          break
      }
  }
  ifnotmoving
  {
    ifrnd 32
      operate
    else
      ifcount 32
        ifp palive
          ifcansee
            ifcanshoottarget
      {
        ifrnd 128
          ai AITROOPSHOOTING
        else
          ai AITROOPDUCKING
      }
  }
ends

state troopdying
  iffloordistl 32
  {
    ifactioncount 5
    {
      cstat 0
      iffloordistl 8
      sound THUD
      ifrnd 64
        spawn BLOODPOOL
      state rf
      strength 0
      move TROOPSTOPPED
      action ATROOPDEAD
    }
    break
  }
  else
  {
    state rf
    move 0
    action ATROOPDYING
  }
ends

state checktroophit
  ifaction ATROOPSUFFERING
  {
    stopsound LIZARD_BEG
    sound PRED_DYING
    cstat 0
    strength 0
    action ATROOPSUFFERDEAD
    break
  }
  ifdead
  {
    ifwasweapon FREEZEBLAST
    {
      sound SOMETHINGFROZE
      spritepal 1
      move 0
      action ATROOPFROZEN
      strength 0
      break
    }

    state drop_ammo
    state random_wall_jibs

    ifwasweapon GROWSPARK
    {
      cstat 0
      sound ACTOR_GROWING
      ai AITROOPGROW
      break
    }

    addkills 1

    ifwasweapon RPG
    {
      sound SQUISHED
      state troop_body_jibs
      state standard_jibs
      killit
    }
    else
      ifwasweapon RADIUSEXPLOSION
    {
      sound SQUISHED
      state troop_body_jibs
      state standard_jibs
      killit
    }
    else
    {
      sound PRED_DYING
      ifrnd 32
        iffloordistl 32
      {
        sound LIZARD_BEG
        spawn BLOODPOOL
        strength 0
        move 0
        action ATROOPSUFFERING
        break
      }
      action ATROOPDYING
      break
    }
  }
  else
  {
    state random_wall_jibs
    sound PRED_PAIN

    ifwasweapon SHRINKSPARK
    {
      sound ACTOR_SHRINKING
      ai AITROOPSHRUNK
    }
    else
      ifwasweapon GROWSPARK
        sound EXPANDERHIT
    else
      iffloordistl 32
        ifrnd 96
          action ATROOPFLINTCH
  }
ends

state troopjetpackstate
  ifaction ATROOPJETPACKILL
  {
    ifcansee
      ifactioncount 2
    {
      resetactioncount
      sound PRED_ATTACK
      shoot FIRELASER
    }

    ifp phigher
      ai AITROOPJETPACK
    else
      ifinwater
        ai AITROOPJETPACK
    else
      ifcount 26
        iffloordistl 32
          ai AITROOPSEEKPLAYER
  }
  else
    ifcount 48
      ifcansee
  {
    action ATROOPJETPACKILL
    move TROOPJETPACKILLVELS
    seekplayer
  }
ends

state checksquished
  ifsquished
  {
    addkills 1
    sound SQUISHED
    state standard_jibs
    state random_ooz
    killit
  }
ends

state troopsufferingstate
  ifactioncount 2
  {
    ifrnd 16
      spawn WATERDRIP
    ifactioncount 14
    {
      stopsound LIZARD_BEG
      cstat 0
      strength 0
      action ATROOPSUFFERDEAD
      break
    }
  }
ends

state troopshrunkstate
  ifcount SHRUNKDONECOUNT
    ai AITROOPSEEKENEMY
  else
    ifcount SHRUNKCOUNT
      sizeto 48 40
  else
    state genericshrunkcode
ends


state troopcode fall
  ifinwater
    ifrnd 1
      spawn WATERBUBBLE
  ifaction ATROOPSTAND
  {
    ifrnd 192
      ai AITROOPSHOOTING
    else
      ai AITROOPSEEKPLAYER
  }
  else
    ifaction ATROOPFROZEN
  {
    ifcount THAWTIME
    {
      ai AITROOPSEEKENEMY
      getlastpal
    }
    else
      ifcount FROZENDRIPTIME
    {
      ifactioncount 26
      {
        spawn WATERDRIP
        resetactioncount
      }
    }
    ifhitweapon
    {
      ifwasweapon FREEZEBLAST
      {
        strength 0
        break
      }
      addkills 1

      ifrnd 84
        spawn BLOODPOOL
      lotsofglass 30
      sound GLASS_BREAKING
      killit
    }
    ifp pfacing
      ifpdistl FROZENQUICKKICKDIST
        pkick
    break
  }
  else ifaction ATROOPPLAYDEAD
  {
    ifhitweapon
    {
      ifwasweapon RADIUSEXPLOSION
      {
        sound SQUISHED
        state troop_body_jibs
        state standard_jibs
        killit
      }
      break
    }
    else
      state checksquished

    ifcount PLAYDEADTIME
    {
      addkills -1
      soundonce PRED_ROAM
      cstat 257
      strength 1
      ai AITROOPSHOOTING
    }
    else
      ifp pfacing
        resetcount

    break
  }
  else
    ifaction ATROOPDEAD
  {
    strength 0
    ifrespawn
      ifcount RESPAWNACTORTIME
    {
      spawn TRANSPORTERSTAR
      cstat 257
      strength TROOPSTRENGTH
      ai AITROOPSEEKENEMY
    }
    ifhitweapon
    {
      ifwasweapon RADIUSEXPLOSION
      {
        sound SQUISHED
        state troop_body_jibs
        state standard_jibs
        killit
      }
      break
    }
    else
      state checksquished
    break
  }
  else
    ifaction ATROOPSUFFERDEAD
  {
    ifactioncount 2
    {
      ifrnd 64
      {
        resetcount
        action ATROOPPLAYDEAD
      }
      else
      {
        soundonce PRED_DYING
        action ATROOPDEAD
      }
    }
  }
  else
    ifaction ATROOPDYING
  {
    state troopdying
    break
  }
  else
    ifaction ATROOPSUFFERING
  {
    state troopsufferingstate
    ifhitweapon
      state checktroophit
    break
  }
  else
    ifaction ATROOPFLINTCH
  {
    ifactioncount 4
      ai AITROOPSEEKENEMY
  }
  else
  {
    ifai AITROOPSEEKPLAYER
      state troopseekstate
    else
      ifai AITROOPJETPACK
    {
      state troopjetpackstate
      ifinwater nullop
      else
        soundonce DUKE_JETPACK_IDLE
    }
    else
      ifai AITROOPSEEKENEMY
        state troopseekstate
    else
      ifai AITROOPSHOOTING
        state troopshootstate
    else
      ifai AITROOPFLEEING
        state troopfleestate
    else
      ifai AITROOPFLEEINGBACK
        state troopfleestate
    else
      ifai AITROOPDODGE
        state troopseekstate
    else
      ifai AITROOPDUCKING
        state troopduckstate
    else
      ifai AITROOPSHRUNK
        state troopshrunkstate
    else
      ifai AITROOPGROW
        state genericgrowcode
    else
      ifai AITROOPHIDE
    {
      state troophidestate
      break
    }
  }

  ifhitweapon
    state checktroophit
  else
    state checksquished
ends

state checktrooppalette
  ifai 0
  {
    ifspritepal 0
        nullop
    else
        ifspritepal 21
          addstrength TROOPSTRENGTH // Double the hitpoint vals
  }
ends


actor LIZTROOPJETPACK TROOPSTRENGTH
  state checktrooppalette
  ai AITROOPJETPACK
  cactor LIZTROOP
enda

actor LIZTROOPDUCKING TROOPSTRENGTH
  state checktrooppalette
  ai AITROOPDUCKING
  cactor LIZTROOP
  ifgapzl 48
    move DONTGETUP
enda

actor LIZTROOPSHOOT TROOPSTRENGTH ATROOPSTAND
  state checktrooppalette
  ai AITROOPSHOOTING
  cactor LIZTROOP
enda
actor LIZTROOPSTAYPUT TROOPSTRENGTH ATROOPSTAYSTAND
  state checktrooppalette
  ai AITROOPSEEKPLAYER
  cactor LIZTROOP
enda
actor LIZTROOPRUNNING TROOPSTRENGTH ATROOPSTAND
  state checktrooppalette
  ai AITROOPSEEKPLAYER
  cactor LIZTROOP
enda
actor LIZTROOPONTOILET TROOPSTRENGTH
  ifcount 24
  {
    sound FLUSH_TOILET
    operate
    ai AITROOPSEEKPLAYER
    cactor LIZTROOP
  }
  else
    ifcount 2
      nullop
  else
    state checktrooppalette
enda

actor LIZTROOPJUSTSIT TROOPSTRENGTH
  ifcount 30
  {
    operate
    ai AITROOPSEEKPLAYER
    cactor LIZTROOP
  }
  else
    ifcount 2
      nullop
  else
    state checktrooppalette
enda


actor LIZTROOP TROOPSTRENGTH ATROOPSTAND
  state checktrooppalette
  state troopcode
enda

action ALIZSTAND     0
action ALIZWALKING     0   4  5  1  15
action ALIZRUNNING     0   4  5  1  11
action ALIZTHINK     20  2  5  1  40
action ALIZSCREAM    30  1  5  1  2
action ALIZJUMP      45  3  5  1  20
action ALIZFALL      55  1  5
action ALIZSHOOTING    70  2  5  1  7
action ALIZDYING     60  6  1  1  15
action ALIZLYINGDEAD   65  1
action ALIZFROZEN     0  1  5

move LIZWALKVEL 72
move LIZRUNVEL 192
move LIZJUMPVEL 184
move LIZSTOP

ai AILIZGETENEMY ALIZWALKING LIZWALKVEL seekplayer
ai AILIZDODGE ALIZRUNNING LIZRUNVEL dodgebullet
ai AILIZCHARGEENEMY ALIZRUNNING LIZRUNVEL seekplayer
ai AILIZFLEENEMY ALIZWALKING LIZWALKVEL fleeenemy
ai AILIZSHOOTENEMY ALIZSHOOTING LIZSTOP faceplayer
ai AILIZJUMPENEMY ALIZJUMP LIZJUMPVEL jumptoplayer
ai AILIZTHINK ALIZTHINK LIZSTOP faceplayerslow
ai AILIZSHRUNK ALIZWALKING SHRUNKVELS fleeenemy
ai AILIZGROW ALIZSTAND  LIZSTOP faceplayerslow
ai AILIZSPIT ALIZSCREAM LIZSTOP faceplayerslow
ai AILIZDYING ALIZDYING LIZSTOP faceplayer

state lizseekstate

  ifactornotstayput
  {
    ifcansee
      ifp palive
        ifpdistl 2048
          ifcount 16
            ifcanshoottarget
    {
      ai AILIZSHOOTENEMY
      break
    }
    ifai AILIZCHARGEENEMY
    {
      ifcount 72
        ifcanshoottarget
      {
        ai AILIZSHOOTENEMY
        break
      }
      ifp phigher
        ifpdistg 2048
          ifrnd 6
      {
        ai AILIZJUMPENEMY
        break
      }
    }
    else
      ifpdistg 4096
    {
      ifrnd 92
      {
        ifcount 48
          ifcanshoottarget
            ai AILIZSHOOTENEMY
      }
      else
        ifcount 24
      {
        ai AILIZCHARGEENEMY
        break
      }
    }

    iffloordistl 16
    {
      ifcount 48
        ifnotmoving
          ifcansee
      {
        ai AILIZJUMPENEMY
        break
      }
    }
    else
    {
      ifpdistg 1280
        ai AILIZJUMPENEMY
      break
    }

    ifrnd 4
      ifnotmoving
        operate
    else
      ifrnd 1
        ifbulletnear
    {
      ifgapzl 128
        ai AILIZDODGE
      else
        ifactornotstayput
      {
        ifrnd 32
          ai AILIZJUMPENEMY
        else
          ai AILIZDODGE
      }
    }
  }
  else
  {
    ifactioncount 16
    {
      ifp palive
        ifrnd 32
          ifcansee
            ifcanshoottarget
              ai AILIZSHOOTENEMY
    }
    ifcount 16
      ifrnd 32
        move LIZWALKVEL randomangle geth
  }

ends

state lizshrunkstate
  ifcount SHRUNKDONECOUNT
    ai AILIZGETENEMY
  else
    ifcount SHRUNKCOUNT
      sizeto 48 40
  else
    state genericshrunkcode
ends

state lizfleestate
  ifcount 16
  {
    ifrnd 48
      ifp palive
        ifcansee
          ai AILIZSPIT
  }
  else
  {
    iffloordistl 16 nullop
    else
      ai AILIZGETENEMY
    break
  }
ends

state lizthinkstate
  ifrnd 8
    soundonce CAPT_ROAM
  ifactioncount 3
  {
    ifrnd 32
      ifp palive
        ifcansee
          ai AILIZSPIT
        else
          ifrnd 96
            ai AILIZGETENEMY
  }
  else
    ifactioncount 2
      ifrnd 1
        spawn FECES
  ifrnd 1
    ifbulletnear
  {
    ifgapzl 96
      ai AILIZDODGE
    else
    {
      ifrnd 128
        ai AILIZJUMPENEMY
      else
        ai AILIZDODGE
    }
  }
ends

state lizshootstate
  ifcount 20
    ifrnd 8
  {
    ifcansee
      ifpdistl 2048
    {
      ifrnd 128
        ai AILIZFLEENEMY
      break
    }
    ifrnd 80
      ai AILIZTHINK
    else
      ai AILIZGETENEMY
  }
  ifactioncount 2
  {
    ifcansee
    {
      ifcanshoottarget
      {
        sound CAPT_ATTACK
        shoot SHOTSPARK1
        resetactioncount
      }
      else
        ai AILIZTHINK
    }
    else
      ai AILIZGETENEMY
  }
ends

state checklizhit
  spawn BLOOD
  ifai AILIZSHRUNK
  {
    addkills 1
    sound SQUISHED
    state standard_jibs
    killit
  }
  ifdead
  {
    ifwasweapon FREEZEBLAST
    {
      sound SOMETHINGFROZE
      spritepal 1
      move 0
      action ALIZFROZEN
      strength 0
      break
    }

    state drop_chaingun

    ifwasweapon GROWSPARK
    {
      cstat 0
      sound ACTOR_GROWING
      ai AILIZGROW
      break
    }

    addkills 1

    ifwasweapon RPG
    {
      sound SQUISHED
      state liz_body_jibs
      state standard_jibs
      killit
    }
    else
      ifwasweapon RADIUSEXPLOSION
    {
      sound SQUISHED
      state liz_body_jibs
      state standard_jibs
      killit
    }
    else
    {
      state rf
      ai AILIZDYING
      ifrnd 64
        spawn BLOODPOOL
    }
    sound CAPT_DYING
  }
  else
  {
    sound CAPT_PAIN
    ifwasweapon SHRINKSPARK
    {
      sound ACTOR_SHRINKING
      ai AILIZSHRUNK
      break
    }
    ifwasweapon GROWSPARK
      sound EXPANDERHIT

    state random_wall_jibs
    ifp palive
      ifcansee
        ifcanshoottarget
    {
      ai AILIZSHOOTENEMY
      break
    }
  }
ends

state lizjumpstate
  ifaction ALIZFALL
  {
    iffloordistl 16
      ai AILIZGETENEMY
  }
  else
    ifactioncount 3
      action ALIZFALL
ends

state lizdyingstate
  ifaction ALIZLYINGDEAD
  {
    strength 0
    ifhitweapon
      ifwasweapon RADIUSEXPLOSION
    {
      sound SQUISHED
      state standard_jibs
      killit
    }
    ifcount RESPAWNACTORTIME
      ifrespawn
    {
      spawn TRANSPORTERSTAR
      cstat 257
      strength LIZSTRENGTH
      ai AILIZGETENEMY
    }
  }
  else
    ifai AILIZDYING
      ifactioncount 6
  {
    iffloordistl 8
      sound THUD
    move LIZSTOP
    action ALIZLYINGDEAD
  }
ends

state lizdodgestate
  ifcount 13
    ai AILIZGETENEMY
ends

actor LIZMANSTAYPUT LIZSTRENGTH ai AILIZGETENEMY cactor LIZMAN enda
actor LIZMANSPITTING LIZSTRENGTH ai AILIZSPIT cactor LIZMAN enda
actor LIZMANJUMP LIZSTRENGTH ai AILIZJUMPENEMY cactor LIZMAN enda

state lizcode
  state checksquished
  ifai 0
    ai AILIZGETENEMY
  else
    ifaction ALIZLYINGDEAD
  {
    fall
    state lizdyingstate
    break
  }
  else
    ifaction ALIZFROZEN
  {
    ifcount THAWTIME
    {
      ai AILIZGETENEMY
      getlastpal
    }
    else
      ifcount FROZENDRIPTIME
    {
      ifactioncount 26
      {
        spawn WATERDRIP
        resetactioncount
      }
    }

    ifhitweapon
    {
      ifwasweapon FREEZEBLAST
      {
        strength 0
        break
      }
      addkills 1

      ifrnd 84
        spawn BLOODPOOL
      lotsofglass 30
      sound GLASS_BREAKING
      killit
    }
    ifp pfacing
      ifpdistl FROZENQUICKKICKDIST
        pkick
    break
  }
  else
    ifai AILIZJUMPENEMY
      state lizjumpstate
  else
  {
    fall
    ifai AILIZGETENEMY
      state lizseekstate
    else
      ifai AILIZCHARGEENEMY
        state lizseekstate
    else
      ifai AILIZDODGE
        state lizdodgestate
    else
      ifai AILIZSHOOTENEMY
        state lizshootstate
    else
      ifai AILIZFLEENEMY
        state lizfleestate
    else
      ifai AILIZTHINK
        state lizthinkstate
    else
      ifai AILIZSHRUNK
        state lizshrunkstate
    else
      ifai AILIZGROW
        state genericgrowcode
    else
      ifai AILIZDYING
        state lizdyingstate
    else
      ifai AILIZSPIT
    {
      ifcount 26
        ai AILIZGETENEMY
      else
        ifcount 18
          ifrnd 96
      {
        shoot SPIT
        sound LIZARD_SPIT
      }
    }
  }

  ifai AILIZSHRUNK
    break
  ifhitweapon
    state checklizhit
ends

actor LIZMAN LIZSTRENGTH
  fall
  state lizcode
enda






action DRONEFRAMES   0   1   7   1   1
action DRONESCREAM   0   1   7   1   1
move DRONERUNVELS 128 64
move DRONERUNUPVELS 128 -64
move DRONEBULLVELS 252 -64
move DRONEBACKWARDS -64 -64
move DRONERISE 32 -32
move DRONESTOPPED -16

ai AIDRONEGETE DRONESCREAM DRONERUNVELS faceplayerslow getv
ai AIDRONEWAIT DRONEFRAMES DRONESTOPPED faceplayerslow
ai AIDRONEGETUP DRONESCREAM DRONERUNUPVELS faceplayer getv
ai AIDRONEPULLBACK DRONEFRAMES DRONEBACKWARDS faceplayerslow
ai AIDRONEHIT DRONESCREAM DRONEBACKWARDS faceplayer
ai AIDRONESHRUNK DRONEFRAMES SHRUNKVELS fleeenemy
ai AIDRONEDODGE DRONEFRAMES DRONEBULLVELS dodgebullet geth
ai AIDRONEDODGEUP DRONEFRAMES DRONERISE getv geth

state dronedead
  addkills 1
  debris SCRAP1 8
  debris SCRAP2 4
  debris SCRAP3 7
  spawn EXPLOSION2
  sound RPG_EXPLODE
  hitradius 2048 15 20 25 30

  getactor[THISACTOR].htowner temptwo
  getactor[temptwo].yvel tempthree
  ifstrength 1 {
  	getplayervar[tempthree].playermoney temptwo
  	addvarvar temptwo monsterhp
  	setplayervar[tempthree].moneycounter 60
  	setplayervar[tempthree].playermoney temptwo //money
  	getplayervar[tempthree].gotdoublemoney temptwo
  	ifvare temptwo 1 {
  		setvarvar temp monsterhp
  		divvar temp 4 //Double money rate
  		getplayervar[tempthree].playermoneybonus tempfive
  		addvarvar tempfive temp
  		setplayervar[tempthree].playermoneybonus tempfive //money
  		setplayervar[tempthree].bonusmoneycounter 60
  		getplayervar[tempthree].doublemoneygained tempfour
  		addvarvar tempfour temp
  		setplayervar[tempthree].doublemoneygained tempfour
  	}
  }
  killit
ends

state checkdronehitstate

  ifdead state dronedead
  else ifsquished state dronedead
  else
  {
    sound DRON_PAIN
    ifbulletnear
    {
      ifceilingdistl 64
        ifrnd 48
          ai AIDRONEDODGE
      ai AIDRONEDODGEUP
    }
    else
      ai AIDRONEGETE
  }
ends

state droneshrunkstate
  ifcount 24
    killit
  else
    sizeto 1 1
ends

state checkdronenearplayer

  ifp palive
    ifpdistl 1596
  {
    ifcount 8
    {
      addkills 1
      sound DRON_ATTACK2
      debris SCRAP1 8
      debris SCRAP2 4
      debris SCRAP3 7
      spawn EXPLOSION2
      sound RPG_EXPLODE
      hitradius 2048 15 20 25 30

      setvarvar temp monsterhp
    	divvar temp 2
    	addvarvar playermoney temp //money
    	setvar moneycounter 60
      ifvare gotdoublemoney 1 {
      	divvar temp 4 //Double money rate
      	addvarvar playermoneybonus temp //money
      	setvar bonusmoneycounter 60
      	addvarvar doublemoneygained temp
      } 
      killit
    }
    else
      ifcount 3 nullop
      else
        sound LASERTRIP_ARMING
  }

ends

state dronegetstate
  ifrnd 192
  {
    ifcansee
    {
      ifbulletnear
      {
        ai AIDRONEDODGE
        break
      }
      ifmove DRONEBULLVELS
      {
        ifcount 64
          ai AIDRONEPULLBACK
        else
          ifnotmoving
            ifcount 16
              ai AIDRONEPULLBACK
      }
      else
        ifcount 32
      {
        ifp phigher
          move DRONEBULLVELS geth getv
        else
          move DRONEBULLVELS geth
      }
    }
    else
      ifrnd 1
        operate
  }
ends

state dronedodgestate
  ifai AIDRONEDODGEUP
  {
     ifcount 8
       ai AIDRONEGETE
     else
       ifnotmoving
         ai AIDRONEGETE
  }
  else
  {
    ifcount 8
      ai AIDRONEGETE
    else
      ifnotmoving
        ai AIDRONEGETE
  }
ends

actor DRONE DRONESTRENGTH
  state checkdronenearplayer

  getactor[THISACTOR].htextra temp
  getactor[THISACTOR].htowner temptwo
  getactor[temptwo].yvel tempthree
  ifvarn temp -1 {
  	getplayervar[tempthree].damagedealt temptwo
  	addvarvar temptwo temp 
  	setplayervar[tempthree].damagedealt temptwo
  	getplayervar[tempthree].hits temptwo
  	addvar temptwo 1
  	setplayervar[tempthree].hits temptwo
  }


  ifrnd 2
    fall
  else
    soundonce DRON_JETSND

  ifaction 0
    ai AIDRONEGETE

  else
    ifai AIDRONEWAIT
  {
    ifactioncount 4
      ifrnd 16
        ifcansee
    {
      sound DRON_ATTACK1
      ifp phigher
        ai AIDRONEGETUP
      else ai AIDRONEGETE
    }
  }
  else
    ifai AIDRONEGETE
      state dronegetstate
  else
    ifai AIDRONEGETUP
      state dronegetstate
  else
    ifai AIDRONEPULLBACK
  {
    ifcount 32
    ai AIDRONEWAIT
  }
  else
    ifai AIDRONEHIT
  {
    ifcount 8
      ai AIDRONEWAIT
  }
  else
    ifai AIDRONESHRUNK
      state droneshrunkstate
  else
    ifai AIDRONEDODGE
      state dronedodgestate
  else
    ifai AIDRONEDODGEUP
      state dronedodgestate

  ifhitweapon
    state checkdronehitstate

  ifrnd 1
    soundonce DRON_ROAM

enda



action AOCTAWALK    0   3   5   1   15
action AOCTASTAND     0   1   5   1   15
action AOCTASCRATCH   0   4   5   1   15
action AOCTAHIT    30   1   1   1   10
action AOCTASHOOT    20   1   5   1   10
action AOCTADYING    30   8   1   1   17
action AOCTADEAD     38   1   1   1  1
action AOCTAFROZEN    0   1   5

move OCTAWALKVELS 96 -30
move OCTAUPVELS 96 -70
move OCTASTOPPED 0 -30
move OCTAINWATER 96 24

ai AIOCTAGETENEMY AOCTAWALK OCTAWALKVELS seekplayer
ai AIOCTASHOOTENEMY AOCTASHOOT OCTASTOPPED faceplayer
ai AIOCTASCRATCHENEMY AOCTASCRATCH OCTASTOPPED faceplayerslow
ai AIOCTAHIT AOCTAHIT OCTASTOPPED faceplayer
ai AIOCTASHRUNK AOCTAWALK SHRUNKVELS faceplayer
ai AIOCTAGROW AOCTASTAND OCTASTOPPED faceplayerslow
ai AIOCTADYING AOCTADYING OCTASTOPPED faceplayer

state octagetenemystate

  ifcansee
  {
    ifactioncount 32
    {
      ifrnd 48
        ifcanshoottarget
      {
        sound OCTA_ATTACK1
        ai AIOCTASHOOTENEMY
        break
      }
    }
    else
      ifpdistl 1280
        ai AIOCTASCRATCHENEMY
  }

ends

state octascratchenemystate
  ifpdistg 1280
    ai AIOCTAGETENEMY
  else
    ifcount 32
  {
    resetcount
    sound OCTA_ATTACK2
    palfrom 8 32
    addphealth OCTASCRATCHINGPLAYER
  }
ends

state octashootenemystate
  ifcount 25
  {
    ifcount 27
      ai AIOCTAGETENEMY
  }
  else
    ifcount 24
      shoot COOLEXPLOSION1
  else
    ifactioncount 6
      resetactioncount
ends

state checkoctahitstate
  ifwasweapon SHRINKSPARK
  {
    sound ACTOR_SHRINKING
    ai AIOCTASHRUNK
  }
  else
  {
    ifdead
    {
      ifwasweapon FREEZEBLAST
      {
        sound SOMETHINGFROZE
        spritepal 1
        move 0
        action AOCTAFROZEN
        strength 0
        break
      }

      addkills 1
      ifwasweapon RPG
      {
        sound SQUISHED
        state standard_jibs
        killit
      }
      else
        ifwasweapon RADIUSEXPLOSION
      {
        sound SQUISHED
        state standard_jibs
        killit
      }
      else
        ifwasweapon GROWSPARK
      {
        cstat 0
        sound ACTOR_GROWING
        ai AIOCTAGROW
        break
      }
      else
      {
        state rf
        ai AIOCTADYING
      }
      sound OCTA_DYING
    }
    else
    {
      ifwasweapon RPG
      {
        sound OCTA_DYING
        addkills 1
        state standard_jibs
        killit
      }
      else
        ifwasweapon GROWSPARK
          sound EXPANDERHIT

      sound OCTA_PAIN
      spawn BLOOD
      ifrnd 64
        ai AIOCTAHIT
    }
  }
  state random_wall_jibs
ends

state octashrunkstate
  ifcount SHRUNKDONECOUNT
    ai AILIZGETENEMY
  else
    ifcount SHRUNKCOUNT
      sizeto 40 40
  else
    state genericshrunkcode
ends


state octadyingstate
  ifactioncount 8
  {
    ifrnd 64
      spawn BLOODPOOL
    move OCTASTOPPED
    action AOCTADEAD
    break
  }
  else
    ifactioncount 5 nullop
  else
    ifactioncount 4
      iffloordistl 8
        sound THUD
ends

actor OCTABRAINSTAYPUT OCTASTRENGTH
  ai AIOCTAGETENEMY
  cactor OCTABRAIN
enda

actor OCTABRAIN OCTASTRENGTH
  fall
  state checksquished
  ifai 0
    ai AIOCTAGETENEMY
  else
    ifaction AOCTADEAD
  {
    strength 0
    ifcount RESPAWNACTORTIME
      ifrespawn
    {
      addkills -1
      spawn TRANSPORTERSTAR
      cstat 257
      strength OCTASTRENGTH
      ai AIOCTAGETENEMY
    }
    ifhitweapon
      ifwasweapon RADIUSEXPLOSION
    {
      state standard_jibs
      killit
    }
    break
  }
  else ifaction AOCTAFROZEN
  {
    ifcount THAWTIME
    {
      ai AIOCTAGETENEMY
      getlastpal
    }
    else
      ifcount FROZENDRIPTIME
      {
        ifactioncount 26
        {
          spawn WATERDRIP
          resetactioncount
        }
      }

    ifhitweapon
    {
      addkills 1
      ifwasweapon FREEZEBLAST
      {
        strength 0
        break
      }

      lotsofglass 30
      ifrnd 84
        spawn BLOODPOOL
      sound GLASS_BREAKING
      killit
    }
    ifp pfacing
      ifpdistl FROZENQUICKKICKDIST
        pkick
    break
  }
  else
  {
    ifrnd 1
      soundonce OCTA_ROAM

    ifai AIOCTAGETENEMY
      state octagetenemystate
    else
      ifai AIOCTAHIT
      {
        ifcount 8
          ai AIOCTASHOOTENEMY
      }
    else
      ifai AIOCTADYING
      {
        state octadyingstate
        break
      }
    else
      ifai AIOCTASCRATCHENEMY
        state octascratchenemystate
    else
      ifai AIOCTASHOOTENEMY
        state octashootenemystate
    else
      ifai AIOCTASHRUNK
      {
        state octashrunkstate
        break
      }
    else
      ifai AIOCTAGROW
        state genericgrowcode

    ifmove OCTAUPVELS nullop
    else
      ifp phigher
        move OCTAUPVELS seekplayer
    else
      ifmove OCTAINWATER nullop
      else
        ifinwater
          move OCTAINWATER seekplayer

    ifhitweapon
      state checkoctahitstate
  }
enda

action APIGWALK     0  4 5 1 20
action APIGRUN      0  4 5 1 11
action APIGSHOOT    30 2 5 1 58
action APIGCOCK     25 1 5 1 16
action APIGSTAND    30 1 5 1 1
action APIGDIVE     40 2 5 1 40
action APIGDIVESHOOT  45 2 5 1 58
action APIGDYING    55 5 1 1 15
action APIGHIT      55 1 1 1 10
action APIGDEAD     60 1 1 1 1
action APIGFROZEN    0 1 5
action APIGGROW      0


move PIGWALKVELS 72
move PIGRUNVELS 108
move PIGSTOPPED

ai AIPIGSEEKENEMY APIGWALK PIGWALKVELS seekplayer
ai AIPIGSHOOTENEMY APIGSHOOT PIGSTOPPED faceplayer
ai AIPIGFLEEENEMY APIGWALK PIGWALKVELS fleeenemy
ai AIPIGSHOOT APIGSHOOT PIGSTOPPED faceplayer
ai AIPIGDODGE APIGRUN PIGRUNVELS dodgebullet
ai AIPIGCHARGE APIGRUN PIGRUNVELS seekplayer
ai AIPIGDIVING APIGDIVE PIGSTOPPED faceplayer
ai AIPIGDYING APIGDYING PIGSTOPPED faceplayer
ai AIPIGSHRINK APIGWALK SHRUNKVELS fleeenemy
ai AIPIGGROW APIGGROW PIGSTOPPED faceplayerslow
ai AIPIGHIT APIGHIT PIGSTOPPED faceplayer

state pigseekenemystate

  ifai AIPIGCHARGE
  {
    ifcansee
      ifpdistl 3084
    {
      ifnotmoving
        ai AIPIGSEEKENEMY
      else
        ai AIPIGDIVING
    }
    break
  }
  else iffloordistl 32
  {
    ifpdistg 4096
    {
      ifactornotstayput
      ai AIPIGCHARGE
    }
    ifrnd 8
    {
      ifbulletnear
        ai AIPIGDODGE
    }
  }

  ifrnd 128
    ifcansee
  {
    ifai AIPIGDODGE
    {
      ifcount 32
        ai AIPIGCHARGE
          break
    }
    iffloordistl 32
    {
      ifpdistl 1024
        ifp palive
          ifcanshoottarget
      {
        ai AIPIGSHOOTENEMY
        break
      }
      ifcount 48
      {
        ifrnd 8
          ifp palive
            ifcanshoottarget
        {
          ifrnd 192
            ai AIPIGSHOOTENEMY
          else
            ai AIPIGDIVING
          break
        }
      }
    }
  }
ends


state pigshootenemystate
//  ifcansee
  {
    ifcount 12 nullop
    else
      ifcount 11
    {
      ifcanshoottarget
      {
        sound PIG_ATTACK
        shoot SHOTGUN
        shoot SHOTGUN
        shoot SHOTGUN
        shoot SHOTGUN
        shoot SHOTGUN
      }
      else
        ai AIPIGSEEKENEMY
    }
    ifcount 25 nullop
    else
      ifcount 24
      {
        action APIGCOCK
        sound SHOTGUN_COCK
      }
    ifcount 48 nullop
    else
      ifcount 47
    {
      ifcanshoottarget
      {
        sound PIG_ATTACK
        shoot SHOTGUN
        shoot SHOTGUN
        shoot SHOTGUN
        shoot SHOTGUN
        shoot SHOTGUN
      }
      else
        ai AIPIGSEEKENEMY
    }
    ifcount 60 nullop
    else
      ifcount 59
      {
        action APIGCOCK
        sound SHOTGUN_COCK
      }
    ifcount 72
    {
      ifrnd 64
        resetcount
      else
      {
        ifpdistl 768
          ai AIPIGFLEEENEMY
        else
          ai AIPIGSEEKENEMY
      }
    }
    ifaction APIGCOCK
      ifactioncount 2
        action APIGSHOOT
  }
  else
    ai AIPIGSEEKENEMY
ends

state pigfleeenemystate
  ifactioncount 8
    ai AIPIGSEEKENEMY
  else
    ifnotmoving
      ai AIPIGSEEKENEMY
ends

state pigdivestate
  ifaction APIGDIVESHOOT
  {
    ifcansee
    {
      ifcount 12 nullop
      else
        ifcount 11
      {
        ifcanshoottarget
        {
          sound PIG_ATTACK
          shoot SHOTGUN
          shoot SHOTGUN
          shoot SHOTGUN
          shoot SHOTGUN
        }
        else
          ai AIPIGSEEKENEMY
      }
      ifcount 25 nullop
      else
        ifcount 24
          sound SHOTGUN_COCK
      ifcount 48 nullop
      else
        ifcount 47
      {
        ifcanshoottarget
        {
          sound PIG_ATTACK
          shoot SHOTGUN
          shoot SHOTGUN
          shoot SHOTGUN
          shoot SHOTGUN
        }
        else
          ai AIPIGSEEKENEMY
      }
      ifcount 60 nullop
      else
        ifcount 59
      {
        sound SHOTGUN_COCK
        ifgapzl 32
          ai AIPIGDIVING
        else
        {
          ifpdistl 4096
            ai AIPIGFLEEENEMY
          else
            ai AIPIGSEEKENEMY
        }
      }
    }
    else
      ifgapzl 32
        ai AIPIGDIVING
      else
        ai AIPIGSEEKENEMY
  }
  else
    ifactioncount 2
    ifp palive
    {
      resetcount
      action APIGDIVESHOOT
    }
ends

state checkpighitstate
  spawn BLOOD
  ifdead
  {
    state random_wall_jibs
    ifrnd 16
      spawn SHIELD
    else
      state drop_shotgun

    ifwasweapon GROWSPARK
    {
      sound ACTOR_GROWING
      ai AIPIGGROW
      break
    }

    addkills 1

    ifwasweapon FREEZEBLAST
    {
      sound SOMETHINGFROZE
      spritepal 1
      move 0
      action APIGFROZEN
      strength 0
      break
    }
    ifwasweapon RADIUSEXPLOSION
    {
      sound SQUISHED
      state standard_jibs
      killit
    }
    else
      ifwasweapon RPG
    {
      sound SQUISHED
      state standard_jibs
      killit
    }
    else
      ai AIPIGDYING
        sound PIG_DYING
  }
  else
  {
    sound PIG_PAIN
    state random_wall_jibs

    ifwasweapon SHRINKSPARK
    {
      sound ACTOR_SHRINKING
      ai AIPIGSHRINK
    }
    else
      ifwasweapon GROWSPARK
        sound EXPANDERHIT
    else
      ifrnd 32
        ai AIPIGHIT
    else
      ifrnd 64
        ai AIPIGSHOOTENEMY
    else
      ifrnd 64
      {
        ai AIPIGDIVING
        action APIGDIVESHOOT
      }
  }
ends

state pigshrinkstate
  ifcount SHRUNKDONECOUNT
    ai AIPIGSEEKENEMY
  else
    ifcount SHRUNKCOUNT
      sizeto 48 40
  else
    state genericshrunkcode
ends

state pigdyingstate
  ifactioncount 5
  {
    ifrnd 64
      spawn BLOODPOOL
    state rf
    iffloordistl 8
      sound THUD
    action APIGDEAD
    move PIGSTOPPED
    break
  }
ends


actor PIGCOPDIVE PIGCOPSTRENGTH
  ai AIPIGDIVING
  action APIGDIVESHOOT
  cactor PIGCOP
enda
actor PIGCOPSTAYPUT PIGCOPSTRENGTH
  ai AIPIGSEEKENEMY
  cactor PIGCOP
enda
actor PIGCOP PIGCOPSTRENGTH APIGSTAND
  fall
  state checksquished
  ifaction APIGSTAND
    ai AIPIGSEEKENEMY
  else
    ifaction APIGDEAD
  {
    ifrespawn
      ifcount RESPAWNACTORTIME
    {
      spawn TRANSPORTERSTAR
      cstat 257
      strength PIGCOPSTRENGTH
      ai AIPIGSEEKENEMY
    }
    else
    {
      strength 0
      ifhitweapon
        ifwasweapon RADIUSEXPLOSION
      {
        sound SQUISHED
        state standard_jibs
        killit
      }
      break
    }
  }
  else
    ifaction APIGFROZEN
  {
    ifcount THAWTIME
    {
      ai AIPIGSEEKENEMY
      getlastpal
    }
    else
      ifcount FROZENDRIPTIME
        ifrnd 8
          spawn WATERDRIP

    ifhitweapon
    {
      ifwasweapon FREEZEBLAST
      {
        strength 0
        break
      }
      addkills 1

      lotsofglass 30
      ifrnd 84 spawn BLOODPOOL
      sound GLASS_BREAKING
      killit
    }
    ifp pfacing
      ifpdistl FROZENQUICKKICKDIST
        pkick
    break
  }
  else
    ifai AIPIGDYING
      state pigdyingstate
  else
    ifai AIPIGHIT
    {
      ifactioncount 3
      ai AIPIGSEEKENEMY
    }
  else
    ifai AIPIGSHRINK
      state pigshrinkstate
  else
  {
    ifai AIPIGSEEKENEMY
      state pigseekenemystate
    else
      ifai AIPIGDODGE
        state pigseekenemystate
    else
      ifai AIPIGSHOOTENEMY
        state pigshootenemystate
    else
      ifai AIPIGGROW
        state genericgrowcode
    else
      ifai AIPIGFLEEENEMY
        state pigfleeenemystate
    else
      ifai AIPIGDIVING
        state pigdivestate
    else
      ifai AIPIGCHARGE
        state pigseekenemystate
    ifhitweapon
      state checkpighitstate
    ifrnd 1
    {
      ifrnd 32
        soundonce PIG_ROAM
      else
        ifrnd 64
          soundonce PIG_ROAM2
      else
        soundonce PIG_ROAM3
    }
  }
enda



action ABOSS1WALK        0  4  5  1  12
action ABOSS1FROZEN        30 1  5
action ABOSS1RUN         0  6  5  1  5
action ABOSS1SHOOT         30 2  5  1  4
action ABOSS1LOB         40 2  5  1  35
action ABOSS1DYING        50 5  1  1  35
action BOSS1FLINTCH       50 1  1  1  1
action ABOSS1DEAD         55

move PALBOSS1SHRUNKRUNVELS 32
move PALBOSS1RUNVELS 128
move BOSS1WALKVELS 208
move BOSS1RUNVELS 296
move BOSS1STOPPED

ai AIBOSS1SEEKENEMY ABOSS1WALK BOSS1WALKVELS seekplayer
ai AIBOSS1RUNENEMY ABOSS1RUN BOSS1RUNVELS faceplayer
ai AIBOSS1SHOOTENEMY ABOSS1SHOOT BOSS1STOPPED faceplayer
ai AIBOSS1LOBBED ABOSS1LOB BOSS1STOPPED faceplayer // faceplayersmart
ai AIBOSS1DYING ABOSS1DYING BOSS1STOPPED faceplayer
ai AIBOSS1PALSHRINK ABOSS1WALK PALBOSS1SHRUNKRUNVELS furthestdir

state boss1palshrunkstate
  ifcount SHRUNKDONECOUNT
    ai AITROOPSEEKENEMY
  else
    ifcount SHRUNKCOUNT
      sizeto 40 40
  else
    state genericshrunkcode
ends

state checkboss1seekstate
  ai AIBOSS1SEEKENEMY
  ifspritepal 0 nullop
    else   // a fake way of doing a ifspritepal NOT.
      move PALBOSS1RUNVELS seekplayer
ends

state boss1runenemystate
  ifpdistl 2048
  {
    ifp palive
      ai AIBOSS1SHOOTENEMY
    break
  }
  else
    ifcansee
  {
    ifactioncount 6
    {
      ifcanshoottarget
      {
        resetactioncount
        sound BOS1_WALK
      }
      else
        ai AIBOSS1SEEKENEMY
    }
  }
  else
    ai AIBOSS1SEEKENEMY
ends

state boss1seekenemystate
  ifrnd 2
    soundonce BOS1_ROAM
  else
    ifactioncount 6
  {
    resetactioncount
    sound BOS1_WALK
  }

  ifpdistl 2548
    ifp palive
  {
    ai AIBOSS1SHOOTENEMY
    break
  }

  ifcansee
    ifcount 32
  {
    ifrnd 32
    {
      ifp palive
        ifcanshoottarget
          ai AIBOSS1SHOOTENEMY
    }
    else
      ifpdistg 2548
        ifrnd 192
          ifcanshoottarget
    {
      ifrnd 64
      {
        ai AIBOSS1RUNENEMY
        ifspritepal 0 nullop
        else
          move PALBOSS1RUNVELS seekplayer
      }
      else
        ai AIBOSS1LOBBED
    }
  }

ends

state boss1dyingstate
  ifaction ABOSS1DEAD
  {
    ifspritepal 0
      break
    ifrespawn
      ifcount RESPAWNACTORTIME
    {
      spawn TRANSPORTERSTAR
      cstat 257
      strength PIGCOPSTRENGTH
      state checkboss1seekstate
    }
    else
    {
      strength 0
      ifhitweapon
        ifwasweapon RADIUSEXPLOSION
      {
        sound SQUISHED
        state standard_jibs
        killit
      }
      break
    }
  }
  ifactioncount 5
  {
    iffloordistl 8
      sound THUD
    action ABOSS1DEAD
    cstat 0
    ifspritepal 0
    endofgame 52
  }
ends

state boss1lobbedstate
  ifcansee
  {
    ifactioncount 2
    {
      resetactioncount
      sound BOS1_ATTACK2
      shoot MORTER
    }
    else
      ifcount 64
        ifrnd 16
          state checkboss1seekstate
  }
  else
    state checkboss1seekstate
ends

state boss1shootenemy
  ifcount 72
    state checkboss1seekstate
  else
    ifaction ABOSS1SHOOT
      ifactioncount 2
  {
    sound BOS1_ATTACK1
    shoot SHOTSPARK1
    shoot SHOTSPARK1
    shoot SHOTSPARK1
    shoot SHOTSPARK1
    shoot SHOTSPARK1
    shoot SHOTSPARK1
    resetactioncount
  }
ends

state checkboss1hitstate
  ifrnd 2
    spawn BLOODPOOL
  ifdead
  {
    ifspritepal 0
      globalsound DUKE_TALKTOBOSSFALL
    else
    {
      ifrnd 64
        globalsound DUKE_TALKTOBOSSFALL
      ifwasweapon FREEZEBLAST
      {
        sound SOMETHINGFROZE
        spritepal 1
        move 0
        action ABOSS1FROZEN
        strength 0
        break
      }
    }

    sound BOS1_DYING

    addkills 1
    ai AIBOSS1DYING
  }
  else
  {
    ifrnd 32
    {
      action BOSS1FLINTCH
      move 0
    }

    ifspritepal 0 nullop
    else
      ifwasweapon SHRINKSPARK
    {
      sound ACTOR_SHRINKING
      ai AIBOSS1PALSHRINK
      cstat 0
      break
    }

    soundonce BOS1_PAIN

    debris SCRAP1 1
    guts JIBS6 1
  }
ends

state boss1code

  ifaction ABOSS1FROZEN
  {
    ifcount THAWTIME
    {
      ai AIBOSS1SEEKENEMY
      spritepal 21
    }
    else
      ifcount FROZENDRIPTIME
    {
      ifactioncount 26
      {
        spawn WATERDRIP
        resetactioncount
      }
    }

    ifhitweapon
    {
      ifwasweapon FREEZEBLAST
      {
        strength 0
        break
      }
      addkills 1
      lotsofglass 30

      ifrnd 84
        spawn BLOODPOOL
      sound GLASS_BREAKING
      killit
    }
    ifp pfacing
      ifpdistl FROZENQUICKKICKDIST
        pkick
    break
  }
  ifai 0
  {
    ifspritepal 0
      ai AIBOSS1RUNENEMY
    else
    {
      strength BOSS1PALSTRENGTH
      ai AIBOSS1SHOOTENEMY
    }
  }
  else
    ifaction BOSS1FLINTCH
  {
    ifactioncount 3
    ai AIBOSS1SHOOTENEMY
  }
  else
    ifai AIBOSS1SEEKENEMY
      state boss1seekenemystate
  else
    ifai AIBOSS1RUNENEMY
      state boss1runenemystate
  else
    ifai AIBOSS1SHOOTENEMY
      state boss1shootenemy
  else
    ifai AIBOSS1LOBBED
      state boss1lobbedstate
  else
    ifai AIBOSS1PALSHRINK
      state boss1palshrunkstate

  ifai AIBOSS1DYING
    state boss1dyingstate
  else
  {
    ifhitweapon
      state checkboss1hitstate
    else
      ifp palive
        ifspritepal 0
          ifpdistl 1280
    {
      addphealth -1000
      palfrom 63 63
    }
  }
ends

actor BOSS1STAYPUT BOSS1STRENGTH cactor BOSS1 enda
actor BOSS1 BOSS1STRENGTH fall state boss1code enda


action ABOSS2WALK        0  4  5  1  30
action ABOSS2FROZEN        0  1  5
action ABOSS2RUN         0  4  5  1  15
action ABOSS2SHOOT         20 2  5  1  15
action ABOSS2LOB         30 2  5  1  105
action ABOSS2DYING        40 8  1  1  35
action BOSS2FLINTCH       40 1  1  1  1
action ABOSS2DEAD         48

move PALBOSS2SHRUNKRUNVELS 32
move PALBOSS2RUNVELS 84
move BOSS2WALKVELS 192
move BOSS2RUNVELS 256
move BOSS2STOPPED

ai AIBOSS2SEEKENEMY ABOSS2WALK BOSS2WALKVELS seekplayer
ai AIBOSS2RUNENEMY ABOSS2RUN BOSS2RUNVELS faceplayer
ai AIBOSS2SHOOTENEMY ABOSS2SHOOT BOSS2STOPPED faceplayer
ai AIBOSS2LOBBED ABOSS2LOB BOSS2STOPPED faceplayer
ai AIBOSS2DYING ABOSS2DYING BOSS2STOPPED faceplayer
ai AIBOSS2PALSHRINK ABOSS2WALK PALBOSS2SHRUNKRUNVELS furthestdir

state boss2palshrunkstate
  ifcount SHRUNKDONECOUNT
  {
    cstat 257
    ai AITROOPSEEKENEMY
  }
  else
    ifcount SHRUNKCOUNT
      sizeto 40 40
  else
    state genericshrunkcode
ends

state checkboss2seekstate
  ai AIBOSS2SEEKENEMY
  ifspritepal 0 nullop
  else   // a fake way of doing a ifspritepal NOT.
    move PALBOSS2RUNVELS seekplayer
ends

state boss2runenemystate
  ifcansee
  {
    ifactioncount 3
    {
      ifcanshoottarget
      {
        resetactioncount
        sound BOS1_WALK
      }
      else
        ai AIBOSS2SEEKENEMY
    }
    ifcount 48
      ifrnd 2
    {
      ifp palive
      {
        sound BOS2_ATTACK
        ai AIBOSS2SHOOTENEMY
      }
      break
    }
  }
  else
    ai AIBOSS2SEEKENEMY
ends

state boss2seekenemystate
  ifrnd 2
    soundonce BOS2_ROAM
  else
    ifactioncount 3
  {
    resetactioncount
    sound BOS1_WALK
  }

  ifcansee
    ifcount 32
      ifp palive
        ifrnd 48
          ifcanshoottarget
  {
    ifrnd 64
      ifpdistg 4096
    {
      ai AIBOSS2RUNENEMY
      ifspritepal 0 nullop
      else
        move PALBOSS2RUNVELS seekplayer
      break
    }

    ifpdistl 10240
    {
      ifrnd 128
      {
        sound BOS2_ATTACK
        ai AIBOSS2LOBBED
      }
    }
    else
    {
      sound BOS2_ATTACK
      ai AIBOSS2SHOOTENEMY
    }
  }
ends

state boss2dyingstate
  ifaction ABOSS2DEAD
  {
    ifspritepal 0
      break
    ifrespawn
      ifcount RESPAWNACTORTIME
    {
      spawn TRANSPORTERSTAR
      cstat 257
      strength PIGCOPSTRENGTH
      state checkboss2seekstate
    }
    else
    {
      strength 0
      ifhitweapon
        ifwasweapon RADIUSEXPLOSION
      {
        sound SQUISHED
        state standard_jibs
        killit
      }
      break
    }
  }
  ifactioncount 8
  {
    iffloordistl 8
      sound THUD
    action ABOSS2DEAD
    cstat 0
    ifspritepal 0
      endofgame 52
  }
ends

state boss2lobbedstate
  ifcansee
  {
    ifactioncount 2
      resetactioncount
    else
      ifactioncount 1
    {
      ifrnd 128
        shoot COOLEXPLOSION1
    }
    else
      ifcount 64
        ifrnd 16
          state checkboss2seekstate
  }
  else
    state checkboss2seekstate
ends

state boss2shootenemy
  ifcount 72
    state checkboss2seekstate
  else
    ifaction ABOSS2SHOOT
      ifactioncount 2
  {
    shoot RPG
    resetactioncount
  }
ends

state checkboss2hitstate
  ifrnd 2
    spawn BLOODPOOL
  ifdead
  {
    ifspritepal 0
      globalsound DUKE_TALKTOBOSSFALL
    else
    {
      ifrnd 64
        globalsound DUKE_TALKTOBOSSFALL
      ifwasweapon FREEZEBLAST
      {
        sound SOMETHINGFROZE
        spritepal 1
        move 0
        action ABOSS2FROZEN
        strength 0
        break
      }
    }

    sound BOS2_DYING

    addkills 1

    ai AIBOSS2DYING
  }
  else
  {
    ifrnd 144
    {
      ifrnd 32
      {
        action BOSS2FLINTCH
        move 0
      }
      else
      {
        sound BOS2_ATTACK
        ai AIBOSS2SHOOTENEMY
      }
    }

    ifspritepal 0 nullop
    else
      ifwasweapon SHRINKSPARK
    {
      sound ACTOR_SHRINKING
      ai AIBOSS2PALSHRINK
      break
    }

    soundonce BOS2_PAIN

    debris SCRAP1 1
    guts JIBS6 1
  }
ends

state boss2code

  ifaction ABOSS2FROZEN
  {
    ifcount THAWTIME
    {
      ai AIBOSS2SEEKENEMY
        spritepal 21
    }
    else
      ifcount FROZENDRIPTIME
    {
      ifactioncount 26
      {
        spawn WATERDRIP
        resetactioncount
      }
    }

    ifhitweapon
    {
      ifwasweapon FREEZEBLAST
      {
        strength 0
        break
      }
      addkills 1

      lotsofglass 30
      sound GLASS_BREAKING
      ifrnd 84 spawn BLOODPOOL
      killit
    }
    ifp pfacing
      ifpdistl FROZENQUICKKICKDIST
        pkick
    break
  }
  ifai 0
  {
    ifspritepal 0
      ai AIBOSS2RUNENEMY
    else
    {
      strength 1
      sound BOS2_ATTACK ai AIBOSS2SHOOTENEMY
    }
  }
  else
    ifaction BOSS2FLINTCH
  {
    ifactioncount 3
      ai AIBOSS2SEEKENEMY
  }
  else
    ifai AIBOSS2SEEKENEMY
      state boss2seekenemystate
  else
    ifai AIBOSS2RUNENEMY
      state boss2runenemystate
  else
    ifai AIBOSS2SHOOTENEMY
      state boss2shootenemy
  else
    ifai AIBOSS2LOBBED
      state boss2lobbedstate
  else
    ifai AIBOSS2PALSHRINK
      state boss2palshrunkstate

  ifai AIBOSS2DYING
    state boss2dyingstate
  else
  {
    ifhitweapon state checkboss2hitstate
    else
      ifp palive
        ifspritepal 0 ifpdistl
          1280
    {
      addphealth -1000
      palfrom 63 63
    }
  }


ends

actor BOSS2 BOSS2STRENGTH fall state boss2code enda

action ABOSS3WALK        0  4  5  1  30
action ABOSS3FROZEN        0  1  5
action ABOSS3RUN         0  4  5  1  15
action ABOSS3LOB        20 4  5  1  50
action ABOSS3LOBBING      30 2  5  1  15
action ABOSS3DYING        40 8  1  1  20
action BOSS3FLINTCH       40 1  1  1  1
action ABOSS3DEAD         48

move PALBOSS3SHRUNKRUNVELS 32
move PALBOSS3RUNVELS 84
move BOSS3WALKVELS 208
move BOSS3RUNVELS 270
move BOSS3STOPPED

ai AIBOSS3SEEKENEMY ABOSS3WALK BOSS3WALKVELS seekplayer
ai AIBOSS3RUNENEMY ABOSS3RUN BOSS3RUNVELS faceplayerslow
ai AIBOSS3LOBENEMY ABOSS3LOB BOSS3STOPPED faceplayer
ai AIBOSS3DYING ABOSS3DYING BOSS3STOPPED faceplayer
ai AIBOSS3PALSHRINK ABOSS3WALK PALBOSS3SHRUNKRUNVELS faceplayer

state boss3palshrunkstate
  ifcount SHRUNKDONECOUNT
    ai AITROOPSEEKENEMY
  else
    ifcount SHRUNKCOUNT
      sizeto 40 40
  else
    state genericshrunkcode
ends

state checkboss3seekstate
  ai AIBOSS3SEEKENEMY
  ifspritepal 0 nullop
  else   // a fake way of doing a ifspritepal NOT.
    move PALBOSS3RUNVELS seekplayer
ends

state boss3runenemystate
  ifcansee
  {
    ifactioncount 3
    {
      ifcanshoottarget
      {
        resetactioncount
        sound BOS1_WALK
      }
      else
        ai AIBOSS3SEEKENEMY
    }
  }
  else
    ai AIBOSS3SEEKENEMY
ends

state boss3seekenemystate
  ifrnd 2
    soundonce BOS3_ROAM
  else
    ifactioncount 3
    {
      resetactioncount
      sound BOS1_WALK
    }

  ifcansee
    ifcount 32
      ifrnd 48
        ifcanshoottarget
  {
    ifrnd 64
      ifpdistg 4096
      {
        ai AIBOSS3RUNENEMY
        ifspritepal 0
          break
        move PALBOSS3RUNVELS seekplayer
        break
      }

    ifp palive
      ai AIBOSS3LOBENEMY
  }
ends

state boss3dyingstate
  ifaction ABOSS3DEAD
  {
    ifspritepal 0
      break
    ifrespawn
      ifcount RESPAWNACTORTIME
    {
      spawn TRANSPORTERSTAR
      cstat 257
      strength PIGCOPSTRENGTH
      state checkboss3seekstate
    }
    else
    {
      strength 0
      ifhitweapon
        ifwasweapon RADIUSEXPLOSION
      {
        sound SQUISHED
        state standard_jibs
        killit
      }
      break
    }
  }
  ifactioncount 8
  {
    iffloordistl 8
      sound THUD
    action ABOSS3DEAD
    cstat 0
    ifspritepal 0
    endofgame 52
  }
ends

state boss3lobbedstate
  ifcansee
  {
    ifaction ABOSS3LOBBING
      ifactioncount 2
    {
      shoot RPG
      resetactioncount
      ifrnd 8
        ai AIBOSS3SEEKENEMY
    }

    ifactioncount 3
    {
      action ABOSS3LOBBING
      resetcount
    }
  }
  else
    state checkboss3seekstate
ends

state checkboss3hitstate
  ifrnd 2
    spawn BLOODPOOL
  ifdead
  {
    ifspritepal 0
      globalsound DUKE_TALKTOBOSSFALL
    else
    {
      ifrnd 64
        globalsound DUKE_TALKTOBOSSFALL
      ifwasweapon FREEZEBLAST
      {
        sound SOMETHINGFROZE
        spritepal 1
        move 0
        action ABOSS3FROZEN
        strength 0
        break
      }
    }

    addkills 1
    ai AIBOSS3DYING

    sound BOS3_DYING
    sound JIBBED_ACTOR9

  }
  else
  {
    ifrnd 32
    {
      action BOSS3FLINTCH
      move 0
    }

    ifspritepal 0 nullop
    else
      ifwasweapon SHRINKSPARK
    {
      sound ACTOR_SHRINKING
      ai AIBOSS3PALSHRINK
      break
    }

    soundonce BOS3_PAIN

    debris SCRAP1 1
    guts JIBS6 1
  }
ends

state boss3code

  ifaction ABOSS3FROZEN
  {
    ifhitweapon
    {
      ifwasweapon FREEZEBLAST
      {
        strength 0
        break
      }

      addkills 1
      lotsofglass 30

      ifrnd 84
        spawn BLOODPOOL
      sound GLASS_BREAKING
      killit
    }
    ifp pfacing
      ifpdistl FROZENQUICKKICKDIST
        pkick
    break
  }
  ifai 0
  {
    ifspritepal 0
      ai AIBOSS3RUNENEMY
    else
    {
      strength 1
      ai AIBOSS3LOBENEMY
    }
  }
  else
    ifaction BOSS3FLINTCH
    {
      ifactioncount 3
      ai AIBOSS3SEEKENEMY
    }
  else
    ifai AIBOSS3SEEKENEMY
      state boss3seekenemystate
  else
    ifai AIBOSS3RUNENEMY
      state boss3runenemystate
  else
    ifai AIBOSS3LOBENEMY
      state boss3lobbedstate
  else
    ifai AIBOSS3PALSHRINK
      state boss3palshrunkstate

  ifai AIBOSS3DYING
    state boss3dyingstate
  else
  {
    ifhitweapon
      state checkboss3hitstate
    else
      ifp palive
        ifspritepal 0
          ifpdistl 1280
      {
        addphealth -1000
        palfrom 63 63
      }
  }
ends

actor BOSS3 BOSS3STRENGTH fall state boss3code enda


action ACOMMBREETH  0  3  5  1  40
action ACOMMFROZEN  0  1  5
action ACOMMSPIN   -5  1  5  1  12
action ACOMMGET   0  3  5  1  30
action ACOMMSHOOT  20  1  5   1 35
action ACOMMABOUTTOSHOOT 20 1 5 1 30
action ACOMMDYING  30  8  1  1  12
action ACOMMDEAD   38  1  1  1  1


move COMMGETUPVELS 128 -64
move COMMGETVELS 128 64
move COMMSLOW 64 24
move COMMSTOPPED

ai AICOMMWAIT ACOMMBREETH COMMSTOPPED faceplayerslow
ai AICOMMGET ACOMMGET COMMGETVELS seekplayer
ai AICOMMSHOOT ACOMMSHOOT COMMSTOPPED faceplayerslow
ai AICOMMABOUTTOSHOOT ACOMMABOUTTOSHOOT COMMSTOPPED faceplayerslow
ai AICOMMSPIN ACOMMSPIN COMMGETVELS spin
ai AICOMMDYING ACOMMDYING COMMSTOPPED faceplayer
ai AICOMMSHRUNK ACOMMGET COMMSLOW furthestdir
ai AICOMMGROW ACOMMGET COMMSTOPPED furthestdir

state checkcommhitstate

  ifhitweapon
  {
    guts JIBS6 2

    ifdead
    {
      ifwasweapon FREEZEBLAST
      {
        sound SOMETHINGFROZE
        spritepal 1
        move 0
        action ACOMMFROZEN
        strength 0
        break
      }
      else
        ifwasweapon GROWSPARK
      {
        sound ACTOR_GROWING
        ai AICOMMGROW
        break
      }

      addkills 1

      ifwasweapon RADIUSEXPLOSION
      {
        spawn BLOODPOOL
        sound SQUISHED
        state standard_jibs
        killit
      }
      else
        ifwasweapon RPG
      {
        sound SQUISHED
        spawn BLOODPOOL
        state standard_jibs
        killit
      }

      sound COMM_DYING
      ai AICOMMDYING
    }
    else
    {
      soundonce COMM_PAIN
      ifwasweapon SHRINKSPARK
      {
        sound ACTOR_SHRINKING
        ai AICOMMSHRUNK
      }
      else
        ifwasweapon GROWSPARK
          sound EXPANDERHIT
      else
        ifrnd 24
          ai AICOMMABOUTTOSHOOT
    }
  }
ends

actor COMMANDERSTAYPUT COMMANDERSTRENGTH
  cactor COMMANDER
  ai AICOMMABOUTTOSHOOT
enda

actor COMMANDER COMMANDERSTRENGTH

  state checksquished

  ifaction ACOMMFROZEN
  {
    fall

    ifcount THAWTIME
    {
      getlastpal
      ai AICOMMWAIT
    }
    else
      ifcount FROZENDRIPTIME
    {
      ifactioncount 26
      {
        spawn WATERDRIP
        resetactioncount
      }
    }

    ifhitweapon
    {
      ifwasweapon FREEZEBLAST
      {
        strength 0
        break
      }
      addkills 1

      ifrnd 84
        spawn BLOODPOOL
      lotsofglass 30
      sound GLASS_BREAKING
      killit
    }
    ifp pfacing
      ifpdistl FROZENQUICKKICKDIST
        pkick
    break
  }
  ifai 0
    ai AICOMMSHOOT
  else
    ifai AICOMMWAIT
  {
    ifcount 20
    {
      ifcansee
      {
        ifcanshoottarget
        {
          ifrnd 96
            ai AICOMMGET
          else
            ai AICOMMABOUTTOSHOOT
        }
      }
      else
        ai AICOMMGET
    }
  }
  else
    ifai AICOMMABOUTTOSHOOT
  {
    ifactioncount 2
    {
      ifcansee
        ai AICOMMSHOOT
      else
      {
        ai AICOMMGET
        break
      }
    }
    ifrnd 32 soundonce COMM_ATTACK
  }
  else
    ifai AICOMMSHOOT
  {
    ifcanshoottarget
    {
      ifcount 24
        ifrnd 16
          ai AICOMMWAIT
      ifactioncount 2
      {
        shoot RPG
        resetactioncount
      }
    }
    else
      ai AICOMMGET
  }
  else
    ifai AICOMMSHRUNK
  {
    ifcount SHRUNKDONECOUNT
      ai AICOMMGET
    else
      ifcount SHRUNKCOUNT
        sizeto 48 40
    else
      state genericshrunkcode
  }
  else
    ifai AICOMMGROW
      state genericgrowcode
  else
    ifai AICOMMGET
  {
    ifnotmoving
      ifrnd 4
        operate
    ifpdistl 1024
      ifp palive
    {
      sound COMM_SPIN
      ai AICOMMSPIN
      break
    }

    ifcansee
    {
      ifp phigher
        move COMMGETUPVELS getv geth faceplayer
      else
        move COMMGETVELS getv geth faceplayer
    }
    ifactioncount 8
      ifrnd 2
        ai AICOMMABOUTTOSHOOT
  }
  else
    ifai AICOMMSPIN
  {
    soundonce COMM_SPIN
    ifcount 16
    {
      ifpdistl 1280
      {
        addphealth CAPTSPINNINGPLAYER
        sound DUKE_GRUNT
        palfrom 32
        16 resetcount
      }
      else
        ifpdistg 2300
          ai AICOMMWAIT
    }
    ifactioncount 52
      ai AICOMMWAIT
    ifnotmoving
      ifrnd 32
        operate
  }

  ifai AICOMMDYING
  {
    fall
    strength 0

    ifhitweapon
      ifwasweapon RADIUSEXPLOSION
    {
      sound SQUISHED
      spawn BLOODPOOL
      state standard_jibs
      killit
    }

    ifaction ACOMMDYING
      ifactioncount 8
    {
      iffloordistl 8
        sound THUD
      cstat 0
      action ACOMMDEAD
    }
  }
  else
  {
    ifrnd 2
      soundonce COMM_ROAM
    state checkcommhitstate
  }
enda


// CANNONBALL for Pirates of the Carribean
define CANNONBALLSTRENGTH 400
move CANNONBALL1 512 0
move CANNONBALL2 512 10
move CANNONBALL3 512 20
move CANNONBALL4 512 40
move CANNONBALL5 512 80

useractor notenemy CANNONBALL CANNONBALLSTRENGTH

  ifaction 0
  {
    sizeat 32 32
    cstat 257         // Force actor to block
    action ANULLACTION
  }

    ifactioncount 46
    {
      ifactioncount 47 nullop
      else
        move CANNONBALL5 geth getv
    }
    else
      ifactioncount 44
    {
      ifactioncount 45 nullop
      else
        move CANNONBALL4 geth getv
    }
    else
      ifactioncount 40
    {
      ifactioncount 41 nullop
      else
        move CANNONBALL3 geth getv
    }
    else
      ifactioncount 32
    {
      ifactioncount 33 nullop
      else
        move CANNONBALL2 geth getv
    }
    else
      ifactioncount 16
    {
      ifactioncount 17 nullop
      else move CANNONBALL1 geth getv
    }

  ifnotmoving
  {
    spawn EXPLOSION2
    sound PIPEBOMB_EXPLODE
    hitradius 4096 WEAKEST WEAK MEDIUMSTRENGTH TOUGH
    killit
  }

  ifhitweapon
  {
    ifdead
    {
      spawn EXPLOSION2
      hitradius 4096 WEAKEST WEAK MEDIUMSTRENGTH TOUGH
      killit
    }
    else
      debris SCRAP1 3
  }

enda


define CANNONBALLS 1818
define CANNONBALLSSTRENGTH 10
move CANNONBALLSVEL

useractor notenemy CANNONBALLS CANNONBALLSSTRENGTH
  ifaction 0
  {
    cstator 257
    action ANULLACTION
  }
  ifhitweapon
  {
    ifdead
    {
      spawn EXPLOSION2
      hitradius 4096 WEAKEST WEAK MEDIUMSTRENGTH TOUGH
      killit
    }
    else
      debris SCRAP1 3
  }
enda


define CANNON 1810
define CANNONSTRENGTH 400
action ACANNONWAIT 0 1 7 1 1
action ACANNONSHOOTING 0 1 7 1 1
move CANNONSTOP

useractor enemy CANNON CANNONSTRENGTH // fall

  ifaction 0
  {
//    sizeat 64 64
    action ACANNONWAIT
  }
  else
    ifaction ACANNONSHOOTING
  {
    spawn CANNONBALL
    action ACANNONWAIT
  }
  else
    ifaction ACANNONWAIT
  {
    ifactioncount 64
    {
      ifrnd 128
        action ACANNONSHOOTING
      else
        resetactioncount
    }
  }

  ifhitweapon
  {
    ifdead
    {
      addkills 1
      hitradius 4096 WEAKEST WEAK MEDIUMSTRENGTH TOUGH
      spawn EXPLOSION2
      killit
    }
    else debris SCRAP1 3
  }

  ifpdistl 1024
    ifhitspace
  {
    ifp pfacing
      ifcanshoottarget
        spawn CANNONBALL
      else break
  }
enda

useractor notenemy HOTMEAT TOUGH
  ifaction 0
  {
    action ANULLACTION
    cstat 257
  }
  ifhitweapon
  {
    ifdead
    {
      sound SQUISHED
      guts JIBS5 8
      guts JIBS6 9
      killit
    }
    else
      guts JIBS6 1
  }
  ifrnd 1
    spawn WATERDRIP

enda

action ASPEAKERBROKE 1
useractor notenemy SPEAKER
  ifaction 0
  {
    ifhitweapon
    {
      stopsound STORE_MUSIC
      soundonce STORE_MUSIC_BROKE
      action ASPEAKERBROKE
    }
    else
    {
      ifpdistl 10240
          soundonce STORE_MUSIC
      cstat 289
    }
  }
enda

action ALAVABUBBLE
action ALAVABUBBLEANIM 0 5 1 1 16

useractor notenemy LAVABUBBLE
  ifaction 0
  {
    cstat 32768
    action ALAVABUBBLE
  }
  else
    ifaction ALAVABUBBLE
  {
    ifcount 72
      ifrnd 2
    {
      cstat 0
      action ALAVABUBBLEANIM
    }
  }
  else
  {
    ifactioncount 5
    {
      cstat 32768
      action ALAVABUBBLE
    }
  }
enda

// RIOT TANK with Pigcop inside

define TANKSTRENGTH       500      // 2 3 4 5 7 8
//           off-set, numofframes, numofrot, skipframes, delay
action ATANKSPIN   0 1 7 1 4
action ATANKSHOOTING 7 2 7 1 10
action ATANKWAIT 0 1 7 1 1
action ATANKDESTRUCT 0 1 7 1 1
action ATANKDEAD 0 1 7 1 1
// move TANKVEL horiz vert
move TANKFORWARD 100
move TANKSTOP

useractor enemy TANK TANKSTRENGTH fall

  ifaction 0
  {
    sizeat 60 60
    action ATANKWAIT
    cstat 257
    clipdist 100
  }
  else
    ifaction ATANKSPIN
  {
    soundonce TANK_ROAM

    ifactioncount 20
    {
      ifrnd 16
        ifcansee
          ifcanshoottarget
      {
        move TANKSTOP geth
        action ATANKSHOOTING
        stopsound TANK_ROAM
      }
    }

    ifrnd 16
      move TANKFORWARD seekplayer
  }
  else
    ifaction ATANKSHOOTING
  {
    ifactioncount 22
    {
      ifpdistg 8192
      {
        sound BOS1_ATTACK2
        shoot MORTER
      }
      resetcount
      move 0 action ATANKWAIT
    }
    else
      ifactioncount 2
    {
      ifcansee
      {
        ifpdistl 16384
        {
          ifrnd 128
          {
            sound PISTOL_FIRE
            shoot SHOTSPARK1
          }
        }
        else
          ifrnd 128
        {
          sound PRED_ATTACK
          shoot FIRELASER
        }
      }
      else
      {
        move TANKFORWARD seekplayer
        action ATANKSPIN
      }
    }

    ifrnd 16
    {
      stopsound TANK_ROAM
      move TANKSTOP faceplayerslow
    }
  }
  else
    ifaction ATANKWAIT
  {
    ifactioncount 32
    {
      move TANKFORWARD seekplayer
      action ATANKSPIN
    }
  }
  else
    ifaction ATANKDESTRUCT
  {
    ifactioncount 64
      action ATANKDEAD
    else
      ifactioncount 56
       sound LASERTRIP_ARMING
     else
       ifactioncount 48
         sound LASERTRIP_ARMING
     else
       ifactioncount 32
         sound LASERTRIP_ARMING
     else
       ifactioncount 16
         sound LASERTRIP_ARMING
     break
  }
  else
    ifaction ATANKDEAD
  {
    addkills 1
    hitradius 6144 TOUGH TOUGH TOUGH TOUGH
    sound LASERTRIP_EXPLODE
    debris SCRAP1 15
    spawn EXPLOSION2
    ifrnd 128 spawn PIGCOP
    killit
  }

  ifhitweapon
  {
    ifdead
      action ATANKDEAD
    else
    {
      debris SCRAP1 1
      ifaction ATANKSHOOTING break

      ifrnd 192
      {
        move TANKSTOP geth
        action ATANKSHOOTING
        stopsound TANK_ROAM
      }
    }
  }

  ifpdistl 1280
    ifhitspace
      ifp pfacing
        ifangdiffl 512
          action ATANKDESTRUCT
enda







action ABOSS4WALK          0 4  5  1  30
action ABOSS4DYING        40 9  1  1  20
action ABOSS4ABOUTTOSHOOT 20 1  5  1  40
action ABOSS4SHOOT        25 2  5  1  10
action ABOSS4LAYIT        50 3  5  1  120
action BOSS4FLINTCH       40 1  1  1  1
action ABOSS4DEAD         49

move BOSS4WALKVELS 128
move BOSS4STOPPED

ai AIBOSS4LAYEGGS ABOSS4WALK BOSS4WALKVELS randomangle geth
ai AIBOSS4SHOOT ABOSS4ABOUTTOSHOOT BOSS4STOPPED faceplayer
ai AIBOSS4DYING ABOSS4DYING BOSS4STOPPED faceplayer

state boss4shootstate
  ifaction ABOSS4ABOUTTOSHOOT
    ifactioncount 3
      action ABOSS4SHOOT

  ifaction ABOSS4SHOOT
  {
    ifcount 48
    {
      ifrnd 4
        ai AIBOSS4LAYEGGS
    }
    ifcount 26
      ifrnd 32
    {
      ifrnd 128
      {
        sound SHORT_CIRCUIT
        addphealth -2
      }
      else
      {
        sound DUKE_GRUNT
        addphealth -1
      }
      palfrom 32 32 0 0
    }
  }

ends

state boss4layeggs
  ifrnd 2
    sound BOS4_ROAM

  ifaction ABOSS4LAYIT
  {
    ifactioncount 3
      ifcount 32
    {
      ai AIBOSS4LAYEGGS
      ifrnd 32
        move BOSS4WALKVELS furthestdir geth
      spawn NEWBEASTHANG
    }
  }
  else
    ifcount 64
      ifrnd 4
  {
    move 0

    ifrnd 88
    {
      action ABOSS4LAYIT
      sound BOS4_LAY
    }
    else
      ifp palive
        ifcansee
    {
      ai AIBOSS4SHOOT
      sound BOS4_ATTACK
    }
  }

ends

state boss4dyingstate
  ifaction ABOSS4DEAD
    break
  else
    ifactioncount 9
  {
    iffloordistl 8
      sound THUD

    endofgame 52
    action ABOSS4DEAD
    cstat 0
  }
ends

state checkboss4hitstate
  ifrnd 2
    spawn BLOODPOOL

  ifdead
  {
    globalsound DUKE_TALKTOBOSSFALL

    addkills 1
    ai AIBOSS4DYING

    sound BOS4_DYING
    sound BOSS4_DEADSPEECH
  }
  else
  {
    soundonce BOS4_PAIN
    debris SCRAP1 1
    guts JIBS6 1

    ifaction ABOSS4LAYIT
      break

    ifrnd 16
    {
      action BOSS4FLINTCH
      move 0
    }
  }
ends

state boss4code

  ifai 0
    ai AIBOSS4LAYEGGS
  else
    ifaction BOSS4FLINTCH
    {
      ifactioncount 3
        ai AIBOSS4LAYEGGS
    }
  else
    ifai AIBOSS4LAYEGGS
      state boss4layeggs
  else
    ifai AIBOSS4SHOOT
      state boss4shootstate

  ifai AIBOSS4DYING
    state boss4dyingstate
  else
  {
    ifhitweapon
      state checkboss4hitstate
    else
      ifp palive
        ifpdistl 1280
      {
        addphealth -1000
        palfrom 63 63
      }
  }
ends

actor BOSS4STAYPUT BOSS4STRENGTH

  fall
  cactor BOSS4
  spritepal 6
  state boss4code
  getlastpal

enda

actor BOSS4 BOSS4STRENGTH

  fall
  cactor BOSS4
  spritepal 6
  state boss4code
  getlastpal

enda

action ANEWBEASTSTAND     0
action ANEWBEASTWALKING   10  4  5  1  12
action ANEWBEASTRUNNING   10  4  5  1  8
action ANEWBEASTTHINK     0   2  5  1  40
action ANEWBEASTSCRATCHING  30  3  5  1  20
action ANEWBEASTDYING     72  8  1  1  15
action ANEWBEASTFLINTCH   71  1  1  1  1
action ANEWBEASTLYINGDEAD 79  1  1
action ANEWBEASTSCREAM    50  2  5  1  40
action ANEWBEASTJUMP      80  2  5  1  50
action ANEWBEASTFALL      90  1  5
action ANEWBEASTFROZEN    10  1  5

action ANEWBEASTHANG      0  1  5
useractor enemy NEWBEASTHANG NEWBEASTSTRENGTH
  ifaction 0
  {
    action ANEWBEASTHANG
    cstator 257

    sizeat 40 40
  }
  else
    ifhitweapon
  {
    cactor NEWBEAST
    action ANEWBEASTSTAND
    sound NEWBEAST_PAIN
  }
  else
    ifspawnedby BOSS4
      ifcount 200
        ifrnd 1
  {
    cactor NEWBEAST
    action ANEWBEASTSTAND
    sound NEWBEAST_PAIN
  }
enda

action ANEWBEASTHANGDEAD      -1  1  5
useractor enemy NEWBEASTHANGDEAD TOUGH

  ifaction 0
  {
    action ANEWBEASTHANGDEAD
    sizeat 40 40
    cstator 257
  }
  else
    ifhitweapon
  {
    ifdead
    {
      state standard_jibs
      //spawn BLOODPOOL
      sound SQUISHED
      killit
    }
    else
    {
      guts JIBS6 1
      sound SQUISHED
    }
  }
enda

move NEWBEASTWALKVEL 140 //160
move NEWBEASTRUNVEL 200 //230
move NEWBEASTJUMPVEL 210 //235
move NEWBEASTSTOP

ai AINEWBEASTGETENEMY ANEWBEASTWALKING NEWBEASTWALKVEL seekplayer
ai AINEWBEASTDODGE ANEWBEASTRUNNING NEWBEASTRUNVEL dodgebullet
ai AINEWBEASTCHARGEENEMY ANEWBEASTRUNNING NEWBEASTRUNVEL seekplayer
ai AINEWBEASTFLEENEMY ANEWBEASTWALKING NEWBEASTWALKVEL fleeenemy
ai AINEWBEASTSCRATCHENEMY ANEWBEASTSCRATCHING NEWBEASTSTOP faceplayerslow
ai AINEWBEASTJUMPENEMY ANEWBEASTJUMP NEWBEASTJUMPVEL jumptoplayer
ai AINEWBEASTTHINK ANEWBEASTTHINK NEWBEASTSTOP
// ai AINEWBEASTSHRUNK ANEWBEASTWALKING SHRUNKVELS fleeenemy
ai AINEWBEASTGROW ANEWBEASTSTAND  NEWBEASTSTOP faceplayerslow
ai AINEWBEASTDYING ANEWBEASTDYING NEWBEASTSTOP faceplayer
ai AINEWBEASTSHOOT ANEWBEASTSCREAM NEWBEASTSTOP faceplayerslow
ai AINEWBEASTFLINTCH ANEWBEASTFLINTCH NEWBEASTSTOP faceplayerslow


state newbeastseekstate

  ifactornotstayput
  {
    ifp palive
      ifcansee
        ifpdistl 1596
    {
      ai AINEWBEASTSCRATCHENEMY
      break
    }

    ifai AINEWBEASTCHARGEENEMY
    {
      ifp palive
        ifpdistl 1596
          ifcansee
      {
        ai AINEWBEASTSCRATCHENEMY
        break
      }

      ifrnd 1
        ifpdistg 4096
          ifp palive
            ifcansee
      {
        ai AINEWBEASTSHOOT
        break
      }
    }
    else
      ifpdistg 4096
    {
      ai AINEWBEASTCHARGEENEMY
      break
    }

    iffloordistl 16
    {
      ifcount 32
        ifrnd 16
      {
        ifceilingdistl 96 break
        ai AINEWBEASTJUMPENEMY
      }
      break
    }

    ifrnd 4
    {
      ifnotmoving
        operate
    }
    else
      ifrnd 16
        ifbulletnear
    {
      ifgapzl 128
        ai AINEWBEASTDODGE
      else
        ifactornotstayput
      {
        ifrnd 128
        {
          ifceilingdistl 96 break
          ai AINEWBEASTJUMPENEMY
        }
        else
          ai AINEWBEASTDODGE
      }
    }
  }
  else
  {
    ifactioncount 16
    {
      ifp palive
        ifpdistl 1596
          ifcansee
      {
        ai AINEWBEASTSCRATCHENEMY
        break
      }
    }
    ifcount 16
      ifrnd 32
        move NEWBEASTWALKVEL randomangle geth
  }

ends

/*
state newbeastshrunkstate
  ifcount SHRUNKDONECOUNT
    ai AINEWBEASTGETENEMY
  else
    ifcount SHRUNKCOUNT
      sizeto 48 40
  else
    state genericshrunkcode
ends
*/

state newbeastfleestate
  ifcount 8
  {
    ifrnd 64
      ifpdistg 3500
        ifp palive
          ifcansee
            ai AINEWBEASTSHOOT
  }
  else
  {
    iffloordistl 16
    {
      ifnotmoving
        ai AINEWBEASTGETENEMY
    }
    else
      ai AINEWBEASTGETENEMY
    break
  }
ends

state newbeastthinkstate

  ifrnd 8
    soundonce NEWBEAST_ROAM

  ifactioncount 3
  {
    ifrnd 128
    {
      ifpdistg 3500
        ifp palive
          ifcansee
            ai AINEWBEASTSHOOT
    }
    else
      ai AINEWBEASTGETENEMY
  }

  ifrnd 16
    ifbulletnear
  {
    ifgapzl 96
      ai AINEWBEASTDODGE
    else
    {
      ifrnd 128
      {
        ifceilingdistl 144 break
        ai AINEWBEASTJUMPENEMY
      }
      else
        ai AINEWBEASTDODGE
    }
  }
ends

state newbeastscratchstate
  ifcount 20
    ifrnd 8
  {
    ifcansee
      ifpdistl 2048
    {
      ifrnd 128
        ai AINEWBEASTFLEENEMY
      break
    }
    ifrnd 80
      ai AINEWBEASTTHINK
    else
      ai AINEWBEASTGETENEMY
  }

  ifactioncount 3
  {
    ifpdistg 1596 nullop
      //ai AINEWBEASTTHINK
    else ifp palive ifcansee
    {
      setvarvar hpregencounter hpregencountervar
      palfrom 16 16
      addphealth NEWBEASTSCRATCHAMOUNT
      sound DUKE_GRUNT
      resetactioncount
      resetcount
    }
  }
  else
    ifcount 15
      nullop
  else
    ifcount 14
  {
    ifpdistl 1596
      soundonce NEWBEAST_ATTACK
    else
      soundonce NEWBEAST_ATTACKMISS
  }
ends

state checknewbeasthit
	ifwasweapon KNEE subvar hits 1
  //spawn BLOOD
/*
  ifai AINEWBEASTSHRUNK
  {
    addkills 1
    sound SQUISHED
    state standard_jibs
    killit
  }
*/
  ifdead //monsterdrops
  {
    state giveexperince
    state dostuffonkill
    state newbeastdrops
    ifwasweapon FREEZEBLAST
    {
      sound SOMETHINGFROZE
      spritepal 1
      move 0
      action ANEWBEASTFROZEN
      strength 0
      break
    }

    ifwasweapon GROWSPARK
    {
      cstat 0
      sound ACTOR_GROWING
      ai AINEWBEASTGROW
      break
    }
    addkills 1

    ifwasweapon RPG
    {
      sound SQUISHED
      state liz_body_jibs
      state standard_jibs
      killit
    }
    else
      ifwasweapon RADIUSEXPLOSION
    {
      sound SQUISHED
      state liz_body_jibs
      state standard_jibs
      killit
    }
    else
    {
      state rf
      ai AINEWBEASTDYING
      //ifrnd 64
        //spawn BLOODPOOL
    }
    sound NEWBEAST_DYING
  }
  else
  {
    
    ifrnd 24 sound NEWBEAST_PAIN
    ifwasweapon GROWSPARK
      sound EXPANDERHIT

//  The alien is immune to the shrinker
    
    ifwasweapon SHRINKSPARK
    {
      break
    }
    

    state random_wall_jibs
    ifrnd 32
      ai AINEWBEASTFLINTCH
    else
      ifrnd 32
        ifpdistg 3500
          ifp palive
            ifcansee
              ai AINEWBEASTSHOOT
    //powershot code
    getactor[THISACTOR].extra temp
		ifvarg temp 0 {
			getactor[THISACTOR].htowner temp
	    getactor[temp].yvel temptwo
	    getplayervar[temptwo].powershotcd tempthree
	    getplayervar[temptwo].instakillduration tempfour
			ifvare tempthree 150 {
				sound SQUISHED
				state standard_jibs
				spawn EXPLOSION2
				sound 9
				setplayervar[temptwo].powershotcd 0
				getplayervar[temptwo].powershotkills tempfive
				addvar tempfive 1
				setplayervar[temptwo].powershotkills tempfive 
				setvarvar tempsix tempfive
				mulvar tempsix 1 //Powershot multiplier
				getplayervar[temptwo].playermoneybonus tempfour
				addvarvar tempfour tempsix
				setplayervar[temptwo].playermoneybonus tempfour //Money
				getplayervar[temptwo].powershotmoney tempfour
				addvarvar tempfour tempsix
				setplayervar[temptwo].powershotmoney tempfour
				setplayervar[temptwo].bonusmoneycounter 60
				state giveexperince
				state dostuffonkill
				state newbeastdrops
				killit
			} else ifvarg tempfour 0 { //Instakill on newbeast
				spawn TRANSPORTERSTAR
				sound SQUISHED
				state standard_jibs
				state giveexperince
				state dostuffonkill
				state newbeastdrops
				killit
			}
		}
  }
ends

state newbeastjumpstate
  ifaction ANEWBEASTFALL
  {
    iffloordistl 16
      ai AINEWBEASTGETENEMY
  }
  else
    ifcount 32
      action ANEWBEASTFALL
ends

state newbeastdyingstate
  ifaction ANEWBEASTLYINGDEAD
  {
    strength 0
    ifhitweapon
      ifwasweapon RADIUSEXPLOSION
    {
      sound SQUISHED
      state standard_jibs
      killit
    }
    ifcount RESPAWNACTORTIME
      ifrespawn
    {
      spawn TRANSPORTERSTAR
      cstat 257
      strength NEWBEASTSTRENGTH
      ai AINEWBEASTGETENEMY
    }
  }
  else
    ifai AINEWBEASTDYING
      ifactioncount 7
  {
    iffloordistl 8
      sound THUD
    move NEWBEASTSTOP
    action ANEWBEASTLYINGDEAD
  }
ends

state newbeastdodgestate
  ifcount 13
    ai AINEWBEASTGETENEMY
ends

useractor enemystayput NEWBEASTSTAYPUT NEWBEASTSTRENGTH ai AINEWBEASTGETENEMY cstator 257 cactor NEWBEAST enda
useractor enemy NEWBEASTJUMP NEWBEASTSTRENGTH ai AINEWBEASTJUMPENEMY cstator 257 cactor NEWBEAST enda

state newbeastcode
  state checksquished
  ifai 0
  {
    cstator 257
    ai AINEWBEASTGETENEMY
  }
  else
    ifaction ANEWBEASTLYINGDEAD
  {
    fall
    state newbeastdyingstate
    break
  }
  else
    ifaction ANEWBEASTFROZEN
  {
    ifcount THAWTIME
    {
      ai AINEWBEASTGETENEMY
      spritepal 0
    }
    else
      ifcount FROZENDRIPTIME
    {
      ifactioncount 26
      {
        //spawn WATERDRIP
        resetactioncount
      }
    }

    ifhitweapon
    {
      ifwasweapon FREEZEBLAST
      {
        strength 0
        break
      }
      addkills 1

      //ifrnd 84
        //spawn BLOODPOOL
      lotsofglass 30
      sound GLASS_BREAKING
      killit
    }
    ifp pfacing
      ifpdistl FROZENQUICKKICKDIST
        pkick
    break
  }
  else
    ifai AINEWBEASTJUMPENEMY
      state newbeastjumpstate
  else
  {
    fall
    ifai AINEWBEASTGETENEMY
      state newbeastseekstate
    else
      ifai AINEWBEASTCHARGEENEMY
        state newbeastseekstate
    else
      ifai AINEWBEASTFLINTCH
    {
      ifcount 8
        ai AINEWBEASTGETENEMY
    }

    else
      ifai AINEWBEASTDODGE
        state newbeastdodgestate
    else
      ifai AINEWBEASTSCRATCHENEMY
        state newbeastscratchstate
    else
      ifai AINEWBEASTFLEENEMY
        state newbeastfleestate
    else
      ifai AINEWBEASTTHINK
        state newbeastthinkstate
/*
    else
      ifai AINEWBEASTSHRUNK
        state newbeastshrunkstate
*/
    else
      ifai AINEWBEASTGROW
        state genericgrowcode
    else
      ifai AINEWBEASTDYING
        state newbeastdyingstate
    else
      ifai AINEWBEASTSHOOT
    {
      ifp pshrunk
        ai AINEWBEASTGETENEMY
      else
        ifcount 26
          ai AINEWBEASTGETENEMY
      else
        ifcount 25
          shoot SHRINKER
      /*else
      {
        ifcount 5
          nullop
        else
          ifcount 4
            sound NEWBEAST_SPIT
      }*/
    }
  }

  ifhitweapon
    state checknewbeasthit
ends


useractor enemy NEWBEAST NEWBEASTSTRENGTH
  fall

  addvar teleporttimer 1
  ifvarvarg teleporttimer teleporttimervar {
  	setvar teleporttimer 0
  	setvarvar temp MY_X
  	setvarvar temptwo MY_Y
  	randvar tempthree 8192
  	randvar tempfour 8192
  	subvar tempthree 4096
  	subvar tempfour 4096
  	addvarvar temp tempthree
  	addvarvar temptwo tempfour
  	updatesector temp temptwo tempfive
		setactor[THISACTOR].x temp
		setactor[THISACTOR].y temptwo
		setactor[THISACTOR].z MY_Z
		spawn TRANSPORTERSTAR
		sound 82
  }

  getactor[THISACTOR].extra temp
  ifvarg temp 0 {
  	getactor[THISACTOR].htextra temp
		getactor[THISACTOR].htowner temptwo
		getactor[temptwo].yvel tempthree
		ifvarn temp -1 {
			//Normal money
			getplayervar[tempthree].playermoney temptwo
			addvarvar temptwo temp
			setplayervar[tempthree].playermoney temptwo
			setplayervar[tempthree].moneycounter 60
			//Money fest
			getplayervar[tempthree].moneyfestduration temptwo
			ifvarg temptwo 0 {
				setvarvar tempfour temp //Get dmg dealt
				mulvar tempfour 2 //Double it and add (total money is 3x) 
				getplayervar[tempthree].moneyfrommoneyfest tempsix
				addvarvar tempsix tempfour
				setplayervar[tempthree].moneyfrommoneyfest tempsix
				setplayervar[tempthree].bonusmoneycounter 60
				getplayervar[tempthree].playermoneybonus tempfive
				addvarvar tempfive tempfour
				setplayervar[tempthree].playermoneybonus tempfive
			}
			//Money multiplier
			getplayervar[tempthree].gotdoublemoney temptwo
			ifvare temptwo 1 { //gotdoublemoney
				divvar temp 4 //Double money rate
				getplayervar[tempthree].playermoneybonus tempfive
				addvarvar tempfive temp
				setplayervar[tempthree].playermoneybonus tempfive //money
				setplayervar[tempthree].bonusmoneycounter 60
				getplayervar[tempthree].doublemoneygained tempfour
  			addvarvar tempfour temp
  			setplayervar[tempthree].doublemoneygained tempfour
			}
			//Damage dealt
			getplayervar[tempthree].damagedealt temptwo
			addvarvar temptwo temp 
			setplayervar[tempthree].damagedealt temptwo
			//Hits
			getplayervar[tempthree].hits temptwo
			addvar temptwo 1
			setplayervar[tempthree].hits temptwo
		}
  }
  
  ifvare nuclear 1 { //Handle monster nuclear
  	setvar nuclear 0
  	getactor[THISACTOR].extra temp
		ifvarg temp 0 {
			state standard_jibs
			sound SQUISHED
	  	sound FIRE_CRACKLE
	  	sound NEWBEAST_DYING
	  	spawn FIRE2
	  	state newbeastdrops
	  	killit
		}
  }
  
  ifdead ifcount 90 sizeto 0 0
  
  ifaction 0
  {
    cstator 257
    sizeat 32 32
    ifvare monstertype 1 setactor[THISACTOR].pal 7
    ifvare monstertype 2 setactor[THISACTOR].pal 24
    ai AINEWBEASTDODGE
  }
  ifaction ANEWBEASTFROZEN
    state newbeastcode
  else
  {
    spritepal 6
    state newbeastcode
    ifaction ANEWBEASTFROZEN
      {
      	addkills 1
		    //ifrnd 84
		      //spawn BLOODPOOL
		    lotsofglass 30
		    sound GLASS_BREAKING
		    state dostuffonkill
		    killit
      }
    getlastpal
  }
enda

